<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use DB;
use PDF;
use Auth;
use Session;
use Response;
use App\Http\Requests;
use App\Http\Controllers\Controller;
use App\Http\Controllers\Redirect;
use Illuminate\Support\Facades\App;
use Carbon\Carbon;
use DataTables;
use App\KRT_Profile;
use App\KRT_Minit_Mesyuarat_Kehadiran;
use App\KRT_Minit_Mesyuarat_Perkara_Berbangkit;
use App\KRT_Minit_Mesyuarat_Kertas_Kerja;
use App\KRT_Minit_Mesyuarat_Hal_Lain;

class PdfController extends Controller
{

    public function surat_pelantikan_ajk(Request $request, $id){
            $surat_pelantikan_ajk_krt       = DB::table('krt__ahli_jawatan_kuasa')
                                            ->select('krt__ahli_jawatan_kuasa.id',
                                                    'krt__profile.krt_nama AS krt_nama',
                                                    'krt__profile.state_id AS krt_state',
                                                    'krt__profile.daerah_id AS krt_daerah',
                                                    'ref__daerahs.daerah_description AS daerah_description',
                                                    'krt__ahli_jawatan_kuasa.ajk_nama AS ajk_nama',
                                                    'krt__ahli_jawatan_kuasa.ajk_ic AS ajk_ic',
                                                    'krt__ahli_jawatan_kuasa.ajk_alamat AS ajk_alamat',
                                                    'ref__jawatan_ajk_krt.jawatan_description AS ajk_jawatan',
                                                    'ref__status_krt_ajk.status_description AS ajk_status',
                                                    DB::raw(" DATEDIFF( NOW(), krt__ahli_jawatan_kuasa.ajk_tarikh_mula) AS ajk_status_pelantikan"),
                                                    DB::raw(" DATE_FORMAT(krt__ahli_jawatan_kuasa.ajk_tarikh_mula,'%d/%m/%Y') AS ajk_tarikh_mula"),
                                                    DB::raw(" DATE_FORMAT(krt__ahli_jawatan_kuasa.ajk_tarikh_akhir,'%d/%m/%Y') AS ajk_tarikh_akhir"),
                                                    'users__profile.user_fullname AS ajk_disahkan_oleh',
                                                    DB::raw(" DATE_FORMAT(krt__ahli_jawatan_kuasa.disahkan_date,'%d/%m/%Y') AS ajk_tarikh_disahkan"))
                                            ->leftJoin('ref__jawatan_ajk_krt','ref__jawatan_ajk_krt.id','=','krt__ahli_jawatan_kuasa.ajk_jawatan_krt_id')
                                            ->leftJoin('ref__status_krt_ajk','ref__status_krt_ajk.id','=','krt__ahli_jawatan_kuasa.ajk_status')
                                            ->leftJoin('krt__profile','krt__profile.id','=','krt__ahli_jawatan_kuasa.krt_profile_id')
                                            ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','krt__profile.daerah_id')
                                            ->leftJoin('users__profile','users__profile.user_id','=','krt__ahli_jawatan_kuasa.disahkan_by')
                                            ->where('krt__ahli_jawatan_kuasa.id', '=', $id)  
                                            ->limit(1)
                                            ->first();
    
        
        
        $pdf = PDF::loadView('print.print-surat-pelantikan-ajk', compact('surat_pelantikan_ajk_krt'))->setPaper('A4', 'potrait');
        return $pdf->stream('Surat Pelantikan AJK KRT.pdf');
    }
    
    public function kad_keahlian(Request $request, $id){
            $kad_keahlian_ajk_krt           = DB::table('krt__ahli_jawatan_kuasa')
                                            ->select('krt__ahli_jawatan_kuasa.id',
                                                    DB::raw(" CONCAT('KRT',krt__profile.state_id,krt__profile.daerah_id,krt__profile.id,krt__ahli_jawatan_kuasa.id) AS krt_id"),
                                                    'krt__profile.krt_nama AS krt_nama',
                                                    'ref__daerahs.daerah_description AS krt_daerah',
                                                    'ref__states.state_description AS krt_state',
                                                    'krt__profile.state_id AS krt_state_id',
                                                    'krt__profile.daerah_id AS krt_daera_id',
                                                    'krt__ahli_jawatan_kuasa.ajk_nama AS ajk_nama',
                                                    'krt__ahli_jawatan_kuasa.ajk_ic AS ajk_ic',
                                                    'krt__ahli_jawatan_kuasa.ajk_alamat AS ajk_alamat',
                                                    'ref__jawatan_ajk_krt.jawatan_description AS ajk_jawatan',
                                                    'ref__status_krt_ajk.status_description AS ajk_status',
                                                    DB::raw(" DATEDIFF( NOW(), krt__ahli_jawatan_kuasa.ajk_tarikh_mula) AS ajk_status_pelantikan"),
                                                    DB::raw(" DATE_FORMAT(krt__ahli_jawatan_kuasa.ajk_tarikh_mula,'%d/%m/%Y') AS ajk_tarikh_mula"),
                                                    DB::raw(" DATE_FORMAT(krt__ahli_jawatan_kuasa.ajk_tarikh_akhir,'%d/%m/%Y') AS ajk_tarikh_akhir"),
                                                    'users__profile.user_fullname AS ajk_disahkan_oleh',
                                                    DB::raw(" DATE_FORMAT(krt__ahli_jawatan_kuasa.disahkan_date,'%d/%m/%Y') AS ajk_tarikh_disahkan"),
                                                    'krt__ahli_jawatan_kuasa.file_avatar AS file_avatar')
                                            ->leftJoin('ref__jawatan_ajk_krt','ref__jawatan_ajk_krt.id','=','krt__ahli_jawatan_kuasa.ajk_jawatan_krt_id')
                                            ->leftJoin('ref__status_krt_ajk','ref__status_krt_ajk.id','=','krt__ahli_jawatan_kuasa.ajk_status')
                                            ->leftJoin('krt__profile','krt__profile.id','=','krt__ahli_jawatan_kuasa.krt_profile_id')
                                            ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','krt__profile.daerah_id')
                                            ->leftJoin('ref__states','ref__states.state_id','=','krt__profile.state_id')
                                            ->leftJoin('users__profile','users__profile.user_id','=','krt__ahli_jawatan_kuasa.disahkan_by')
                                            ->where('krt__ahli_jawatan_kuasa.id', '=', $id)  
                                            ->limit(1)
                                            ->first();
        $customPaper = array(0,0,204.09448819,321.25984252);
        $pdf = PDF::loadView('kad.kad-keahlian-krt', compact('kad_keahlian_ajk_krt'))->setPaper($customPaper, 'potrait');
        return $pdf->stream('Kad Keahlian AJK KRT.pdf');
    }

    public function minit_mesyuarat(Request $request, $id){
                //$data_kehadiran                 = KRT_Minit_Mesyuarat_Kehadiran::where('krt_minit_mesyuarat_id', '=', $id)->get();
				$data_basic						= DB::table('krt__minit_mesyuarat')
												-> select('krt__minit_mesyuarat.krt_profile_id AS krt_id')
												-> where('krt__minit_mesyuarat.id','=',$id)
												->limit(1)
                                            	->first();
				$data_kehadiran					= DB::table('krt__minit_mesyuarat_kehadiran')
												-> select('krt__minit_mesyuarat_kehadiran.id',
												'krt__minit_mesyuarat_kehadiran.jenis_kehadiran',
												'krt__minit_mesyuarat_kehadiran.kehadiran_ic',
												'krt__minit_mesyuarat_kehadiran.kehadiran_nama',
												DB::raw(' check_jawatan(kehadiran_ic,kehadiran_ic) AS kehadiran_jawatan'),
												'krt__minit_mesyuarat_kehadiran.kehadiran_ic')
												-> where('krt__minit_mesyuarat_kehadiran.krt_minit_mesyuarat_id','=',$id)
												-> get();
				$data_ajk						= DB::table('krt__ahli_jawatan_kuasa')
												-> select('krt__ahli_jawatan_kuasa.ajk_nama',
												'krt__ahli_jawatan_kuasa.id',
												'krt__ahli_jawatan_kuasa.ajk_jawatan_krt_id',
												'ref__jawatan_ajk_krt.jawatan_description')
												->leftJoin('ref__jawatan_ajk_krt','ref__jawatan_ajk_krt.id','=','krt__ahli_jawatan_kuasa.ajk_jawatan_krt_id')
												-> where('krt__ahli_jawatan_kuasa.krt_profile_id','=',$data_basic->krt_id)
												-> where('krt__ahli_jawatan_kuasa.ajk_status','=',1)
												-> orderBy('krt__ahli_jawatan_kuasa.ajk_jawatan_krt_id', 'asc')
												-> get();
                $data_pekara_berbangkit         = KRT_Minit_Mesyuarat_Perkara_Berbangkit::where('krt_minit_mesyuarat_id', '=', $id)->get();
                $data_kertas_kerja              = KRT_Minit_Mesyuarat_Kertas_Kerja::where('krt_minit_mesyuarat_id', '=', $id)->get();
                $data_hal_lain                  = KRT_Minit_Mesyuarat_Hal_Lain::where('krt_minit_mesyuarat_id', '=', $id)->get();
                $data_minit_mesyuarat           = DB::table('krt__minit_mesyuarat')
                                                ->select('krt__minit_mesyuarat.id',
                                                        'krt__profile.krt_nama AS nama_krt',
                                                        'krt__minit_mesyuarat.mesyuarat_bil AS mesyuarat_bil',
                                                        'krt__minit_mesyuarat.mesyuarat_title AS mesyuarat_title',
                                                        DB::raw(" DATE_FORMAT(krt__minit_mesyuarat.mesyuarat_tarikh,'%Y') AS tahun_mesyuarat"),
                                                        DB::raw(" DATE_FORMAT(krt__minit_mesyuarat.mesyuarat_tarikh,'%d/%m/%Y') AS tarikh_mesyuarat"),
                                                        'krt__minit_mesyuarat.mesyuarat_time AS masa_mesyuarat',
                                                        'krt__minit_mesyuarat.mesyuarat_tempat AS tempat_mesyuarat',
                                                        //'users__profile.user_fullname AS pengerusi_krt',
														'krt__minit_mesyuarat.pengerusi AS pengerusi_krt',
														'krt__minit_mesyuarat.pencatat AS pencatat',
														DB::raw(" DATE_FORMAT(krt__minit_mesyuarat.direkod_date,'%d/%m/%Y') AS tarikh_rekod"),
														DB::raw(" REPLACE(REPLACE(krt__minit_mesyuarat.mesyuarat_perutusan_pengerusi, '\r', ''), '\n', '<br />') AS perutusan_pengerusi_mesyuarat"),
														DB::raw(" REPLACE(REPLACE(krt__minit_mesyuarat.mesyuarat_yang_lalu, '\r', ''), '\n', '<br />') AS minit_yang_lalu_mesyuarat"),
														DB::raw(" REPLACE(REPLACE(krt__minit_mesyuarat.mesyuarat_penyata_kewangan, '\r', ''), '\n', '<br />') AS penyata_kewangan_mesyuarat"),
														DB::raw(" REPLACE(REPLACE(krt__minit_mesyuarat.mesyuarat_penutup, '\r', ''), '\n', '<br />') AS penutup_mesyuarat"),
                                                        'krt__minit_mesyuarat.mesyuarat_penutup AS penutup_mesyuarat2',
														DB::raw(" check_users(krt__minit_mesyuarat.disemak_by) AS penyemak"),
														DB::raw(" DATE_FORMAT(krt__minit_mesyuarat.disemak_date,'%d/%m/%Y') AS tarikh_semak"),
                                                        'krt__minit_mesyuarat.mesyuarat_title AS mesyuarat_tajuk')
                                                ->leftJoin('krt__profile','krt__profile.id','=','krt__minit_mesyuarat.krt_profile_id')
												//->leftJoin('users__profile', function($join)
        														//	{
																//		$join->on('users__profile.krt_id', '=', 'krt__profile.id');
																//		$join->on('users__profile.user_id', '=', 'krt__minit_mesyuarat.disemak_by');
																//	})
                                                ->leftJoin('users__profile','users__profile.krt_id','=','krt__profile.id')
											//	->leftJoin('users__profile','users__profile.user_id','=','krt__minit_mesyuarat.disemak_by')
                                                ->leftJoin('users','users.user_id','=','users__profile.user_id')
                                                ->where('krt__minit_mesyuarat.id', '=', $id)  
                                                ->limit(1)
                                                ->first();
                $data_krt                 	= DB::table('krt__profile')
											->select('krt__profile.daerah_id as daerah_id',
											'ref__daerahs.daerah_description as daerah',
											'ref__states.state_description as negeri')
											->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','krt__profile.daerah_id')
											->leftJoin('ref__states','ref__states.state_id','=','krt__profile.state_id')
											->where('krt__profile.id','=',$data_basic->krt_id)
											->limit(1)
                                            ->first();
        
        $pdf = PDF::loadView('print.print-minit-mesyuarat', 
        compact('data_krt','data_kehadiran', 'data_pekara_berbangkit', 'data_kertas_kerja' , 'data_hal_lain','data_minit_mesyuarat','data_ajk'))->setPaper('A4', 'potrait');
        $pdf->output();
		$domPdf = $pdf->getDomPDF();
		$canvas = $domPdf->get_canvas();
        $canvas->page_text(500, 810, "Mukasurat {PAGE_NUM} / {PAGE_COUNT}", null, 10, [0, 0, 0]);
		//return $pdf->download('itsolutionstuff.pdf');
		return $pdf->stream('asdasjihasd.pdf');
    }	

    public function kewangan_resit_penerimaan(Request $request, $id){
            $data_resit_penerimaan     = DB::table('krt__kewangan')
                                            ->select('krt__kewangan.id',
                                                    'krt__kewangan.kewangan_nama_penuh',
                                                    DB::raw(" FORMAT(krt__kewangan.kewangan_jumlah_bank + krt__kewangan.kewangan_jumlah_tunai, 2) AS total_jumlah"),
                                                    'krt__kewangan.kewangan_cek_baucer',
                                                    'krt__kewangan.kewangan_butiran',
                                                    DB::raw(" DATE_FORMAT(krt__kewangan.kewangan_tarikh_t_b,'%d/%m/%Y') AS tarikh_kewangan"))
                                            ->where('krt__kewangan.id', '=', $id)  
                                            ->limit(1)
                                            ->first();
    
        // $pdf = PDF::loadView('kad.kad-keahlian-krt', $data);
        // return $pdf->stream('sss.pdf');
        
        $pdf = PDF::loadView('print.print-resit-penerimaan-kewangan', compact('data_resit_penerimaan'))->setPaper('A4', 'potrait');
        return $pdf->stream('asdasjihasd.pdf');
    }

    public function kewangan_baucer_pembayaran(Request $request, $id){
            $data_baucer_pembayaran     = DB::table('krt__kewangan')
                                            ->select('krt__kewangan.id',
                                                    'krt__kewangan.kewangan_nama_penuh',
                                                    'krt__kewangan.kewangan_alamat',
                                                    DB::raw(" krt__kewangan.kewangan_jumlah_bank + krt__kewangan.kewangan_jumlah_tunai AS total_jumlah"),
                                                    'krt__kewangan.kewangan_cek_baucer',
                                                    'krt__kewangan.kewangan_butiran',
                                                    DB::raw(" DATE_FORMAT(krt__kewangan.kewangan_tarikh_t_b,'%d/%m/%Y') AS tarikh_kewangan"))
                                            ->where('krt__kewangan.id', '=', $id)  
                                            ->limit(1)
                                            ->first();
    
        // $pdf = PDF::loadView('kad.kad-keahlian-krt', $data);
        // return $pdf->stream('sss.pdf');
        
        $pdf = PDF::loadView('print.print-baucer-bayaran-kewangan', compact('data_baucer_pembayaran'))->setPaper('A4', 'potrait');
        return $pdf->stream('asdasjihasd.pdf');
    }

    public function laporan_kewangan_rt(Request $request, $id){
        $laporan_kewangan       = DB::table('krt__kewangan')
                                ->select('krt__kewangan.id',
                                        'krt__kewangan.kewangan_butiran AS kewangan_butiran',
                                        DB::raw("DATE_FORMAT(krt__kewangan.kewangan_tarikh_t_b,'%d/%m/%Y') AS tarikh_t_b"),
                                        'krt__kewangan.kewangan_cek_baucer AS kewangan_cek_baucer',
                                        DB::raw("DATE_FORMAT(krt__kewangan.kewangan_tarikh_cek,'%d/%m/%Y') AS kewangan_tarikh_cek"),
                                        DB::raw("CASE WHEN krt__kewangan.kewangan_jenis_kewangan = 1 THEN krt__kewangan.kewangan_jumlah_tunai ELSE '0' END AS terima_tunai"),
                                        DB::raw("CASE WHEN krt__kewangan.kewangan_jenis_kewangan = 1 THEN krt__kewangan.kewangan_jumlah_bank ELSE '0' END AS terima_bank"),
                                        DB::raw("CASE WHEN krt__kewangan.kewangan_jenis_kewangan = 2 THEN krt__kewangan.kewangan_jumlah_tunai ELSE '0' END AS bayar_tunai"),
                                        DB::raw("CASE  WHEN krt__kewangan.kewangan_jenis_kewangan = 2 THEN krt__kewangan.kewangan_jumlah_bank ELSE '0' END AS bayar_bank"),
                                        'krt__kewangan.kewangan_baki_tunai AS kewangan_baki_tunai',
                                        'krt__kewangan.kewangan_baki_bank AS kewangan_baki_bank')
                                ->orderBy('krt__kewangan.id', 'asc')
                                ->where('krt__kewangan.krt_profile_id', '=',$id)
                                ->get();
        $profile_krt     = DB::table('krt__kewangan')
                                ->select('krt__profile.id AS id',
                                        'krt__profile.krt_nama AS krt_nama',
                                        'krt__profile.krt_bank_no_acc as bank_no_acc',
                                        'krt__profile.krt_bank_nama AS bank_nama',
                                        'krt__profile.krt_bank_no_evendor AS no_evendor',
                                        'ref__daerahs.daerah_description AS daerah',
                                        'ref__states.state_description AS state')
                                ->leftJoin('krt__profile','krt__profile.id','=','krt__kewangan.krt_profile_id')
                                ->leftJoin('ref__states','ref__states.state_id','=','krt__profile.state_id')
                                ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','krt__profile.daerah_id')
                                ->where('krt__profile.id', '=', $id)
                                ->limit(1)
                                ->first();
        

        $pdf = PDF::loadView('print.print-laporan-kewangan-rt', compact('profile_krt','laporan_kewangan'))->setPaper('A4', 'landscape');
        return $pdf->stream('asdasjihasd.pdf');
    }

    public function aktiviti_surat_perancangan_aktiviti_hq(Request $request, $id){
        
        $data_surat_perancangan_aktiviti     = DB::table('krt__aktiviti_surat_perancangan')
                                                ->select('krt__aktiviti_surat_perancangan.id',
                                                'krt__aktiviti_surat_perancangan.surat_tahun',
                                                DB::raw(" DATE_FORMAT(krt__aktiviti_surat_perancangan.surat_tarikh,'%d/%m/%Y') AS surat_tarikh"),
                                                'krt__aktiviti_surat_perancangan.created_at',
                                                'users__profile.user_fullname AS create_by')
                                                ->leftJoin('users__profile','users__profile.user_id','=','krt__aktiviti_surat_perancangan.create_by')
                                                ->orderBy('krt__aktiviti_surat_perancangan.id', 'asc')
                                                ->where('krt__aktiviti_surat_perancangan.id', '=', $id)  
                                                ->limit(1)
                                                ->first();

        $pdf = PDF::loadView('print.print-aktiviti-surat-perancangan-hq', compact('data_surat_perancangan_aktiviti'))->setPaper('A4', 'potrait');
        return $pdf->stream('asdasjihasd.pdf');
    }

    public function perancangan_rondaan_srs(Request $request, $id){
        $ahli_peronda           = DB::table('srs__perancangan_rondaan_ahli')
                                    ->select('srs__perancangan_rondaan_ahli.id',
                                            'srs__ahli_peronda.peronda_nama AS peronda_nama',
                                            'srs__ahli_peronda.peronda_ic AS peronda_ic')
                                    ->leftJoin('srs__ahli_peronda','srs__ahli_peronda.id','=','srs__perancangan_rondaan_ahli.srs_ahli_peronda_id')
                                    ->where('srs__perancangan_rondaan_ahli.srs_perancangan_rondaan_id', '=', $id)
                                    ->get();
        $perancangan_rondaan    = DB::table('srs__perancangan_rondaan')
                                    ->select('srs__perancangan_rondaan.id',
                                            'krt__profile.krt_nama AS nama_krt',
                                            'krt__profile.krt_alamat AS alamat_krt',
                                            'ref__states.state_description AS negeri_krt', 
                                            'ref__daerahs.daerah_description AS daerah_krt',
                                            'ref__parlimens.parlimen_description AS parlimen_krt',
                                            'ref__duns.dun_description AS dun_krt',
                                            'ref__pbts.pbt_description AS pbt_krt',
                                            'srs__profile.srs_name AS nama_srs',
                                            'srs__perancangan_rondaan.krt_profile_id AS krt_profile_id',
                                            'srs__perancangan_rondaan.srs_profile_id AS srs_profile_id',
                                            DB::raw(" DATE_FORMAT(srs__perancangan_rondaan.perancangan_rondaan_tarikh,'%d/%m/%Y') AS perancangan_rondaan_tarikh"))
                                    ->leftJoin('krt__profile','krt__profile.id','=','srs__perancangan_rondaan.krt_profile_id')
                                    ->leftJoin('ref__states','ref__states.state_id','=','krt__profile.state_id')
                                    ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','krt__profile.daerah_id')
                                    ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','krt__profile.parlimen_id')
                                    ->leftJoin('ref__duns','ref__duns.dun_id','=','krt__profile.dun_id')
                                    ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','krt__profile.pbt_id')
                                    ->leftJoin('srs__profile','srs__profile.id','=','srs__perancangan_rondaan.srs_profile_id')
                                    ->where('srs__perancangan_rondaan.id', '=', $id)  
                                    ->limit(1)
                                    ->first();
        

        $pdf = PDF::loadView('print.print-perancangan-rondaan-srs', compact('ahli_peronda','perancangan_rondaan'))->setPaper('A4', 'potrait');
        return $pdf->stream('asdasjihasd.pdf');
    }

    public function notis_pembatalan_srs(Request $request, $id){
                $data_pembatalan_srs    = DB::table('srs__permohonan_pembatalan_srs')
                                                ->select('srs__permohonan_pembatalan_srs.id',
                                                        'srs__profile.srs_name AS nama_srs',
                                                        DB::raw(" DATE_FORMAT(srs__permohonan_pembatalan_srs.diluluskan_date,'%d/%m/%Y') AS diluluskan_date"))
                                                ->leftJoin('srs__profile','srs__profile.id','=','srs__permohonan_pembatalan_srs.srs_profile_id')  
                                                ->where('srs__permohonan_pembatalan_srs.id', '=', $id)  
                                                ->limit(1)
                                                ->first();
        $pdf = PDF::loadView('print.notis-pembatalan-srs', compact('data_pembatalan_srs'))->setPaper('A4', 'potrait');
        return $pdf->stream('asdasjihasd.pdf');
    }

    public function report_kewangan_krt(Request $request, $id){
                $data_kewangan_krt1     = DB::table('krt__kewangan')
                                                ->select('krt__profile.id',
                                                        'ref__states.state_description AS state',
                                                        'ref__daerahs.daerah_description AS daerah',
                                                        'krt__profile.krt_nama AS nama_krt',
                                                        'krt__kewangan.kewangan_butiran AS butiran',
                                                        DB::raw(" DATE_FORMAT(krt__kewangan.kewangan_tarikh_t_b,'%d/%m/%Y') AS tarikh_pp"),
                                                        'krt__kewangan.kewangan_cek_baucer AS no_cek_baucer',
                                                        DB::raw(" DATE_FORMAT(krt__kewangan.kewangan_tarikh_cek,'%d/%m/%Y') AS tarikh_cek_baucer"),
                                                        DB::raw(" (case when krt__kewangan.kewangan_jenis_kewangan = 1 then krt__kewangan.kewangan_jumlah_bank else 0 end) AS penerimaan_bank"),
                                                        DB::raw(" (case when krt__kewangan.kewangan_jenis_kewangan = 1 then krt__kewangan.kewangan_jumlah_tunai else 0 end) AS penerimaan_tunai"),
                                                        DB::raw(" (case when krt__kewangan.kewangan_jenis_kewangan = 2 then krt__kewangan.kewangan_jumlah_bank else 0 end) AS pembayaran_bank"),
                                                        DB::raw(" (case when krt__kewangan.kewangan_jenis_kewangan = 2 then krt__kewangan.kewangan_jumlah_tunai else 0 end) AS pembayaran_tunai"),
                                                        DB::raw(" (case when krt__kewangan.kewangan_jenis_kewangan = 1 then krt__kewangan.kewangan_jumlah_bank  else 0 end) + 
                                                        (case when krt__kewangan.kewangan_jenis_kewangan = 2 then krt__kewangan.kewangan_jumlah_bank  else 0 end)  AS total_bank"),
                                                        DB::raw(" (case when krt__kewangan.kewangan_jenis_kewangan = 1 then krt__kewangan.kewangan_jumlah_tunai else 0 end) -
                                                        (case when krt__kewangan.kewangan_jenis_kewangan = 2 then krt__kewangan.kewangan_jumlah_tunai else 0 end) AS total_tunai"),
                                                        DB::raw(" (case when krt__kewangan.kewangan_jenis_kewangan = 1 then krt__kewangan.kewangan_jumlah_bank else 0 end) - 
                                                        (case when krt__kewangan.kewangan_jenis_kewangan = 2 then krt__kewangan.kewangan_jumlah_bank else 0 end) +
                                                        (case when krt__kewangan.kewangan_jenis_kewangan = 1 then krt__kewangan.kewangan_jumlah_tunai else 0 end) -
                                                        (case when krt__kewangan.kewangan_jenis_kewangan = 2 then krt__kewangan.kewangan_jumlah_tunai else 0 end) AS total_baki"))
                                                ->leftJoin('krt__profile','krt__profile.id','=','krt__kewangan.krt_profile_id') 
                                                ->leftJoin('ref__states','ref__states.state_id','=','krt__profile.state_id') 
                                                ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','krt__profile.daerah_id') 
                                                ->where('krt__kewangan.kewangan_status', '=', 1) 
                                                ->where('krt__kewangan.krt_profile_id', '=', $id)  
                                                ->get();
        $pdf = PDF::loadView('print.report-kewangan-krt', compact('data_kewangan_krt1'))->setPaper('A4', 'landscape');
        return $pdf->stream('asdasjihasd.pdf');
    }

    public function notis_pembatalan_krt(Request $request, $id){
        $data_notis_pembatalan_krt      = DB::table('krt__pembatalan')
                                        ->select('krt__pembatalan.id',
                                                'krt__profile.id AS krt_profile_id',
                                                'krt__profile.krt_nama AS nama_krt',
                                                'krt__profile.state_id AS state_id',
                                                'krt__profile.daerah_id AS daerah_id',
                                                DB::raw(" DATE_FORMAT(krt__pembatalan.diluluskan_date,'%d/%m/%Y') AS diluluskan_date"))
                                        ->leftJoin('krt__profile','krt__profile.id','=','krt__pembatalan.krt_profile_id') 
                                        ->leftJoin('ref__states','ref__states.state_id','=','krt__profile.state_id') 
                                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','krt__profile.daerah_id') 
                                        ->where('krt__pembatalan.id', '=', $id)  
                                        ->get();
        $pdf = PDF::loadView('print.notis_pembatalan-krt', compact('data_notis_pembatalan_krt'))->setPaper('A4', 'potrait');
        return $pdf->stream('asdasjihasd.pdf');
    }

    /* public function srs_kad_keahlian(Request $request, $id){
        $kad_keahlian_ajk_srs           = DB::table('srs__ahli_peronda')
                                        ->select('srs__ahli_peronda.id',
                                                DB::raw(" CONCAT('SRS',krt__profile.state_id,krt__profile.daerah_id,srs__profile.id) AS srs_id"),
                                                'srs__ahli_peronda.peronda_nama AS peronda_nama',
                                                'srs__ahli_peronda.peronda_ic AS peronda_ic',
                                                'srs__ahli_peronda.peronda_alamat AS peronda_alamat',
                                                'srs__profile.srs_name AS srs_name',
                                                'srs__ahli_peronda.file_gambar_profile AS file_gambar_profile')
                                        ->leftJoin('srs__profile','srs__profile.id','=','srs__ahli_peronda.srs_profile_id')
                                        ->leftJoin('krt__profile','krt__profile.id','=','srs__ahli_peronda.krt_profile_id')
                                        ->where('srs__ahli_peronda.id', '=', $id)  
                                        ->limit(1)
                                        ->first();
    
    
        $customPaper = array(0,0,204.09448819,321.25984252);
        $pdf = PDF::loadView('kad.kad-keahlian-srs', compact('kad_keahlian_ajk_srs'))->setPaper($customPaper, 'potrait');
        return $pdf->stream('Kad Keahlian AJK KRT.pdf');
    } */
	
	public function srs_kad_keahlian(Request $request, $id){
          $kad_keahlian_ajk_srs           = DB::table('srs__ahli_peronda')
                                        ->select('srs__ahli_peronda.id',
                                                DB::raw(" CONCAT('SRS',krt__profile.state_id,krt__profile.daerah_id,srs__profile.id) AS srs_id"),
                                                'srs__ahli_peronda.peronda_nama AS peronda_nama',
                                                'srs__ahli_peronda.peronda_ic AS peronda_ic',
                                                'srs__ahli_peronda.peronda_alamat AS peronda_alamat',
                                                'srs__profile.srs_name AS srs_name',
                                                'srs__ahli_peronda.file_gambar_profile AS file_gambar_profile',
                                                'ref__daerahs.daerah_description AS srs_daerah',
	                                              'ref__states.state_description AS srs_state')
                                        ->leftJoin('srs__profile','srs__profile.id','=','srs__ahli_peronda.srs_profile_id')
                                        ->leftJoin('krt__profile','krt__profile.id','=','srs__ahli_peronda.krt_profile_id')
                                        ->leftJoin('ref__daerahs', 'ref__daerahs.daerah_id','=', 'krt__profile.daerah_id')
                                        ->leftJoin('ref__states', 'ref__states.state_id', '=', 'krt__profile.state_id')
                                        ->where('srs__ahli_peronda.id', '=', $id)
                                        ->limit(1)
                                        ->first();
          $customPaper = array(0,0,204.09448819,321.25984252);
          $pdf = PDF::loadView('kad.kad-keahlian-srs', compact('kad_keahlian_ajk_srs'))->setPaper($customPaper, 'potrait');
          return $pdf->stream('Kad Keahlian AJK KRT.pdf');
        }

        public function kad_imediator(Request $request, $id){
          $kad_keahlian_mkp       = DB::table('spk__imediator')
                                ->select('spk__imediator.id',
                                        'users__profile.user_fullname',
                                        'users__profile.no_ic',
                                        'spk__imediator.mkp_file_avatar AS file_gambar_profile')
                                ->leftJoin('users','users.user_id','=','spk__imediator.user_id')
                                ->leftJoin('users__profile','users__profile.user_id','=','users.user_id')
                                ->where('spk__imediator.id', '=', $id)  
                                ->limit(1)
                                ->first();
          $customPaper = array(0,0,204.09448819,321.25984252);
          $pdf = PDF::loadView('kad.kad-keahlian-mediator', compact('kad_keahlian_mkp'))->setPaper($customPaper, 'potrait');
          return $pdf->stream('Kad Keahlian iMediator.pdf');
        }

        public function surat_pelantikan_mediator(Request $request, $id){
          $data_pelantikan_mkp    = DB::table('spk__imediator')
                                ->select('spk__imediator.id',
                                        'users__profile.user_fullname AS mkp_pemohon_nama',
                                        'users__profile.no_ic AS mkp_pemohon_ic',
                                        DB::raw(" DATE_FORMAT(spk__imediator.dilantik_date,'%d/%m/%Y') AS dilantik_date"),
                                        'users__profile.user_fullname AS user_fullname',
                                        DB::raw("DATE_FORMAT(DATE_ADD(spk__imediator.mkp_tarikh_dilantik, INTERVAL 731 DAY),'%d/%m/%Y') AS tarikh_tamat"))
                                ->leftJoin('users__profile','users__profile.user_id','=','spk__imediator.user_id')
                                ->where('spk__imediator.id', '=', $id)  
                                ->get();
          $pdf = PDF::loadView('print.print-surat-pelantikan-mediator', compact('data_pelantikan_mkp'))->setPaper('A4', 'potrait');
          return $pdf->stream('Surat Pelantikan AJK KRT.pdf');
        }

    public function surat_pemakluman_tabika(Request $request, $id){
        $lulus_permohonan_pelajar  = DB::table('tbk__student')
                                ->select('tbk__student.id',
                                        'tbk__student.ibu_nama AS ibu_nama',
                                        'tbk__student.bapa_nama AS bapa_nama',
                                        'tbk__student.student_alamat AS student_alamat',
                                        'tbk__student.student_nama AS student_nama',
                                        'tbk__profile.tbk_nama AS tbk_nama',
                                        'ref__states.state_description AS state',
                                        'ref__daerahs.daerah_description AS daerah',
                                        'users__profile.user_fullname AS user_fullname',
                                        DB::raw("DATE_FORMAT(tbk__student.diluluskan_date,'%d/%m/%Y') AS tarikh_lulus"))
                                ->leftJoin('tbk__profile','tbk__profile.id','=','tbk__student.tabika_id')
                                ->leftJoin('ref__states','ref__states.state_id','=','tbk__profile.state_id')
                                ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','tbk__profile.daerah_id')
                                ->leftJoin('users__profile','users__profile.user_id','=','tbk__student.diluluskan_by')
                                ->where('tbk__student.id', '=', $id)  
                                ->get();
        $pdf = PDF::loadView('print.print-surat-pemakluman-tabika', compact('lulus_permohonan_pelajar'))->setPaper('A4', 'potrait');
        return $pdf->stream('Surat Pemakluman kelulusan Tabika.pdf');
    }

    public function surat_pemakluman_tabika_xberjaya(Request $request, $id){
        $permohonan_pelajar  = DB::table('tbk__student')
                                ->select('tbk__student.id',
                                        'tbk__student.ibu_nama AS ibu_nama',
                                        'tbk__student.bapa_nama AS bapa_nama',
                                        'tbk__student.student_alamat AS student_alamat',
                                        'tbk__student.student_nama AS student_nama',
                                        'tbk__profile.tbk_nama AS tbk_nama',
                                        'ref__states.state_description AS state',
                                        'ref__daerahs.daerah_description AS daerah',
                                        'users__profile.user_fullname AS user_fullname',
                                        DB::raw("DATE_FORMAT(tbk__student.disahkan_date,'%d/%m/%Y') AS tarikh_disahkan"),
                                        'tbk__student.ditolak_tahun AS ditolak_tahun',
                                        'tbk__student.ditolak_penuh AS ditolak_penuh',
                                        'tbk__student.ditolak_xlengkap AS ditolak_xlengkap',
                                        'tbk__student.ditolak_jauh AS ditolak_jauh')
                                ->leftJoin('tbk__profile','tbk__profile.id','=','tbk__student.tabika_id')
                                ->leftJoin('ref__states','ref__states.state_id','=','tbk__profile.state_id')
                                ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','tbk__profile.daerah_id')
                                ->leftJoin('users__profile','users__profile.user_id','=','tbk__student.diluluskan_by')
                                ->where('tbk__student.id', '=', $id)  
                                ->get();
        $pdf = PDF::loadView('print.print-surat-pemakluman-tabika-xberjaya', compact('permohonan_pelajar'))->setPaper('A4', 'potrait');
        return $pdf->stream('Surat Pemakluman Ditolak Kemasukan Tabika Perpaduan.pdf');
    }

}
