<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Input;
use Redirect, Response;
use Auth;
use Validator;
use Session;
use DataTables;
use DB;
use Carbon\Carbon;
use App\User;
use App\UserProfile;
use App\RefStates;
use App\RefDaerah;
use App\RefBandar;
use App\RefParlimen;
use App\RefDUN;
use App\RefPBT;
use App\Ref_SPK_MKP_Mediasi;
use App\Ref_SPK_MKP_Mediasi_Status;
use App\Ref_SPK_MKP_Peringkat;

class RT_SM32Controller extends Controller
{
    public function __construct()
    {
        $this->middleware('auth');
    }

    function laporan_ikes_isu_semasa_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::table('spk__ikes_ts')
                        ->select('spk__ikes_ts.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__duns.dun_description AS dun',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'spk__ikes.ikes_lokasi AS lokasi',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                DB::raw("DATE_FORMAT(spk__ikes_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                'spk__ikes_ts.keterangan_tindakan AS keterangan_tindakan',
                                DB::raw("DATE_FORMAT(spk__ikes_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"))
                        ->leftJoin('spk__ikes_at','spk__ikes_at.id','=','spk__ikes_ts.spk_ikes_at_id')
                        ->leftJoin('spk__ikes','spk__ikes.id','=','spk__ikes_at.spk_ikes_id')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kategori_id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__ikes_at.jenis_arahan_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->where('spk__ikes.daerah_id', '=', Auth::user()->daerah_id)
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-isu-semasa-ppd',compact('roles_menu'));
        }
    }

    function laporan_ikes_isu_semasa_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes_ts')
                        ->select('spk__ikes_ts.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__duns.dun_description AS dun',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'spk__ikes.ikes_lokasi AS lokasi',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                DB::raw("DATE_FORMAT(spk__ikes_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                'spk__ikes_ts.keterangan_tindakan AS keterangan_tindakan',
                                DB::raw("DATE_FORMAT(spk__ikes_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"))
                        ->leftJoin('spk__ikes_at','spk__ikes_at.id','=','spk__ikes_ts.spk_ikes_at_id')
                        ->leftJoin('spk__ikes','spk__ikes.id','=','spk__ikes_at.spk_ikes_id')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kategori_id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__ikes_at.jenis_arahan_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->where('spk__ikes.state_id', '=', Auth::user()->state_id)
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $daerah     = RefDaerah::where('status', '=',  true)
                            ->where('ref__daerahs.state_id', '=', Auth::user()->state_id)    
                            ->get();
                $parlimen   = RefParlimen::where('status', '=',  true)
                            ->where('ref__parlimens.state_id', '=', Auth::user()->state_id)    
                            ->get();
            return view('rt-sm32.laporan-ikes-isu-semasa-ppmk',compact('roles_menu','daerah','parlimen'));
        }
    }

    function laporan_ikes_isu_semasa_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes_ts')
                        ->select('spk__ikes_ts.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__duns.dun_description AS dun',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'spk__ikes.ikes_lokasi AS lokasi',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                DB::raw("DATE_FORMAT(spk__ikes_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                'spk__ikes_ts.keterangan_tindakan AS keterangan_tindakan',
                                DB::raw("DATE_FORMAT(spk__ikes_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"))
                        ->leftJoin('spk__ikes_at','spk__ikes_at.id','=','spk__ikes_ts.spk_ikes_at_id')
                        ->leftJoin('spk__ikes','spk__ikes.id','=','spk__ikes_at.spk_ikes_id')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kategori_id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__ikes_at.jenis_arahan_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->where('spk__ikes.state_id', '=', Auth::user()->state_id)
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $daerah     = RefDaerah::where('status', '=',  true)
                            ->where('ref__daerahs.state_id', '=', Auth::user()->state_id)    
                            ->get();
                $parlimen   = RefParlimen::where('status', '=',  true)
                            ->where('ref__parlimens.state_id', '=', Auth::user()->state_id)    
                            ->get();
            return view('rt-sm32.laporan-ikes-isu-semasa-ppn',compact('roles_menu','daerah','parlimen'));
        }
    }

    function laporan_ikes_isu_semasa_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes_ts')
                        ->select('spk__ikes_ts.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__duns.dun_description AS dun',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'spk__ikes.ikes_lokasi AS lokasi',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                DB::raw("DATE_FORMAT(spk__ikes_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                'spk__ikes_ts.keterangan_tindakan AS keterangan_tindakan',
                                DB::raw("DATE_FORMAT(spk__ikes_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"))
                        ->leftJoin('spk__ikes_at','spk__ikes_at.id','=','spk__ikes_ts.spk_ikes_at_id')
                        ->leftJoin('spk__ikes','spk__ikes.id','=','spk__ikes_at.spk_ikes_id')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kategori_id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__ikes_at.jenis_arahan_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-ikes-isu-semasa-bpp',compact('roles_menu','state'));
        }
    }

    function laporan_ikes_isu_semasa_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes_ts')
                        ->select('spk__ikes_ts.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__duns.dun_description AS dun',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'spk__ikes.ikes_lokasi AS lokasi',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                DB::raw("DATE_FORMAT(spk__ikes_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                'spk__ikes_ts.keterangan_tindakan AS keterangan_tindakan',
                                DB::raw("DATE_FORMAT(spk__ikes_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"))
                        ->leftJoin('spk__ikes_at','spk__ikes_at.id','=','spk__ikes_ts.spk_ikes_at_id')
                        ->leftJoin('spk__ikes','spk__ikes.id','=','spk__ikes_at.spk_ikes_id')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kategori_id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__ikes_at.jenis_arahan_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-ikes-isu-semasa-p',compact('roles_menu','state'));
        }
    }

    function laporan_ikes_isu_semasa_tkpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes_ts')
                        ->select('spk__ikes_ts.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__duns.dun_description AS dun',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'spk__ikes.ikes_lokasi AS lokasi',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                DB::raw("DATE_FORMAT(spk__ikes_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                'spk__ikes_ts.keterangan_tindakan AS keterangan_tindakan',
                                DB::raw("DATE_FORMAT(spk__ikes_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"))
                        ->leftJoin('spk__ikes_at','spk__ikes_at.id','=','spk__ikes_ts.spk_ikes_at_id')
                        ->leftJoin('spk__ikes','spk__ikes.id','=','spk__ikes_at.spk_ikes_id')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kategori_id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__ikes_at.jenis_arahan_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-ikes-isu-semasa-tkpp',compact('roles_menu','state'));
        }
    }

    function laporan_ikes_isu_semasa_kp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes_ts')
                        ->select('spk__ikes_ts.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__duns.dun_description AS dun',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'spk__ikes.ikes_lokasi AS lokasi',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                DB::raw("DATE_FORMAT(spk__ikes_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                'spk__ikes_ts.keterangan_tindakan AS keterangan_tindakan',
                                DB::raw("DATE_FORMAT(spk__ikes_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"))
                        ->leftJoin('spk__ikes_at','spk__ikes_at.id','=','spk__ikes_ts.spk_ikes_at_id')
                        ->leftJoin('spk__ikes','spk__ikes.id','=','spk__ikes_at.spk_ikes_id')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kategori_id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__ikes_at.jenis_arahan_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-ikes-isu-semasa-kp',compact('roles_menu','state'));
        }
    }

    function laporan_ikes_isu_semasa_kpn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes_ts')
                        ->select('spk__ikes_ts.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__duns.dun_description AS dun',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'spk__ikes.ikes_lokasi AS lokasi',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                DB::raw("DATE_FORMAT(spk__ikes_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                'spk__ikes_ts.keterangan_tindakan AS keterangan_tindakan',
                                DB::raw("DATE_FORMAT(spk__ikes_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"))
                        ->leftJoin('spk__ikes_at','spk__ikes_at.id','=','spk__ikes_ts.spk_ikes_at_id')
                        ->leftJoin('spk__ikes','spk__ikes.id','=','spk__ikes_at.spk_ikes_id')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kategori_id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__ikes_at.jenis_arahan_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-ikes-isu-semasa-kpn',compact('roles_menu','state'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_ikes_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::table('spk__ikes')
                        ->select('spk__ikes.id AS id',
                                DB::raw("DATE_FORMAT(spk__ikes.dihantar_date,'%d/%m/%Y') AS tarikh_report"),
                                DB::raw("CASE 
                                WHEN day(spk__ikes.dihantar_date) < 8 THEN 'Minggu 1'
                                WHEN day(spk__ikes.dihantar_date) < 15 THEN 'Minggu 2'
                                WHEN day(spk__ikes.dihantar_date) < 22 THEN 'Minggu 3'
                                ELSE 'Minggu 4'
                                END AS minggu_report"),
                                DB::raw("Month(spk__ikes.dihantar_date) AS bulan_report"),
                                'ref__states.state_description AS negeri',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__duns.dun_description AS dun',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__pbts.pbt_description AS pbt',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'spk__ikes.ikes_keterangan_kes AS keterangan_kes',
                                'ref__spk_kategori_kes.kategori_description As kategori_kes',
                                'ref__spk_peringkat_kes.peringkat_description AS peringkat_kes',
                                'spk__ikes.ikes_bil_terlibat AS bil_terlibat',
                                DB::raw("CASE spk__ikes.status_etnik_id
                                WHEN spk__ikes.status_etnik_id = 1 THEN 'Ya'
                                ELSE 'Tidak'
                                END AS status_etnik"))
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','spk__ikes.pbt_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kluster_id')
                        ->leftJoin('ref__spk_kategori_kes','ref__spk_kategori_kes.id','=','spk__ikes.kategori_id')
                        ->leftJoin('ref__spk_peringkat_kes','ref__spk_peringkat_kes.id','=','spk__ikes.peringkat_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->where('spk__ikes.daerah_id', '=', Auth::user()->daerah_id)
                        ->orderBy('spk__ikes.dihantar_date')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-ppd',compact('roles_menu'));
        }
    }

    function laporan_ikes_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes')
                        ->select('spk__ikes.id AS id',
                                DB::raw("DATE_FORMAT(spk__ikes.dihantar_date,'%d/%m/%Y') AS tarikh_report"),
                                DB::raw("CASE 
                                WHEN day(spk__ikes.dihantar_date) < 8 THEN 'Minggu 1'
                                WHEN day(spk__ikes.dihantar_date) < 15 THEN 'Minggu 2'
                                WHEN day(spk__ikes.dihantar_date) < 22 THEN 'Minggu 3'
                                ELSE 'Minggu 4'
                                END AS minggu_report"),
                                DB::raw("Month(spk__ikes.dihantar_date) AS bulan_report"),
                                'ref__states.state_description AS negeri',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__duns.dun_description AS dun',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__pbts.pbt_description AS pbt',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'spk__ikes.ikes_keterangan_kes AS keterangan_kes',
                                'ref__spk_kategori_kes.kategori_description As kategori_kes',
                                'ref__spk_peringkat_kes.peringkat_description AS peringkat_kes',
                                'spk__ikes.ikes_bil_terlibat AS bil_terlibat',
                                DB::raw("CASE spk__ikes.status_etnik_id
                                WHEN spk__ikes.status_etnik_id = 1 THEN 'Ya'
                                ELSE 'Tidak'
                                END AS status_etnik"))
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','spk__ikes.pbt_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kluster_id')
                        ->leftJoin('ref__spk_kategori_kes','ref__spk_kategori_kes.id','=','spk__ikes.kategori_id')
                        ->leftJoin('ref__spk_peringkat_kes','ref__spk_peringkat_kes.id','=','spk__ikes.peringkat_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->where('spk__ikes.state_id', '=', Auth::user()->state_id)
                        ->orderBy('spk__ikes.dihantar_date')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $daerah     = RefDaerah::where('status', '=',  true)
                            ->where('ref__daerahs.state_id', '=', Auth::user()->state_id)    
                            ->get();
                $parlimen   = RefParlimen::where('status', '=',  true)
                            ->where('ref__parlimens.state_id', '=', Auth::user()->state_id)    
                            ->get();
            return view('rt-sm32.laporan-ikes-ppmk',compact('roles_menu','daerah','parlimen'));
        }
    }

    function laporan_ikes_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes')
                        ->select('spk__ikes.id AS id',
                                DB::raw("DATE_FORMAT(spk__ikes.dihantar_date,'%d/%m/%Y') AS tarikh_report"),
                                DB::raw("CASE 
                                WHEN day(spk__ikes.dihantar_date) < 8 THEN 'Minggu 1'
                                WHEN day(spk__ikes.dihantar_date) < 15 THEN 'Minggu 2'
                                WHEN day(spk__ikes.dihantar_date) < 22 THEN 'Minggu 3'
                                ELSE 'Minggu 4'
                                END AS minggu_report"),
                                DB::raw("Month(spk__ikes.dihantar_date) AS bulan_report"),
                                'ref__states.state_description AS negeri',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__duns.dun_description AS dun',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__pbts.pbt_description AS pbt',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'spk__ikes.ikes_keterangan_kes AS keterangan_kes',
                                'ref__spk_kategori_kes.kategori_description As kategori_kes',
                                'ref__spk_peringkat_kes.peringkat_description AS peringkat_kes',
                                'spk__ikes.ikes_bil_terlibat AS bil_terlibat',
                                DB::raw("CASE spk__ikes.status_etnik_id
                                WHEN spk__ikes.status_etnik_id = 1 THEN 'Ya'
                                ELSE 'Tidak'
                                END AS status_etnik"))
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','spk__ikes.pbt_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kluster_id')
                        ->leftJoin('ref__spk_kategori_kes','ref__spk_kategori_kes.id','=','spk__ikes.kategori_id')
                        ->leftJoin('ref__spk_peringkat_kes','ref__spk_peringkat_kes.id','=','spk__ikes.peringkat_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->where('spk__ikes.state_id', '=', Auth::user()->state_id)
                        ->orderBy('spk__ikes.dihantar_date')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $daerah     = RefDaerah::where('status', '=',  true)
                            ->where('ref__daerahs.state_id', '=', Auth::user()->state_id)    
                            ->get();
                $parlimen   = RefParlimen::where('status', '=',  true)
                            ->where('ref__parlimens.state_id', '=', Auth::user()->state_id)    
                            ->get();
            return view('rt-sm32.laporan-ikes-ppn',compact('roles_menu','daerah','parlimen'));
        }
    }
    
    function laporan_ikes_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes')
                        ->select('spk__ikes.id AS id',
                                DB::raw("DATE_FORMAT(spk__ikes.dihantar_date,'%d/%m/%Y') AS tarikh_report"),
                                DB::raw("CASE 
                                WHEN day(spk__ikes.dihantar_date) < 8 THEN 'Minggu 1'
                                WHEN day(spk__ikes.dihantar_date) < 15 THEN 'Minggu 2'
                                WHEN day(spk__ikes.dihantar_date) < 22 THEN 'Minggu 3'
                                ELSE 'Minggu 4'
                                END AS minggu_report"),
                                DB::raw("Month(spk__ikes.dihantar_date) AS bulan_report"),
                                'ref__states.state_description AS negeri',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__duns.dun_description AS dun',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__pbts.pbt_description AS pbt',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'spk__ikes.ikes_keterangan_kes AS keterangan_kes',
                                'ref__spk_kategori_kes.kategori_description As kategori_kes',
                                'ref__spk_peringkat_kes.peringkat_description AS peringkat_kes',
                                'spk__ikes.ikes_bil_terlibat AS bil_terlibat',
                                DB::raw("CASE spk__ikes.status_etnik_id
                                WHEN spk__ikes.status_etnik_id = 1 THEN 'Ya'
                                ELSE 'Tidak'
                                END AS status_etnik"))
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','spk__ikes.pbt_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kluster_id')
                        ->leftJoin('ref__spk_kategori_kes','ref__spk_kategori_kes.id','=','spk__ikes.kategori_id')
                        ->leftJoin('ref__spk_peringkat_kes','ref__spk_peringkat_kes.id','=','spk__ikes.peringkat_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->orderBy('spk__ikes.dihantar_date')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-ikes-bpp',compact('roles_menu','state'));
        }
    }

    function laporan_ikes_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes')
                        ->select('spk__ikes.id AS id',
                                DB::raw("DATE_FORMAT(spk__ikes.dihantar_date,'%d/%m/%Y') AS tarikh_report"),
                                DB::raw("CASE 
                                WHEN day(spk__ikes.dihantar_date) < 8 THEN 'Minggu 1'
                                WHEN day(spk__ikes.dihantar_date) < 15 THEN 'Minggu 2'
                                WHEN day(spk__ikes.dihantar_date) < 22 THEN 'Minggu 3'
                                ELSE 'Minggu 4'
                                END AS minggu_report"),
                                DB::raw("Month(spk__ikes.dihantar_date) AS bulan_report"),
                                'ref__states.state_description AS negeri',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__duns.dun_description AS dun',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__pbts.pbt_description AS pbt',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'spk__ikes.ikes_keterangan_kes AS keterangan_kes',
                                'ref__spk_kategori_kes.kategori_description As kategori_kes',
                                'ref__spk_peringkat_kes.peringkat_description AS peringkat_kes',
                                'spk__ikes.ikes_bil_terlibat AS bil_terlibat',
                                DB::raw("CASE spk__ikes.status_etnik_id
                                WHEN spk__ikes.status_etnik_id = 1 THEN 'Ya'
                                ELSE 'Tidak'
                                END AS status_etnik"))
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','spk__ikes.pbt_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kluster_id')
                        ->leftJoin('ref__spk_kategori_kes','ref__spk_kategori_kes.id','=','spk__ikes.kategori_id')
                        ->leftJoin('ref__spk_peringkat_kes','ref__spk_peringkat_kes.id','=','spk__ikes.peringkat_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->orderBy('spk__ikes.dihantar_date')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-ikes-p',compact('roles_menu','state'));
        }
    }

    function laporan_ikes_tkpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes')
                        ->select('spk__ikes.id AS id',
                                DB::raw("DATE_FORMAT(spk__ikes.dihantar_date,'%d/%m/%Y') AS tarikh_report"),
                                DB::raw("CASE 
                                WHEN day(spk__ikes.dihantar_date) < 8 THEN 'Minggu 1'
                                WHEN day(spk__ikes.dihantar_date) < 15 THEN 'Minggu 2'
                                WHEN day(spk__ikes.dihantar_date) < 22 THEN 'Minggu 3'
                                ELSE 'Minggu 4'
                                END AS minggu_report"),
                                DB::raw("Month(spk__ikes.dihantar_date) AS bulan_report"),
                                'ref__states.state_description AS negeri',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__duns.dun_description AS dun',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__pbts.pbt_description AS pbt',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'spk__ikes.ikes_keterangan_kes AS keterangan_kes',
                                'ref__spk_kategori_kes.kategori_description As kategori_kes',
                                'ref__spk_peringkat_kes.peringkat_description AS peringkat_kes',
                                'spk__ikes.ikes_bil_terlibat AS bil_terlibat',
                                DB::raw("CASE spk__ikes.status_etnik_id
                                WHEN spk__ikes.status_etnik_id = 1 THEN 'Ya'
                                ELSE 'Tidak'
                                END AS status_etnik"))
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','spk__ikes.pbt_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kluster_id')
                        ->leftJoin('ref__spk_kategori_kes','ref__spk_kategori_kes.id','=','spk__ikes.kategori_id')
                        ->leftJoin('ref__spk_peringkat_kes','ref__spk_peringkat_kes.id','=','spk__ikes.peringkat_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->orderBy('spk__ikes.dihantar_date')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-ikes-tkpp',compact('roles_menu','state'));
        }
    }

    function laporan_ikes_kp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes')
                        ->select('spk__ikes.id AS id',
                                DB::raw("DATE_FORMAT(spk__ikes.dihantar_date,'%d/%m/%Y') AS tarikh_report"),
                                DB::raw("CASE 
                                WHEN day(spk__ikes.dihantar_date) < 8 THEN 'Minggu 1'
                                WHEN day(spk__ikes.dihantar_date) < 15 THEN 'Minggu 2'
                                WHEN day(spk__ikes.dihantar_date) < 22 THEN 'Minggu 3'
                                ELSE 'Minggu 4'
                                END AS minggu_report"),
                                DB::raw("Month(spk__ikes.dihantar_date) AS bulan_report"),
                                'ref__states.state_description AS negeri',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__duns.dun_description AS dun',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__pbts.pbt_description AS pbt',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'spk__ikes.ikes_keterangan_kes AS keterangan_kes',
                                'ref__spk_kategori_kes.kategori_description As kategori_kes',
                                'ref__spk_peringkat_kes.peringkat_description AS peringkat_kes',
                                'spk__ikes.ikes_bil_terlibat AS bil_terlibat',
                                DB::raw("CASE spk__ikes.status_etnik_id
                                WHEN spk__ikes.status_etnik_id = 1 THEN 'Ya'
                                ELSE 'Tidak'
                                END AS status_etnik"))
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','spk__ikes.pbt_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kluster_id')
                        ->leftJoin('ref__spk_kategori_kes','ref__spk_kategori_kes.id','=','spk__ikes.kategori_id')
                        ->leftJoin('ref__spk_peringkat_kes','ref__spk_peringkat_kes.id','=','spk__ikes.peringkat_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->orderBy('spk__ikes.dihantar_date')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-ikes-kp',compact('roles_menu','state'));
        }
    }

    function laporan_ikes_kpn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__ikes')
                        ->select('spk__ikes.id AS id',
                                DB::raw("DATE_FORMAT(spk__ikes.dihantar_date,'%d/%m/%Y') AS tarikh_report"),
                                DB::raw("CASE 
                                WHEN day(spk__ikes.dihantar_date) < 8 THEN 'Minggu 1'
                                WHEN day(spk__ikes.dihantar_date) < 15 THEN 'Minggu 2'
                                WHEN day(spk__ikes.dihantar_date) < 22 THEN 'Minggu 3'
                                ELSE 'Minggu 4'
                                END AS minggu_report"),
                                DB::raw("Month(spk__ikes.dihantar_date) AS bulan_report"),
                                'ref__states.state_description AS negeri',
                                'ref__daerahs.daerah_description AS daerah',
                                'ref__duns.dun_description AS dun',
                                'ref__parlimens.parlimen_description AS parlimen',
                                'ref__pbts.pbt_description AS pbt',
                                'spk__ikes.ikes_kawasan AS kawasan',
                                'ref__spk_ikes_kluster.kluster_description AS kluster',
                                'ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster',
                                'spk__ikes.ikes_keterangan_kes AS keterangan_kes',
                                'ref__spk_kategori_kes.kategori_description As kategori_kes',
                                'ref__spk_peringkat_kes.peringkat_description AS peringkat_kes',
                                'spk__ikes.ikes_bil_terlibat AS bil_terlibat',
                                DB::raw("CASE spk__ikes.status_etnik_id
                                WHEN spk__ikes.status_etnik_id = 1 THEN 'Ya'
                                ELSE 'Tidak'
                                END AS status_etnik"))
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__ikes.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__ikes.daerah_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__ikes.dun_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__ikes.parlimen_id')
                        ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','spk__ikes.pbt_id')
                        ->leftJoin('ref__spk_ikes_kluster','ref__spk_ikes_kluster.id','=','spk__ikes.kluster_id')
                        ->leftJoin('ref__spk_ikes_sub_kluster','ref__spk_ikes_sub_kluster.id','=','spk__ikes.sub_kluster_id')
                        ->leftJoin('ref__spk_kategori_kes','ref__spk_kategori_kes.id','=','spk__ikes.kategori_id')
                        ->leftJoin('ref__spk_peringkat_kes','ref__spk_peringkat_kes.id','=','spk__ikes.peringkat_id')
                        ->whereIN('spk__ikes.status',[1])
                        ->orderBy('spk__ikes.dihantar_date')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-ikes-kpn',compact('roles_menu','state'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_imuhibbah_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::table('spk__imuhibbah')
                        ->select('spk__imuhibbah.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'spk__imuhibbah.imuhibbah_kawasan AS kawasan',
                                'spk__imuhibbah.imuhibbah_tajuk AS tajuk',
                                DB::raw("DATE_FORMAT(spk__imuhibbah_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                DB::raw("DATE_FORMAT(spk__imuhibbah_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"),
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                'spk__imuhibbah_ts.keterangan_tindakan AS tindakan',
                                'ref__status_spk_imuhibbah.status_description AS status')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__imuhibbah.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__imuhibbah.daerah_id')
                        ->leftJoin('spk__imuhibbah_at','spk__imuhibbah_at.spk_imuhibbah_id','=','spk__imuhibbah.id')
                        ->leftJoin('spk__imuhibbah_ts','spk__imuhibbah_ts.spk_imuhibbah_at_id','=','spk__imuhibbah_at.id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__imuhibbah_at.jenis_arahan_id')
                        ->leftJoin('ref__status_spk_imuhibbah','ref__status_spk_imuhibbah.id','=','spk__imuhibbah.status')
                        ->whereIN('spk__imuhibbah.status',[1])
                        ->where('spk__imuhibbah.daerah_id', '=', Auth::user()->daerah_id)
                        ->orderBy('spk__imuhibbah.id')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                    $roles_menu     = DB::table('roles__menu')
                        ->select('roles__menu.id AS id',
                        'users__menu.menu_id AS first_menu',
                        'users__menu.menu2nd_id AS second_menu',
                        'users__menu.users_menu_page_name AS nama_menu',
                        'users__menu.users_menu_file_url AS menu_url',
                        'users__menu.highlight AS highlight_menu',
                        'users__menu.users_menu_page_icon AS icon_menu')
                        ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                        ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                        ->where('users__roles.user_id', '=', Auth::user()->user_id)
                        ->where('roles__menu.status', '=', true)
                        ->orderBy('first_menu', 'asc')
                        ->orderBy('id', 'asc')
                        ->get();
            return view('rt-sm32.laporan-imuhibbah-ppd',compact('roles_menu'));
        }
    }

    function laporan_imuhibbah_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__imuhibbah')
                        ->select('spk__imuhibbah.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'spk__imuhibbah.imuhibbah_kawasan AS kawasan',
                                'spk__imuhibbah.imuhibbah_tajuk AS tajuk',
                                DB::raw("DATE_FORMAT(spk__imuhibbah_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                DB::raw("DATE_FORMAT(spk__imuhibbah_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"),
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                'spk__imuhibbah_ts.keterangan_tindakan AS tindakan',
                                'ref__status_spk_imuhibbah.status_description AS status')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__imuhibbah.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__imuhibbah.daerah_id')
                        ->leftJoin('spk__imuhibbah_at','spk__imuhibbah_at.spk_imuhibbah_id','=','spk__imuhibbah.id')
                        ->leftJoin('spk__imuhibbah_ts','spk__imuhibbah_ts.spk_imuhibbah_at_id','=','spk__imuhibbah_at.id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__imuhibbah_at.jenis_arahan_id')
                        ->leftJoin('ref__status_spk_imuhibbah','ref__status_spk_imuhibbah.id','=','spk__imuhibbah.status')
                        ->whereIN('spk__imuhibbah.status',[1])
                        ->where('spk__imuhibbah.state_id', '=', Auth::user()->state_id)
                        ->orderBy('spk__imuhibbah.id')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                        ->select('roles__menu.id AS id',
                        'users__menu.menu_id AS first_menu',
                        'users__menu.menu2nd_id AS second_menu',
                        'users__menu.users_menu_page_name AS nama_menu',
                        'users__menu.users_menu_file_url AS menu_url',
                        'users__menu.highlight AS highlight_menu',
                        'users__menu.users_menu_page_icon AS icon_menu')
                        ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                        ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                        ->where('users__roles.user_id', '=', Auth::user()->user_id)
                        ->where('roles__menu.status', '=', true)
                        ->orderBy('first_menu', 'asc')
                        ->orderBy('id', 'asc')
                        ->get();
                $daerah     = RefDaerah::where('status', '=',  true)
                            ->where('ref__daerahs.state_id', '=', Auth::user()->state_id)    
                            ->get();
                $parlimen   = RefParlimen::where('status', '=',  true)
                            ->where('ref__parlimens.state_id', '=', Auth::user()->state_id)    
                            ->get();
            return view('rt-sm32.laporan-imuhibbah-ppmk',compact('roles_menu','daerah','parlimen'));
        }
    }

    function laporan_imuhibbah_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__imuhibbah')
                        ->select('spk__imuhibbah.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'spk__imuhibbah.imuhibbah_kawasan AS kawasan',
                                'spk__imuhibbah.imuhibbah_tajuk AS tajuk',
                                DB::raw("DATE_FORMAT(spk__imuhibbah_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                DB::raw("DATE_FORMAT(spk__imuhibbah_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"),
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                'spk__imuhibbah_ts.keterangan_tindakan AS tindakan',
                                'ref__status_spk_imuhibbah.status_description AS status')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__imuhibbah.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__imuhibbah.daerah_id')
                        ->leftJoin('spk__imuhibbah_at','spk__imuhibbah_at.spk_imuhibbah_id','=','spk__imuhibbah.id')
                        ->leftJoin('spk__imuhibbah_ts','spk__imuhibbah_ts.spk_imuhibbah_at_id','=','spk__imuhibbah_at.id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__imuhibbah_at.jenis_arahan_id')
                        ->leftJoin('ref__status_spk_imuhibbah','ref__status_spk_imuhibbah.id','=','spk__imuhibbah.status')
                        ->whereIN('spk__imuhibbah.status',[1])
                        ->where('spk__imuhibbah.state_id', '=', Auth::user()->state_id)
                        ->orderBy('spk__imuhibbah.id')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                        ->select('roles__menu.id AS id',
                        'users__menu.menu_id AS first_menu',
                        'users__menu.menu2nd_id AS second_menu',
                        'users__menu.users_menu_page_name AS nama_menu',
                        'users__menu.users_menu_file_url AS menu_url',
                        'users__menu.highlight AS highlight_menu',
                        'users__menu.users_menu_page_icon AS icon_menu')
                        ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                        ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                        ->where('users__roles.user_id', '=', Auth::user()->user_id)
                        ->where('roles__menu.status', '=', true)
                        ->orderBy('first_menu', 'asc')
                        ->orderBy('id', 'asc')
                        ->get();
                $daerah     = RefDaerah::where('status', '=',  true)
                            ->where('ref__daerahs.state_id', '=', Auth::user()->state_id)    
                            ->get();
                $parlimen   = RefParlimen::where('status', '=',  true)
                            ->where('ref__parlimens.state_id', '=', Auth::user()->state_id)    
                            ->get();
            return view('rt-sm32.laporan-imuhibbah-ppn',compact('roles_menu','daerah','parlimen'));
        }
    }
    
    function laporan_imuhibbah_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__imuhibbah')
                        ->select('spk__imuhibbah.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'spk__imuhibbah.imuhibbah_kawasan AS kawasan',
                                'spk__imuhibbah.imuhibbah_tajuk AS tajuk',
                                DB::raw("DATE_FORMAT(spk__imuhibbah_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                DB::raw("DATE_FORMAT(spk__imuhibbah_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"),
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                'spk__imuhibbah_ts.keterangan_tindakan AS tindakan',
                                'ref__status_spk_imuhibbah.status_description AS status')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__imuhibbah.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__imuhibbah.daerah_id')
                        ->leftJoin('spk__imuhibbah_at','spk__imuhibbah_at.spk_imuhibbah_id','=','spk__imuhibbah.id')
                        ->leftJoin('spk__imuhibbah_ts','spk__imuhibbah_ts.spk_imuhibbah_at_id','=','spk__imuhibbah_at.id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__imuhibbah_at.jenis_arahan_id')
                        ->leftJoin('ref__status_spk_imuhibbah','ref__status_spk_imuhibbah.id','=','spk__imuhibbah.status')
                        ->whereIN('spk__imuhibbah.status',[1])
                        ->orderBy('spk__imuhibbah.id')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                    $roles_menu     = DB::table('roles__menu')
                        ->select('roles__menu.id AS id',
                        'users__menu.menu_id AS first_menu',
                        'users__menu.menu2nd_id AS second_menu',
                        'users__menu.users_menu_page_name AS nama_menu',
                        'users__menu.users_menu_file_url AS menu_url',
                        'users__menu.highlight AS highlight_menu',
                        'users__menu.users_menu_page_icon AS icon_menu')
                        ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                        ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                        ->where('users__roles.user_id', '=', Auth::user()->user_id)
                        ->where('roles__menu.status', '=', true)
                        ->orderBy('first_menu', 'asc')
                        ->orderBy('id', 'asc')
                        ->get();
                    $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-imuhibbah-bpp',compact('roles_menu','state'));
        }
    }

    function laporan_imuhibbah_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__imuhibbah')
                        ->select('spk__imuhibbah.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'spk__imuhibbah.imuhibbah_kawasan AS kawasan',
                                'spk__imuhibbah.imuhibbah_tajuk AS tajuk',
                                DB::raw("DATE_FORMAT(spk__imuhibbah_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                DB::raw("DATE_FORMAT(spk__imuhibbah_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"),
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                'spk__imuhibbah_ts.keterangan_tindakan AS tindakan',
                                'ref__status_spk_imuhibbah.status_description AS status')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__imuhibbah.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__imuhibbah.daerah_id')
                        ->leftJoin('spk__imuhibbah_at','spk__imuhibbah_at.spk_imuhibbah_id','=','spk__imuhibbah.id')
                        ->leftJoin('spk__imuhibbah_ts','spk__imuhibbah_ts.spk_imuhibbah_at_id','=','spk__imuhibbah_at.id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__imuhibbah_at.jenis_arahan_id')
                        ->leftJoin('ref__status_spk_imuhibbah','ref__status_spk_imuhibbah.id','=','spk__imuhibbah.status')
                        ->whereIN('spk__imuhibbah.status',[1])
                        ->orderBy('spk__imuhibbah.id')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-imuhibbah-p',compact('roles_menu','state'));
        }
    }

    function laporan_imuhibbah_tkpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__imuhibbah')
                        ->select('spk__imuhibbah.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'spk__imuhibbah.imuhibbah_kawasan AS kawasan',
                                'spk__imuhibbah.imuhibbah_tajuk AS tajuk',
                                DB::raw("DATE_FORMAT(spk__imuhibbah_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                DB::raw("DATE_FORMAT(spk__imuhibbah_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"),
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                'spk__imuhibbah_ts.keterangan_tindakan AS tindakan',
                                'ref__status_spk_imuhibbah.status_description AS status')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__imuhibbah.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__imuhibbah.daerah_id')
                        ->leftJoin('spk__imuhibbah_at','spk__imuhibbah_at.spk_imuhibbah_id','=','spk__imuhibbah.id')
                        ->leftJoin('spk__imuhibbah_ts','spk__imuhibbah_ts.spk_imuhibbah_at_id','=','spk__imuhibbah_at.id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__imuhibbah_at.jenis_arahan_id')
                        ->leftJoin('ref__status_spk_imuhibbah','ref__status_spk_imuhibbah.id','=','spk__imuhibbah.status')
                        ->whereIN('spk__imuhibbah.status',[1])
                        ->orderBy('spk__imuhibbah.id')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-imuhibbah-tkpp',compact('roles_menu','state'));
        }
    }

    function laporan_imuhibbah_kp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__imuhibbah')
                        ->select('spk__imuhibbah.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'spk__imuhibbah.imuhibbah_kawasan AS kawasan',
                                'spk__imuhibbah.imuhibbah_tajuk AS tajuk',
                                DB::raw("DATE_FORMAT(spk__imuhibbah_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                DB::raw("DATE_FORMAT(spk__imuhibbah_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"),
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                'spk__imuhibbah_ts.keterangan_tindakan AS tindakan',
                                'ref__status_spk_imuhibbah.status_description AS status')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__imuhibbah.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__imuhibbah.daerah_id')
                        ->leftJoin('spk__imuhibbah_at','spk__imuhibbah_at.spk_imuhibbah_id','=','spk__imuhibbah.id')
                        ->leftJoin('spk__imuhibbah_ts','spk__imuhibbah_ts.spk_imuhibbah_at_id','=','spk__imuhibbah_at.id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__imuhibbah_at.jenis_arahan_id')
                        ->leftJoin('ref__status_spk_imuhibbah','ref__status_spk_imuhibbah.id','=','spk__imuhibbah.status')
                        ->whereIN('spk__imuhibbah.status',[1])
                        ->orderBy('spk__imuhibbah.id')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-imuhibbah-kp',compact('roles_menu','state'));
        }
    }

    function laporan_imuhibbah_kpn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__imuhibbah')
                        ->select('spk__imuhibbah.id AS id',
                                'ref__states.state_description AS state',
                                'ref__daerahs.daerah_description AS daerah',
                                'spk__imuhibbah.imuhibbah_kawasan AS kawasan',
                                'spk__imuhibbah.imuhibbah_tajuk AS tajuk',
                                DB::raw("DATE_FORMAT(spk__imuhibbah_at.tarikh_arahan,'%d/%m/%Y') AS tarikh_arahan"),
                                DB::raw("DATE_FORMAT(spk__imuhibbah_ts.tarikh_tindakan,'%d/%m/%Y') AS tarikh_tindakan"),
                                'ref__spk_ikes_at_jenis.jenis_description AS jenis_arahan',
                                'spk__imuhibbah_ts.keterangan_tindakan AS tindakan',
                                'ref__status_spk_imuhibbah.status_description AS status')
                        ->leftJoin('ref__states','ref__states.state_id','=','spk__imuhibbah.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','spk__imuhibbah.daerah_id')
                        ->leftJoin('spk__imuhibbah_at','spk__imuhibbah_at.spk_imuhibbah_id','=','spk__imuhibbah.id')
                        ->leftJoin('spk__imuhibbah_ts','spk__imuhibbah_ts.spk_imuhibbah_at_id','=','spk__imuhibbah_at.id')
                        ->leftJoin('ref__spk_ikes_at_jenis','ref__spk_ikes_at_jenis.id','=','spk__imuhibbah_at.jenis_arahan_id')
                        ->leftJoin('ref__status_spk_imuhibbah','ref__status_spk_imuhibbah.id','=','spk__imuhibbah.status')
                        ->whereIN('spk__imuhibbah.status',[1])
                        ->orderBy('spk__imuhibbah.id')
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-imuhibbah-kpn',compact('roles_menu','state'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_bulanan_ikes_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__month.month_description AS month,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__month
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) a on a.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) b on b.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) c on c.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_1 on d_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_2 on d_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_3 on d_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_4 on d_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_5 on d_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) e on e.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_1 on f_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_2 on f_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_3 on f_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_4 on f_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_5 on f_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_6 on f_6.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) g on g.ikes_month = ref__month.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu = DB::table('roles__menu')
                ->select('roles__menu.id AS id',
                    'users__menu.menu_id AS first_menu',
                    'users__menu.menu2nd_id AS second_menu',
                    'users__menu.users_menu_page_name AS nama_menu',
                    'users__menu.users_menu_file_url AS menu_url',
                    'users__menu.highlight AS highlight_menu',
                    'users__menu.users_menu_page_icon AS icon_menu')
                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                ->where('roles__menu.status', '=', true)
                ->orderBy('first_menu', 'asc')
                ->orderBy('id', 'asc')
                ->get();
            return view('rt-sm32.laporan-bulanan-ikes-ppd',compact('roles_menu'));
        }
    }

    function laporan_bulanan_ikes_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                ref__month.month_description AS month,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__month
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) a on a.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) b on b.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) c on c.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_1 on d_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_2 on d_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_3 on d_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_4 on d_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_5 on d_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) e on e.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_1 on f_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_2 on f_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_3 on f_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_4 on f_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_5 on f_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_6 on f_6.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) g on g.ikes_month = ref__month.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu = DB::table('roles__menu')
                ->select('roles__menu.id AS id',
                    'users__menu.menu_id AS first_menu',
                    'users__menu.menu2nd_id AS second_menu',
                    'users__menu.users_menu_page_name AS nama_menu',
                    'users__menu.users_menu_file_url AS menu_url',
                    'users__menu.highlight AS highlight_menu',
                    'users__menu.users_menu_page_icon AS icon_menu')
                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                ->where('roles__menu.status', '=', true)
                ->orderBy('first_menu', 'asc')
                ->orderBy('id', 'asc')
                ->get();
            return view('rt-sm32.laporan-bulanan-ikes-ppmk',compact('roles_menu'));
        }
    }

    function laporan_bulanan_ikes_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                ref__month.month_description AS month,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__month
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) a on a.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) b on b.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) c on c.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_1 on d_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_2 on d_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_3 on d_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_4 on d_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_5 on d_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) e on e.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_1 on f_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_2 on f_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_3 on f_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_4 on f_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_5 on f_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_6 on f_6.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE()) and spk__ikes.state_id = '" . Auth::user()->state_id . "'
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) g on g.ikes_month = ref__month.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu = DB::table('roles__menu')
                ->select('roles__menu.id AS id',
                    'users__menu.menu_id AS first_menu',
                    'users__menu.menu2nd_id AS second_menu',
                    'users__menu.users_menu_page_name AS nama_menu',
                    'users__menu.users_menu_file_url AS menu_url',
                    'users__menu.highlight AS highlight_menu',
                    'users__menu.users_menu_page_icon AS icon_menu')
                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                ->where('roles__menu.status', '=', true)
                ->orderBy('first_menu', 'asc')
                ->orderBy('id', 'asc')
                ->get();
            return view('rt-sm32.laporan-bulanan-ikes-ppn',compact('roles_menu'));
        }
    }

    function laporan_bulanan_ikes_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                ref__month.month_description AS month,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__month
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) a on a.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) b on b.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) c on c.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_1 on d_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_2 on d_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_3 on d_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_4 on d_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_5 on d_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) e on e.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_1 on f_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_2 on f_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_3 on f_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_4 on f_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_5 on f_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_6 on f_6.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) g on g.ikes_month = ref__month.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu = DB::table('roles__menu')
                ->select('roles__menu.id AS id',
                    'users__menu.menu_id AS first_menu',
                    'users__menu.menu2nd_id AS second_menu',
                    'users__menu.users_menu_page_name AS nama_menu',
                    'users__menu.users_menu_file_url AS menu_url',
                    'users__menu.highlight AS highlight_menu',
                    'users__menu.users_menu_page_icon AS icon_menu')
                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                ->where('roles__menu.status', '=', true)
                ->orderBy('first_menu', 'asc')
                ->orderBy('id', 'asc')
                ->get();
            return view('rt-sm32.laporan-bulanan-ikes-bpp',compact('roles_menu'));
        }
    }

    function laporan_bulanan_ikes_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                ref__month.month_description AS month,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__month
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) a on a.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) b on b.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) c on c.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_1 on d_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_2 on d_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_3 on d_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_4 on d_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_5 on d_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) e on e.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_1 on f_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_2 on f_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_3 on f_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_4 on f_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_5 on f_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_6 on f_6.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) g on g.ikes_month = ref__month.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu = DB::table('roles__menu')
                ->select('roles__menu.id AS id',
                    'users__menu.menu_id AS first_menu',
                    'users__menu.menu2nd_id AS second_menu',
                    'users__menu.users_menu_page_name AS nama_menu',
                    'users__menu.users_menu_file_url AS menu_url',
                    'users__menu.highlight AS highlight_menu',
                    'users__menu.users_menu_page_icon AS icon_menu')
                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                ->where('roles__menu.status', '=', true)
                ->orderBy('first_menu', 'asc')
                ->orderBy('id', 'asc')
                ->get();
            return view('rt-sm32.laporan-bulanan-ikes-p',compact('roles_menu'));
        }
    }

    function laporan_bulanan_ikes_tkpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                ref__month.month_description AS month,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__month
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) a on a.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) b on b.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) c on c.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_1 on d_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_2 on d_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_3 on d_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_4 on d_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_5 on d_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) e on e.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_1 on f_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_2 on f_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_3 on f_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_4 on f_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_5 on f_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_6 on f_6.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) g on g.ikes_month = ref__month.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu = DB::table('roles__menu')
                ->select('roles__menu.id AS id',
                    'users__menu.menu_id AS first_menu',
                    'users__menu.menu2nd_id AS second_menu',
                    'users__menu.users_menu_page_name AS nama_menu',
                    'users__menu.users_menu_file_url AS menu_url',
                    'users__menu.highlight AS highlight_menu',
                    'users__menu.users_menu_page_icon AS icon_menu')
                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                ->where('roles__menu.status', '=', true)
                ->orderBy('first_menu', 'asc')
                ->orderBy('id', 'asc')
                ->get();
            return view('rt-sm32.laporan-bulanan-ikes-tkpp',compact('roles_menu'));
        }
    }

    function laporan_bulanan_ikes_kp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                ref__month.month_description AS month,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__month
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) a on a.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) b on b.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) c on c.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_1 on d_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_2 on d_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_3 on d_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_4 on d_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_5 on d_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) e on e.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_1 on f_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_2 on f_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_3 on f_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_4 on f_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_5 on f_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_6 on f_6.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) g on g.ikes_month = ref__month.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu = DB::table('roles__menu')
                ->select('roles__menu.id AS id',
                    'users__menu.menu_id AS first_menu',
                    'users__menu.menu2nd_id AS second_menu',
                    'users__menu.users_menu_page_name AS nama_menu',
                    'users__menu.users_menu_file_url AS menu_url',
                    'users__menu.highlight AS highlight_menu',
                    'users__menu.users_menu_page_icon AS icon_menu')
                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                ->where('roles__menu.status', '=', true)
                ->orderBy('first_menu', 'asc')
                ->orderBy('id', 'asc')
                ->get();
            return view('rt-sm32.laporan-bulanan-ikes-kp',compact('roles_menu'));
        }
    }

    function laporan_bulanan_ikes_kpn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                ref__month.month_description AS month,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__month
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) a on a.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) b on b.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) c on c.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_1 on d_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_2 on d_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_3 on d_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_4 on d_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) d_5 on d_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) e on e.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_1 on f_1.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_2 on f_2.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_3 on f_3.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_4 on f_4.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_5 on f_5.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) f_6 on f_6.ikes_month = ref__month.id
                LEFT JOIN (
                    SELECT
                        MONTH(spk__ikes.ikes_tarikh_berlaku) AS ikes_month,
                        count(*) AS total
                    FROM spk__ikes 
                    WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and spk__ikes.ikes_tarikh_berlaku = YEAR(CURDATE())
                    GROUP BY spk__ikes.ikes_tarikh_berlaku
                ) g on g.ikes_month = ref__month.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu = DB::table('roles__menu')
                ->select('roles__menu.id AS id',
                    'users__menu.menu_id AS first_menu',
                    'users__menu.menu2nd_id AS second_menu',
                    'users__menu.users_menu_page_name AS nama_menu',
                    'users__menu.users_menu_file_url AS menu_url',
                    'users__menu.highlight AS highlight_menu',
                    'users__menu.users_menu_page_icon AS icon_menu')
                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                ->where('roles__menu.status', '=', true)
                ->orderBy('first_menu', 'asc')
                ->orderBy('id', 'asc')
                ->get();
            return view('rt-sm32.laporan-bulanan-ikes-kpn',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_ikes_kategori_s_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) a on a.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) b on b.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) c on c.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) e on e.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_6 on f_6.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) g on g.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu = DB::table('roles__menu')
                ->select('roles__menu.id AS id',
                    'users__menu.menu_id AS first_menu',
                    'users__menu.menu2nd_id AS second_menu',
                    'users__menu.users_menu_page_name AS nama_menu',
                    'users__menu.users_menu_file_url AS menu_url',
                    'users__menu.highlight AS highlight_menu',
                    'users__menu.users_menu_page_icon AS icon_menu')
                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                ->where('roles__menu.status', '=', true)
                ->orderBy('first_menu', 'asc')
                ->orderBy('id', 'asc')
                ->get();
            return view('rt-sm32.laporan-ikes-kategori-s-ppd',compact('roles_menu'));
        }
    }

    function laporan_ikes_kategori_s_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) a on a.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) b on b.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) c on c.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) e on e.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_6 on f_6.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) g on g.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kategori-s-ppn',compact('roles_menu'));
        }
    }

    function laporan_ikes_kategori_s_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) a on a.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) b on b.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) c on c.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) e on e.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_6 on f_6.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) g on g.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kategori-s-bpp',compact('roles_menu'));
        }
    }

    function laporan_ikes_kategori_s_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) a on a.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) b on b.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) c on c.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) e on e.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_6 on f_6.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) g on g.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kategori-s-p',compact('roles_menu'));
        }
    }

    function laporan_ikes_kategori_s_tkpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) a on a.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) b on b.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) c on c.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) e on e.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_6 on f_6.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) g on g.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kategori-s-tkpp',compact('roles_menu'));
        }
    }

    function laporan_ikes_kategori_s_kp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) a on a.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) b on b.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) c on c.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) e on e.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_6 on f_6.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) g on g.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kategori-s-kp',compact('roles_menu'));
        }
    }

    function laporan_ikes_kategori_s_kpn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_keganasan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_rusuhan,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_demonstrasi,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_protes_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_protes_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_protes_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_protes_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_protes_5,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_pergaduhan,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_serangan_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_serangan_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_serangan_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_serangan_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_serangan_5,
                (case when f_6.total IS NOT NULL then f_6.total else 0 end)AS total_serangan_6,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_isu
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) a on a.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) b on b.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) c on c.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 1 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 2 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 3 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 4 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 5 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) e on e.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 7 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 8 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 9 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 10 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.sub_kategori_id = 11 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) f_6 on f_6.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_kategori_kes ON ref__spk_kategori_kes.id = spk__ikes.kategori_id
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id = 6 and YEAR(CURDATE())
                GROUP BY spk__ikes.state_id
            ) g on g.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kategori-s-kpn',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_ikes_chart_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
           
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-ppd',compact('roles_menu'));
        }
    }

    function laporan_ikes_chart_ppd_filter(Request $request, $months){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS name,
                (case when a.total IS NOT NULL then a.total else 0 end)AS y
                FROM ref__spk_ikes_kluster
            LEFT JOIN (
                SELECT
                spk__ikes.kluster_id AS kluster_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = $months and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.kluster_id
            ) a on a.kluster_id = ref__spk_ikes_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1"));
            return Datatables::of($data)
            ->make(true);
           
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-ppd',compact('roles_menu'));
        }
        
    }

    function laporan_ikes_chart_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-ppn',compact('roles_menu'));
        }
    }

    function laporan_ikes_chart_ppn_filter(Request $request, $months){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS name,
                (case when a.total IS NOT NULL then a.total else 0 end)AS y
                FROM ref__spk_ikes_kluster
            LEFT JOIN (
                SELECT
                spk__ikes.kluster_id AS kluster_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = $months and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.kluster_id
            ) a on a.kluster_id = ref__spk_ikes_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1"));
            return Datatables::of($data)
            ->make(true);
           
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-ppn',compact('roles_menu'));
        }
        
    }

    function laporan_ikes_chart_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-bpp',compact('roles_menu'));
        }
    }

    function laporan_ikes_chart_bpp_filter(Request $request, $months){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS name,
                (case when a.total IS NOT NULL then a.total else 0 end)AS y
                FROM ref__spk_ikes_kluster
            LEFT JOIN (
                SELECT
                spk__ikes.kluster_id AS kluster_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = $months and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.kluster_id
            ) a on a.kluster_id = ref__spk_ikes_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1"));
            return Datatables::of($data)
            ->make(true);
           
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-bpp',compact('roles_menu'));
        }
        
    }

    function laporan_ikes_chart_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-p',compact('roles_menu'));
        }
    }

    function laporan_ikes_chart_p_filter(Request $request, $months){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS name,
                (case when a.total IS NOT NULL then a.total else 0 end)AS y
                FROM ref__spk_ikes_kluster
            LEFT JOIN (
                SELECT
                spk__ikes.kluster_id AS kluster_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = $months and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.kluster_id
            ) a on a.kluster_id = ref__spk_ikes_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1"));
            return Datatables::of($data)
            ->make(true);
           
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-p',compact('roles_menu'));
        }
        
    }

    function laporan_ikes_chart_tkpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-tkpp',compact('roles_menu'));
        }
    }

    function laporan_ikes_chart_tkpp_filter(Request $request, $months){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS name,
                (case when a.total IS NOT NULL then a.total else 0 end)AS y
                FROM ref__spk_ikes_kluster
            LEFT JOIN (
                SELECT
                spk__ikes.kluster_id AS kluster_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = $months and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.kluster_id
            ) a on a.kluster_id = ref__spk_ikes_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1"));
            return Datatables::of($data)
            ->make(true);
           
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-tkpp',compact('roles_menu'));
        }
        
    }

    function laporan_ikes_chart_kp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-kp',compact('roles_menu'));
        }
    }

    function laporan_ikes_chart_kp_filter(Request $request, $months){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS name,
                (case when a.total IS NOT NULL then a.total else 0 end)AS y
                FROM ref__spk_ikes_kluster
            LEFT JOIN (
                SELECT
                spk__ikes.kluster_id AS kluster_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = $months and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.kluster_id
            ) a on a.kluster_id = ref__spk_ikes_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1"));
            return Datatables::of($data)
            ->make(true);
           
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-kp',compact('roles_menu'));
        }
        
    }

    function laporan_ikes_chart_kpn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-kpn',compact('roles_menu'));
        }
    }

    function laporan_ikes_chart_kpn_filter(Request $request, $months){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS name,
                (case when a.total IS NOT NULL then a.total else 0 end)AS y
                FROM ref__spk_ikes_kluster
            LEFT JOIN (
                SELECT
                spk__ikes.kluster_id AS kluster_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = $months and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.kluster_id
            ) a on a.kluster_id = ref__spk_ikes_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1"));
            return Datatables::of($data)
            ->make(true);
           
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-chart-kpn',compact('roles_menu'));
        }
        
    }
    
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_berisiko_ikes_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total >= 5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-ppd',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_2_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3 and purata.total >=5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-ppd',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_3_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-ppd',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total >= 5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-2-ppn',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_2_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3 and purata.total >=5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-ppn',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_3_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-ppn',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3 and purata.total >=5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-bpp',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_2_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3 and purata.total >=5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-bpp',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_3_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-bpp',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3 and purata.total >=5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-p',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_2_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3 and purata.total >=5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-p',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_3_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-p',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_tkpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3 and purata.total >=5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-tkpp',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_2_tkpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3 and purata.total >=5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-tkpp',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_3_tkpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-tkpp',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_kp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3 and purata.total >=5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-kp',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_2_kp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3 and purata.total >=5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-kp',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_3_kp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-kp',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_kpn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3 and purata.total >=5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-kpn',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_2_kpn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3 and purata.total >=5"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-kpn',compact('roles_menu'));
        }
    }

    function laporan_berisiko_ikes_3_kpn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_a_s1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_a_s2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_a_s3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_a_s4,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_b_s1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_b_s2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_b_s3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_b_s4,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_c_s1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_c_s2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_c_s3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_c_s4,
                (case when purata.total IS NOT NULL then purata.total else 0 end)AS purata,
                (case when total_all.total IS NOT NULL then total_all.total else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (3,4) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (5,6) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 4 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 7 and MONTH(spk__ikes.ikes_tarikh_berlaku) <= 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
                ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and spk__ikes.kategori_id IN (7) and MONTH(spk__ikes.ikes_tarikh_berlaku) >= 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*)/12 AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) purata on purata.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.state_id
            ) total_all on total_all.state_id = ref__states.state_id
            WHERE purata.total <= 3"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-berisiko-ikes-kpn',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_ikes_kluster_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS kluster,
                ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_jan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_feb,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_mar,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_apr,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_may,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_jun,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_jul,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_aug,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_sep,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_oct,
                (case when k.total IS NOT NULL then k.total else 0 end)AS total_nov,
                (case when l.total IS NOT NULL then l.total else 0 end)AS total_dec
            FROM ref__spk_ikes_sub_kluster
            LEFT JOIN ref__spk_ikes_kluster ON ref__spk_ikes_kluster.id = ref__spk_ikes_sub_kluster.kluster_id 
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) 
                GROUP BY spk__ikes.sub_kluster_id
            ) a on a.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) b on b.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) c on c.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) d on d.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) e on e.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) f on f.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) g on g.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) h on h.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) i on i.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) j on j.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) k on k.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.daerah_id = '" . Auth::user()->daerah_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) l on l.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1 
            ORDER BY ref__spk_ikes_kluster.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-ppd',compact('roles_menu'));
        }
    }

    function laporan_ikes_kluster_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS kluster,
                ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_jan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_feb,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_mar,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_apr,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_may,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_jun,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_jul,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_aug,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_sep,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_oct,
                (case when k.total IS NOT NULL then k.total else 0 end)AS total_nov,
                (case when l.total IS NOT NULL then l.total else 0 end)AS total_dec
            FROM ref__spk_ikes_sub_kluster
            LEFT JOIN ref__spk_ikes_kluster ON ref__spk_ikes_kluster.id = ref__spk_ikes_sub_kluster.kluster_id 
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.state_id = '" . Auth::user()->state_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) a on a.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.state_id = '" . Auth::user()->state_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) b on b.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.state_id = '" . Auth::user()->state_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) c on c.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.state_id = '" . Auth::user()->state_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) d on d.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.state_id = '" . Auth::user()->state_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) e on e.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.state_id = '" . Auth::user()->state_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) f on f.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.state_id = '" . Auth::user()->state_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) g on g.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.state_id = '" . Auth::user()->state_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) h on h.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.state_id = '" . Auth::user()->state_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) i on i.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.state_id = '" . Auth::user()->state_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) j on j.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.state_id = '" . Auth::user()->state_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) k on k.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and spk__ikes.state_id = '" . Auth::user()->state_id . "' and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) l on l.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1 
            ORDER BY ref__spk_ikes_kluster.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-ppn',compact('roles_menu'));
        }
    }

    function laporan_ikes_kluster_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS kluster,
                ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_jan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_feb,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_mar,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_apr,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_may,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_jun,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_jul,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_aug,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_sep,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_oct,
                (case when k.total IS NOT NULL then k.total else 0 end)AS total_nov,
                (case when l.total IS NOT NULL then l.total else 0 end)AS total_dec
            FROM ref__spk_ikes_sub_kluster
            LEFT JOIN ref__spk_ikes_kluster ON ref__spk_ikes_kluster.id = ref__spk_ikes_sub_kluster.kluster_id 
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) a on a.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) b on b.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) c on c.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) d on d.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) e on e.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) f on f.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) g on g.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) h on h.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) i on i.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) j on j.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) k on k.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) l on l.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1 
            ORDER BY ref__spk_ikes_kluster.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-bpp',compact('roles_menu'));
        }
    }

    function laporan_ikes_kluster_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS kluster,
                ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_jan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_feb,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_mar,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_apr,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_may,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_jun,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_jul,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_aug,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_sep,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_oct,
                (case when k.total IS NOT NULL then k.total else 0 end)AS total_nov,
                (case when l.total IS NOT NULL then l.total else 0 end)AS total_dec
            FROM ref__spk_ikes_sub_kluster
            LEFT JOIN ref__spk_ikes_kluster ON ref__spk_ikes_kluster.id = ref__spk_ikes_sub_kluster.kluster_id 
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) a on a.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) b on b.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) c on c.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) d on d.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) e on e.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) f on f.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) g on g.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) h on h.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) i on i.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) j on j.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) k on k.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) l on l.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1 
            ORDER BY ref__spk_ikes_kluster.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-p',compact('roles_menu'));
        }
    }

    function laporan_ikes_kluster_tkpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS kluster,
                ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_jan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_feb,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_mar,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_apr,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_may,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_jun,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_jul,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_aug,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_sep,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_oct,
                (case when k.total IS NOT NULL then k.total else 0 end)AS total_nov,
                (case when l.total IS NOT NULL then l.total else 0 end)AS total_dec
            FROM ref__spk_ikes_sub_kluster
            LEFT JOIN ref__spk_ikes_kluster ON ref__spk_ikes_kluster.id = ref__spk_ikes_sub_kluster.kluster_id 
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) a on a.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) b on b.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) c on c.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) d on d.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) e on e.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) f on f.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) g on g.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) h on h.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) i on i.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) j on j.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) k on k.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) l on l.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1 
            ORDER BY ref__spk_ikes_kluster.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-tkpp',compact('roles_menu'));
        }
    }

    function laporan_ikes_kluster_kp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS kluster,
                ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_jan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_feb,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_mar,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_apr,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_may,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_jun,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_jul,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_aug,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_sep,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_oct,
                (case when k.total IS NOT NULL then k.total else 0 end)AS total_nov,
                (case when l.total IS NOT NULL then l.total else 0 end)AS total_dec
            FROM ref__spk_ikes_sub_kluster
            LEFT JOIN ref__spk_ikes_kluster ON ref__spk_ikes_kluster.id = ref__spk_ikes_sub_kluster.kluster_id 
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) a on a.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) b on b.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) c on c.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) d on d.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) e on e.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) f on f.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) g on g.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) h on h.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) i on i.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) j on j.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) k on k.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) l on l.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1 
            ORDER BY ref__spk_ikes_kluster.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-kp',compact('roles_menu'));
        }
    }

    function laporan_ikes_kluster_kpn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_ikes_kluster.kluster_description AS kluster,
                ref__spk_ikes_sub_kluster.subkluster_description AS sub_kluster,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_jan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_feb,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_mar,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_apr,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_may,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_jun,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_jul,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_aug,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_sep,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_oct,
                (case when k.total IS NOT NULL then k.total else 0 end)AS total_nov,
                (case when l.total IS NOT NULL then l.total else 0 end)AS total_dec
            FROM ref__spk_ikes_sub_kluster
            LEFT JOIN ref__spk_ikes_kluster ON ref__spk_ikes_kluster.id = ref__spk_ikes_sub_kluster.kluster_id 
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) a on a.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) b on b.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) c on c.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) d on d.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) e on e.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) f on f.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) g on g.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) h on h.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) i on i.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) j on j.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) k on k.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            LEFT JOIN (
                SELECT
                spk__ikes.sub_kluster_id AS sub_kluster_id,
                count(*) AS total
                FROM spk__ikes 
                LEFT JOIN ref__spk_ikes_sub_kluster ON ref__spk_ikes_sub_kluster.id = spk__ikes.sub_kluster_id
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE())
                GROUP BY spk__ikes.sub_kluster_id
            ) l on l.sub_kluster_id = ref__spk_ikes_sub_kluster.id
            WHERE ref__spk_ikes_kluster.status = 1 
            ORDER BY ref__spk_ikes_kluster.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-kpn',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_ikes_kluster_bulan_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_jan_1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_jan_2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_jan_3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_jan_4,
                (case when a_5.total IS NOT NULL then a_5.total else 0 end)AS total_jan_5,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_feb_1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_feb_2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_feb_3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_feb_4,
                (case when b_5.total IS NOT NULL then b_5.total else 0 end)AS total_feb_5,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_mac_1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_mac_2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_mac_3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_mac_4,
                (case when c_5.total IS NOT NULL then c_5.total else 0 end)AS total_mac_5,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_apr_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_apr_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_apr_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_apr_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_apr_5,
                (case when e_1.total IS NOT NULL then e_1.total else 0 end)AS total_may_1,
                (case when e_2.total IS NOT NULL then e_2.total else 0 end)AS total_may_2,
                (case when e_3.total IS NOT NULL then e_3.total else 0 end)AS total_may_3,
                (case when e_4.total IS NOT NULL then e_4.total else 0 end)AS total_may_4,
                (case when e_5.total IS NOT NULL then e_5.total else 0 end)AS total_may_5,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_jun_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_jun_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_jun_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_jun_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_jun_5,
                (case when f_1.total IS NOT NULL then g_1.total else 0 end)AS total_jul_1,
                (case when f_2.total IS NOT NULL then g_2.total else 0 end)AS total_jul_2,
                (case when f_3.total IS NOT NULL then g_3.total else 0 end)AS total_jul_3,
                (case when f_4.total IS NOT NULL then g_4.total else 0 end)AS total_jul_4,
                (case when f_5.total IS NOT NULL then g_5.total else 0 end)AS total_jul_5,
                (case when h_1.total IS NOT NULL then h_1.total else 0 end)AS total_aug_1,
                (case when h_2.total IS NOT NULL then h_2.total else 0 end)AS total_aug_2,
                (case when h_3.total IS NOT NULL then h_3.total else 0 end)AS total_aug_3,
                (case when h_4.total IS NOT NULL then h_4.total else 0 end)AS total_aug_4,
                (case when h_5.total IS NOT NULL then h_5.total else 0 end)AS total_aug_5,
                (case when i_1.total IS NOT NULL then i_1.total else 0 end)AS total_sep_1,
                (case when i_2.total IS NOT NULL then i_2.total else 0 end)AS total_sep_2,
                (case when i_3.total IS NOT NULL then i_3.total else 0 end)AS total_sep_3,
                (case when i_4.total IS NOT NULL then i_4.total else 0 end)AS total_sep_4,
                (case when i_5.total IS NOT NULL then i_5.total else 0 end)AS total_sep_5,
                (case when j_1.total IS NOT NULL then j_1.total else 0 end)AS total_oct_1,
                (case when j_2.total IS NOT NULL then j_2.total else 0 end)AS total_oct_2,
                (case when j_3.total IS NOT NULL then j_3.total else 0 end)AS total_oct_3,
                (case when j_4.total IS NOT NULL then j_4.total else 0 end)AS total_oct_4,
                (case when j_5.total IS NOT NULL then j_5.total else 0 end)AS total_oct_5,
                (case when k_1.total IS NOT NULL then k_1.total else 0 end)AS total_nov_1,
                (case when k_2.total IS NOT NULL then k_2.total else 0 end)AS total_nov_2,
                (case when k_3.total IS NOT NULL then k_3.total else 0 end)AS total_nov_3,
                (case when k_4.total IS NOT NULL then k_4.total else 0 end)AS total_nov_4,
                (case when k_5.total IS NOT NULL then k_5.total else 0 end)AS total_nov_5,
                (case when l_1.total IS NOT NULL then l_1.total else 0 end)AS total_dec_1,
                (case when l_2.total IS NOT NULL then l_2.total else 0 end)AS total_dec_2,
                (case when l_3.total IS NOT NULL then l_3.total else 0 end)AS total_dec_3,
                (case when l_4.total IS NOT NULL then l_4.total else 0 end)AS total_dec_4,
                (case when l_5.total IS NOT NULL then l_5.total else 0 end)AS total_dec_5
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) a_5 on a_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) b_5 on b_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) c_5 on c_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) e_1 on e_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) e_2 on e_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) e_3 on e_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) e_4 on e_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) e_5 on e_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) g_1 on g_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) g_2 on g_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) g_3 on g_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) g_4 on g_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) g_5 on g_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) h_1 on h_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) h_2 on h_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) h_3 on h_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) h_4 on h_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) h_5 on h_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) i_1 on i_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) i_2 on i_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) i_3 on i_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) i_4 on i_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) i_5 on i_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) j_1 on j_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) j_2 on j_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) j_3 on j_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) j_4 on j_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) j_5 on j_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) k_1 on k_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) k_2 on k_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) k_3 on k_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) k_4 on k_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) k_5 on k_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) l_1 on l_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) l_2 on l_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) l_3 on l_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) l_4 on l_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) l_5 on l_5.state_id = ref__states.state_id
            ORDER BY ref__states.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-bulan-ppd',compact('roles_menu'));
        }
    }

    function laporan_ikes_kluster_bulan_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_jan_1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_jan_2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_jan_3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_jan_4,
                (case when a_5.total IS NOT NULL then a_5.total else 0 end)AS total_jan_5,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_feb_1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_feb_2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_feb_3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_feb_4,
                (case when b_5.total IS NOT NULL then b_5.total else 0 end)AS total_feb_5,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_mac_1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_mac_2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_mac_3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_mac_4,
                (case when c_5.total IS NOT NULL then c_5.total else 0 end)AS total_mac_5,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_apr_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_apr_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_apr_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_apr_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_apr_5,
                (case when e_1.total IS NOT NULL then e_1.total else 0 end)AS total_may_1,
                (case when e_2.total IS NOT NULL then e_2.total else 0 end)AS total_may_2,
                (case when e_3.total IS NOT NULL then e_3.total else 0 end)AS total_may_3,
                (case when e_4.total IS NOT NULL then e_4.total else 0 end)AS total_may_4,
                (case when e_5.total IS NOT NULL then e_5.total else 0 end)AS total_may_5,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_jun_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_jun_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_jun_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_jun_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_jun_5,
                (case when f_1.total IS NOT NULL then g_1.total else 0 end)AS total_jul_1,
                (case when f_2.total IS NOT NULL then g_2.total else 0 end)AS total_jul_2,
                (case when f_3.total IS NOT NULL then g_3.total else 0 end)AS total_jul_3,
                (case when f_4.total IS NOT NULL then g_4.total else 0 end)AS total_jul_4,
                (case when f_5.total IS NOT NULL then g_5.total else 0 end)AS total_jul_5,
                (case when h_1.total IS NOT NULL then h_1.total else 0 end)AS total_aug_1,
                (case when h_2.total IS NOT NULL then h_2.total else 0 end)AS total_aug_2,
                (case when h_3.total IS NOT NULL then h_3.total else 0 end)AS total_aug_3,
                (case when h_4.total IS NOT NULL then h_4.total else 0 end)AS total_aug_4,
                (case when h_5.total IS NOT NULL then h_5.total else 0 end)AS total_aug_5,
                (case when i_1.total IS NOT NULL then i_1.total else 0 end)AS total_sep_1,
                (case when i_2.total IS NOT NULL then i_2.total else 0 end)AS total_sep_2,
                (case when i_3.total IS NOT NULL then i_3.total else 0 end)AS total_sep_3,
                (case when i_4.total IS NOT NULL then i_4.total else 0 end)AS total_sep_4,
                (case when i_5.total IS NOT NULL then i_5.total else 0 end)AS total_sep_5,
                (case when j_1.total IS NOT NULL then j_1.total else 0 end)AS total_oct_1,
                (case when j_2.total IS NOT NULL then j_2.total else 0 end)AS total_oct_2,
                (case when j_3.total IS NOT NULL then j_3.total else 0 end)AS total_oct_3,
                (case when j_4.total IS NOT NULL then j_4.total else 0 end)AS total_oct_4,
                (case when j_5.total IS NOT NULL then j_5.total else 0 end)AS total_oct_5,
                (case when k_1.total IS NOT NULL then k_1.total else 0 end)AS total_nov_1,
                (case when k_2.total IS NOT NULL then k_2.total else 0 end)AS total_nov_2,
                (case when k_3.total IS NOT NULL then k_3.total else 0 end)AS total_nov_3,
                (case when k_4.total IS NOT NULL then k_4.total else 0 end)AS total_nov_4,
                (case when k_5.total IS NOT NULL then k_5.total else 0 end)AS total_nov_5,
                (case when l_1.total IS NOT NULL then l_1.total else 0 end)AS total_dec_1,
                (case when l_2.total IS NOT NULL then l_2.total else 0 end)AS total_dec_2,
                (case when l_3.total IS NOT NULL then l_3.total else 0 end)AS total_dec_3,
                (case when l_4.total IS NOT NULL then l_4.total else 0 end)AS total_dec_4,
                (case when l_5.total IS NOT NULL then l_5.total else 0 end)AS total_dec_5
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) a_5 on a_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) b_5 on b_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) c_5 on c_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) e_1 on e_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) e_2 on e_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) e_3 on e_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) e_4 on e_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) e_5 on e_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) g_1 on g_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) g_2 on g_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) g_3 on g_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) g_4 on g_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) g_5 on g_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) h_1 on h_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) h_2 on h_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) h_3 on h_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) h_4 on h_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) h_5 on h_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) i_1 on i_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) i_2 on i_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) i_3 on i_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) i_4 on i_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) i_5 on i_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) j_1 on j_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) j_2 on j_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) j_3 on j_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) j_4 on j_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) j_5 on j_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) k_1 on k_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) k_2 on k_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) k_3 on k_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) k_4 on k_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) k_5 on k_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) l_1 on l_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) l_2 on l_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) l_3 on l_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) l_4 on l_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) l_5 on l_5.state_id = ref__states.state_id
            ORDER BY ref__states.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-bulan-ppn',compact('roles_menu'));
        }
    }

    function laporan_ikes_kluster_bulan_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_jan_1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_jan_2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_jan_3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_jan_4,
                (case when a_5.total IS NOT NULL then a_5.total else 0 end)AS total_jan_5,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_feb_1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_feb_2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_feb_3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_feb_4,
                (case when b_5.total IS NOT NULL then b_5.total else 0 end)AS total_feb_5,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_mac_1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_mac_2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_mac_3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_mac_4,
                (case when c_5.total IS NOT NULL then c_5.total else 0 end)AS total_mac_5,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_apr_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_apr_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_apr_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_apr_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_apr_5,
                (case when e_1.total IS NOT NULL then e_1.total else 0 end)AS total_may_1,
                (case when e_2.total IS NOT NULL then e_2.total else 0 end)AS total_may_2,
                (case when e_3.total IS NOT NULL then e_3.total else 0 end)AS total_may_3,
                (case when e_4.total IS NOT NULL then e_4.total else 0 end)AS total_may_4,
                (case when e_5.total IS NOT NULL then e_5.total else 0 end)AS total_may_5,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_jun_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_jun_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_jun_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_jun_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_jun_5,
                (case when f_1.total IS NOT NULL then g_1.total else 0 end)AS total_jul_1,
                (case when f_2.total IS NOT NULL then g_2.total else 0 end)AS total_jul_2,
                (case when f_3.total IS NOT NULL then g_3.total else 0 end)AS total_jul_3,
                (case when f_4.total IS NOT NULL then g_4.total else 0 end)AS total_jul_4,
                (case when f_5.total IS NOT NULL then g_5.total else 0 end)AS total_jul_5,
                (case when h_1.total IS NOT NULL then h_1.total else 0 end)AS total_aug_1,
                (case when h_2.total IS NOT NULL then h_2.total else 0 end)AS total_aug_2,
                (case when h_3.total IS NOT NULL then h_3.total else 0 end)AS total_aug_3,
                (case when h_4.total IS NOT NULL then h_4.total else 0 end)AS total_aug_4,
                (case when h_5.total IS NOT NULL then h_5.total else 0 end)AS total_aug_5,
                (case when i_1.total IS NOT NULL then i_1.total else 0 end)AS total_sep_1,
                (case when i_2.total IS NOT NULL then i_2.total else 0 end)AS total_sep_2,
                (case when i_3.total IS NOT NULL then i_3.total else 0 end)AS total_sep_3,
                (case when i_4.total IS NOT NULL then i_4.total else 0 end)AS total_sep_4,
                (case when i_5.total IS NOT NULL then i_5.total else 0 end)AS total_sep_5,
                (case when j_1.total IS NOT NULL then j_1.total else 0 end)AS total_oct_1,
                (case when j_2.total IS NOT NULL then j_2.total else 0 end)AS total_oct_2,
                (case when j_3.total IS NOT NULL then j_3.total else 0 end)AS total_oct_3,
                (case when j_4.total IS NOT NULL then j_4.total else 0 end)AS total_oct_4,
                (case when j_5.total IS NOT NULL then j_5.total else 0 end)AS total_oct_5,
                (case when k_1.total IS NOT NULL then k_1.total else 0 end)AS total_nov_1,
                (case when k_2.total IS NOT NULL then k_2.total else 0 end)AS total_nov_2,
                (case when k_3.total IS NOT NULL then k_3.total else 0 end)AS total_nov_3,
                (case when k_4.total IS NOT NULL then k_4.total else 0 end)AS total_nov_4,
                (case when k_5.total IS NOT NULL then k_5.total else 0 end)AS total_nov_5,
                (case when l_1.total IS NOT NULL then l_1.total else 0 end)AS total_dec_1,
                (case when l_2.total IS NOT NULL then l_2.total else 0 end)AS total_dec_2,
                (case when l_3.total IS NOT NULL then l_3.total else 0 end)AS total_dec_3,
                (case when l_4.total IS NOT NULL then l_4.total else 0 end)AS total_dec_4,
                (case when l_5.total IS NOT NULL then l_5.total else 0 end)AS total_dec_5
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) a_5 on a_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) b_5 on b_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) c_5 on c_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) e_1 on e_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) e_2 on e_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) e_3 on e_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) e_4 on e_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) e_5 on e_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) g_1 on g_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) g_2 on g_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) g_3 on g_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) g_4 on g_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) g_5 on g_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) h_1 on h_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) h_2 on h_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) h_3 on h_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) h_4 on h_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) h_5 on h_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) i_1 on i_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) i_2 on i_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) i_3 on i_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) i_4 on i_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) i_5 on i_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) j_1 on j_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) j_2 on j_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) j_3 on j_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) j_4 on j_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) j_5 on j_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) k_1 on k_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) k_2 on k_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) k_3 on k_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) k_4 on k_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) k_5 on k_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) l_1 on l_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) l_2 on l_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) l_3 on l_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) l_4 on l_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) l_5 on l_5.state_id = ref__states.state_id
            ORDER BY ref__states.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-bulan-bpp',compact('roles_menu'));
        }
    }

    function laporan_ikes_kluster_bulan_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_jan_1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_jan_2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_jan_3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_jan_4,
                (case when a_5.total IS NOT NULL then a_5.total else 0 end)AS total_jan_5,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_feb_1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_feb_2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_feb_3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_feb_4,
                (case when b_5.total IS NOT NULL then b_5.total else 0 end)AS total_feb_5,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_mac_1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_mac_2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_mac_3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_mac_4,
                (case when c_5.total IS NOT NULL then c_5.total else 0 end)AS total_mac_5,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_apr_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_apr_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_apr_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_apr_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_apr_5,
                (case when e_1.total IS NOT NULL then e_1.total else 0 end)AS total_may_1,
                (case when e_2.total IS NOT NULL then e_2.total else 0 end)AS total_may_2,
                (case when e_3.total IS NOT NULL then e_3.total else 0 end)AS total_may_3,
                (case when e_4.total IS NOT NULL then e_4.total else 0 end)AS total_may_4,
                (case when e_5.total IS NOT NULL then e_5.total else 0 end)AS total_may_5,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_jun_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_jun_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_jun_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_jun_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_jun_5,
                (case when f_1.total IS NOT NULL then g_1.total else 0 end)AS total_jul_1,
                (case when f_2.total IS NOT NULL then g_2.total else 0 end)AS total_jul_2,
                (case when f_3.total IS NOT NULL then g_3.total else 0 end)AS total_jul_3,
                (case when f_4.total IS NOT NULL then g_4.total else 0 end)AS total_jul_4,
                (case when f_5.total IS NOT NULL then g_5.total else 0 end)AS total_jul_5,
                (case when h_1.total IS NOT NULL then h_1.total else 0 end)AS total_aug_1,
                (case when h_2.total IS NOT NULL then h_2.total else 0 end)AS total_aug_2,
                (case when h_3.total IS NOT NULL then h_3.total else 0 end)AS total_aug_3,
                (case when h_4.total IS NOT NULL then h_4.total else 0 end)AS total_aug_4,
                (case when h_5.total IS NOT NULL then h_5.total else 0 end)AS total_aug_5,
                (case when i_1.total IS NOT NULL then i_1.total else 0 end)AS total_sep_1,
                (case when i_2.total IS NOT NULL then i_2.total else 0 end)AS total_sep_2,
                (case when i_3.total IS NOT NULL then i_3.total else 0 end)AS total_sep_3,
                (case when i_4.total IS NOT NULL then i_4.total else 0 end)AS total_sep_4,
                (case when i_5.total IS NOT NULL then i_5.total else 0 end)AS total_sep_5,
                (case when j_1.total IS NOT NULL then j_1.total else 0 end)AS total_oct_1,
                (case when j_2.total IS NOT NULL then j_2.total else 0 end)AS total_oct_2,
                (case when j_3.total IS NOT NULL then j_3.total else 0 end)AS total_oct_3,
                (case when j_4.total IS NOT NULL then j_4.total else 0 end)AS total_oct_4,
                (case when j_5.total IS NOT NULL then j_5.total else 0 end)AS total_oct_5,
                (case when k_1.total IS NOT NULL then k_1.total else 0 end)AS total_nov_1,
                (case when k_2.total IS NOT NULL then k_2.total else 0 end)AS total_nov_2,
                (case when k_3.total IS NOT NULL then k_3.total else 0 end)AS total_nov_3,
                (case when k_4.total IS NOT NULL then k_4.total else 0 end)AS total_nov_4,
                (case when k_5.total IS NOT NULL then k_5.total else 0 end)AS total_nov_5,
                (case when l_1.total IS NOT NULL then l_1.total else 0 end)AS total_dec_1,
                (case when l_2.total IS NOT NULL then l_2.total else 0 end)AS total_dec_2,
                (case when l_3.total IS NOT NULL then l_3.total else 0 end)AS total_dec_3,
                (case when l_4.total IS NOT NULL then l_4.total else 0 end)AS total_dec_4,
                (case when l_5.total IS NOT NULL then l_5.total else 0 end)AS total_dec_5
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) a_5 on a_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) b_5 on b_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) c_5 on c_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) e_1 on e_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) e_2 on e_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) e_3 on e_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) e_4 on e_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) e_5 on e_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) g_1 on g_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) g_2 on g_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) g_3 on g_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) g_4 on g_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) g_5 on g_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) h_1 on h_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) h_2 on h_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) h_3 on h_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) h_4 on h_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) h_5 on h_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) i_1 on i_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) i_2 on i_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) i_3 on i_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) i_4 on i_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) i_5 on i_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) j_1 on j_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) j_2 on j_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) j_3 on j_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) j_4 on j_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) j_5 on j_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) k_1 on k_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) k_2 on k_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) k_3 on k_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) k_4 on k_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) k_5 on k_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) l_1 on l_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) l_2 on l_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) l_3 on l_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) l_4 on l_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) l_5 on l_5.state_id = ref__states.state_id
            ORDER BY ref__states.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-bulan-p',compact('roles_menu'));
        }
    }

    function laporan_ikes_kluster_bulan_tkpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_jan_1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_jan_2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_jan_3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_jan_4,
                (case when a_5.total IS NOT NULL then a_5.total else 0 end)AS total_jan_5,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_feb_1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_feb_2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_feb_3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_feb_4,
                (case when b_5.total IS NOT NULL then b_5.total else 0 end)AS total_feb_5,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_mac_1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_mac_2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_mac_3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_mac_4,
                (case when c_5.total IS NOT NULL then c_5.total else 0 end)AS total_mac_5,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_apr_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_apr_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_apr_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_apr_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_apr_5,
                (case when e_1.total IS NOT NULL then e_1.total else 0 end)AS total_may_1,
                (case when e_2.total IS NOT NULL then e_2.total else 0 end)AS total_may_2,
                (case when e_3.total IS NOT NULL then e_3.total else 0 end)AS total_may_3,
                (case when e_4.total IS NOT NULL then e_4.total else 0 end)AS total_may_4,
                (case when e_5.total IS NOT NULL then e_5.total else 0 end)AS total_may_5,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_jun_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_jun_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_jun_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_jun_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_jun_5,
                (case when f_1.total IS NOT NULL then g_1.total else 0 end)AS total_jul_1,
                (case when f_2.total IS NOT NULL then g_2.total else 0 end)AS total_jul_2,
                (case when f_3.total IS NOT NULL then g_3.total else 0 end)AS total_jul_3,
                (case when f_4.total IS NOT NULL then g_4.total else 0 end)AS total_jul_4,
                (case when f_5.total IS NOT NULL then g_5.total else 0 end)AS total_jul_5,
                (case when h_1.total IS NOT NULL then h_1.total else 0 end)AS total_aug_1,
                (case when h_2.total IS NOT NULL then h_2.total else 0 end)AS total_aug_2,
                (case when h_3.total IS NOT NULL then h_3.total else 0 end)AS total_aug_3,
                (case when h_4.total IS NOT NULL then h_4.total else 0 end)AS total_aug_4,
                (case when h_5.total IS NOT NULL then h_5.total else 0 end)AS total_aug_5,
                (case when i_1.total IS NOT NULL then i_1.total else 0 end)AS total_sep_1,
                (case when i_2.total IS NOT NULL then i_2.total else 0 end)AS total_sep_2,
                (case when i_3.total IS NOT NULL then i_3.total else 0 end)AS total_sep_3,
                (case when i_4.total IS NOT NULL then i_4.total else 0 end)AS total_sep_4,
                (case when i_5.total IS NOT NULL then i_5.total else 0 end)AS total_sep_5,
                (case when j_1.total IS NOT NULL then j_1.total else 0 end)AS total_oct_1,
                (case when j_2.total IS NOT NULL then j_2.total else 0 end)AS total_oct_2,
                (case when j_3.total IS NOT NULL then j_3.total else 0 end)AS total_oct_3,
                (case when j_4.total IS NOT NULL then j_4.total else 0 end)AS total_oct_4,
                (case when j_5.total IS NOT NULL then j_5.total else 0 end)AS total_oct_5,
                (case when k_1.total IS NOT NULL then k_1.total else 0 end)AS total_nov_1,
                (case when k_2.total IS NOT NULL then k_2.total else 0 end)AS total_nov_2,
                (case when k_3.total IS NOT NULL then k_3.total else 0 end)AS total_nov_3,
                (case when k_4.total IS NOT NULL then k_4.total else 0 end)AS total_nov_4,
                (case when k_5.total IS NOT NULL then k_5.total else 0 end)AS total_nov_5,
                (case when l_1.total IS NOT NULL then l_1.total else 0 end)AS total_dec_1,
                (case when l_2.total IS NOT NULL then l_2.total else 0 end)AS total_dec_2,
                (case when l_3.total IS NOT NULL then l_3.total else 0 end)AS total_dec_3,
                (case when l_4.total IS NOT NULL then l_4.total else 0 end)AS total_dec_4,
                (case when l_5.total IS NOT NULL then l_5.total else 0 end)AS total_dec_5
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) a_5 on a_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) b_5 on b_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) c_5 on c_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) e_1 on e_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) e_2 on e_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) e_3 on e_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) e_4 on e_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) e_5 on e_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) g_1 on g_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) g_2 on g_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) g_3 on g_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) g_4 on g_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) g_5 on g_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) h_1 on h_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) h_2 on h_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) h_3 on h_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) h_4 on h_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) h_5 on h_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) i_1 on i_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) i_2 on i_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) i_3 on i_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) i_4 on i_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) i_5 on i_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) j_1 on j_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) j_2 on j_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) j_3 on j_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) j_4 on j_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) j_5 on j_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) k_1 on k_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) k_2 on k_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) k_3 on k_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) k_4 on k_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) k_5 on k_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) l_1 on l_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) l_2 on l_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) l_3 on l_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) l_4 on l_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) l_5 on l_5.state_id = ref__states.state_id
            ORDER BY ref__states.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-bulan-tkpp',compact('roles_menu'));
        }
    }

    function laporan_ikes_kluster_bulan_kp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_jan_1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_jan_2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_jan_3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_jan_4,
                (case when a_5.total IS NOT NULL then a_5.total else 0 end)AS total_jan_5,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_feb_1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_feb_2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_feb_3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_feb_4,
                (case when b_5.total IS NOT NULL then b_5.total else 0 end)AS total_feb_5,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_mac_1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_mac_2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_mac_3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_mac_4,
                (case when c_5.total IS NOT NULL then c_5.total else 0 end)AS total_mac_5,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_apr_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_apr_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_apr_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_apr_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_apr_5,
                (case when e_1.total IS NOT NULL then e_1.total else 0 end)AS total_may_1,
                (case when e_2.total IS NOT NULL then e_2.total else 0 end)AS total_may_2,
                (case when e_3.total IS NOT NULL then e_3.total else 0 end)AS total_may_3,
                (case when e_4.total IS NOT NULL then e_4.total else 0 end)AS total_may_4,
                (case when e_5.total IS NOT NULL then e_5.total else 0 end)AS total_may_5,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_jun_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_jun_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_jun_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_jun_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_jun_5,
                (case when f_1.total IS NOT NULL then g_1.total else 0 end)AS total_jul_1,
                (case when f_2.total IS NOT NULL then g_2.total else 0 end)AS total_jul_2,
                (case when f_3.total IS NOT NULL then g_3.total else 0 end)AS total_jul_3,
                (case when f_4.total IS NOT NULL then g_4.total else 0 end)AS total_jul_4,
                (case when f_5.total IS NOT NULL then g_5.total else 0 end)AS total_jul_5,
                (case when h_1.total IS NOT NULL then h_1.total else 0 end)AS total_aug_1,
                (case when h_2.total IS NOT NULL then h_2.total else 0 end)AS total_aug_2,
                (case when h_3.total IS NOT NULL then h_3.total else 0 end)AS total_aug_3,
                (case when h_4.total IS NOT NULL then h_4.total else 0 end)AS total_aug_4,
                (case when h_5.total IS NOT NULL then h_5.total else 0 end)AS total_aug_5,
                (case when i_1.total IS NOT NULL then i_1.total else 0 end)AS total_sep_1,
                (case when i_2.total IS NOT NULL then i_2.total else 0 end)AS total_sep_2,
                (case when i_3.total IS NOT NULL then i_3.total else 0 end)AS total_sep_3,
                (case when i_4.total IS NOT NULL then i_4.total else 0 end)AS total_sep_4,
                (case when i_5.total IS NOT NULL then i_5.total else 0 end)AS total_sep_5,
                (case when j_1.total IS NOT NULL then j_1.total else 0 end)AS total_oct_1,
                (case when j_2.total IS NOT NULL then j_2.total else 0 end)AS total_oct_2,
                (case when j_3.total IS NOT NULL then j_3.total else 0 end)AS total_oct_3,
                (case when j_4.total IS NOT NULL then j_4.total else 0 end)AS total_oct_4,
                (case when j_5.total IS NOT NULL then j_5.total else 0 end)AS total_oct_5,
                (case when k_1.total IS NOT NULL then k_1.total else 0 end)AS total_nov_1,
                (case when k_2.total IS NOT NULL then k_2.total else 0 end)AS total_nov_2,
                (case when k_3.total IS NOT NULL then k_3.total else 0 end)AS total_nov_3,
                (case when k_4.total IS NOT NULL then k_4.total else 0 end)AS total_nov_4,
                (case when k_5.total IS NOT NULL then k_5.total else 0 end)AS total_nov_5,
                (case when l_1.total IS NOT NULL then l_1.total else 0 end)AS total_dec_1,
                (case when l_2.total IS NOT NULL then l_2.total else 0 end)AS total_dec_2,
                (case when l_3.total IS NOT NULL then l_3.total else 0 end)AS total_dec_3,
                (case when l_4.total IS NOT NULL then l_4.total else 0 end)AS total_dec_4,
                (case when l_5.total IS NOT NULL then l_5.total else 0 end)AS total_dec_5
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) a_5 on a_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) b_5 on b_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) c_5 on c_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) e_1 on e_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) e_2 on e_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) e_3 on e_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) e_4 on e_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) e_5 on e_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) g_1 on g_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) g_2 on g_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) g_3 on g_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) g_4 on g_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) g_5 on g_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) h_1 on h_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) h_2 on h_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) h_3 on h_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) h_4 on h_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) h_5 on h_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) i_1 on i_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) i_2 on i_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) i_3 on i_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) i_4 on i_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) i_5 on i_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) j_1 on j_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) j_2 on j_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) j_3 on j_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) j_4 on j_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) j_5 on j_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) k_1 on k_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) k_2 on k_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) k_3 on k_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) k_4 on k_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) k_5 on k_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) l_1 on l_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) l_2 on l_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) l_3 on l_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) l_4 on l_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) l_5 on l_5.state_id = ref__states.state_id
            ORDER BY ref__states.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-bulan-kp',compact('roles_menu'));
        }
    }

    function laporan_ikes_kluster_bulan_kpn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a_1.total IS NOT NULL then a_1.total else 0 end)AS total_jan_1,
                (case when a_2.total IS NOT NULL then a_2.total else 0 end)AS total_jan_2,
                (case when a_3.total IS NOT NULL then a_3.total else 0 end)AS total_jan_3,
                (case when a_4.total IS NOT NULL then a_4.total else 0 end)AS total_jan_4,
                (case when a_5.total IS NOT NULL then a_5.total else 0 end)AS total_jan_5,
                (case when b_1.total IS NOT NULL then b_1.total else 0 end)AS total_feb_1,
                (case when b_2.total IS NOT NULL then b_2.total else 0 end)AS total_feb_2,
                (case when b_3.total IS NOT NULL then b_3.total else 0 end)AS total_feb_3,
                (case when b_4.total IS NOT NULL then b_4.total else 0 end)AS total_feb_4,
                (case when b_5.total IS NOT NULL then b_5.total else 0 end)AS total_feb_5,
                (case when c_1.total IS NOT NULL then c_1.total else 0 end)AS total_mac_1,
                (case when c_2.total IS NOT NULL then c_2.total else 0 end)AS total_mac_2,
                (case when c_3.total IS NOT NULL then c_3.total else 0 end)AS total_mac_3,
                (case when c_4.total IS NOT NULL then c_4.total else 0 end)AS total_mac_4,
                (case when c_5.total IS NOT NULL then c_5.total else 0 end)AS total_mac_5,
                (case when d_1.total IS NOT NULL then d_1.total else 0 end)AS total_apr_1,
                (case when d_2.total IS NOT NULL then d_2.total else 0 end)AS total_apr_2,
                (case when d_3.total IS NOT NULL then d_3.total else 0 end)AS total_apr_3,
                (case when d_4.total IS NOT NULL then d_4.total else 0 end)AS total_apr_4,
                (case when d_5.total IS NOT NULL then d_5.total else 0 end)AS total_apr_5,
                (case when e_1.total IS NOT NULL then e_1.total else 0 end)AS total_may_1,
                (case when e_2.total IS NOT NULL then e_2.total else 0 end)AS total_may_2,
                (case when e_3.total IS NOT NULL then e_3.total else 0 end)AS total_may_3,
                (case when e_4.total IS NOT NULL then e_4.total else 0 end)AS total_may_4,
                (case when e_5.total IS NOT NULL then e_5.total else 0 end)AS total_may_5,
                (case when f_1.total IS NOT NULL then f_1.total else 0 end)AS total_jun_1,
                (case when f_2.total IS NOT NULL then f_2.total else 0 end)AS total_jun_2,
                (case when f_3.total IS NOT NULL then f_3.total else 0 end)AS total_jun_3,
                (case when f_4.total IS NOT NULL then f_4.total else 0 end)AS total_jun_4,
                (case when f_5.total IS NOT NULL then f_5.total else 0 end)AS total_jun_5,
                (case when f_1.total IS NOT NULL then g_1.total else 0 end)AS total_jul_1,
                (case when f_2.total IS NOT NULL then g_2.total else 0 end)AS total_jul_2,
                (case when f_3.total IS NOT NULL then g_3.total else 0 end)AS total_jul_3,
                (case when f_4.total IS NOT NULL then g_4.total else 0 end)AS total_jul_4,
                (case when f_5.total IS NOT NULL then g_5.total else 0 end)AS total_jul_5,
                (case when h_1.total IS NOT NULL then h_1.total else 0 end)AS total_aug_1,
                (case when h_2.total IS NOT NULL then h_2.total else 0 end)AS total_aug_2,
                (case when h_3.total IS NOT NULL then h_3.total else 0 end)AS total_aug_3,
                (case when h_4.total IS NOT NULL then h_4.total else 0 end)AS total_aug_4,
                (case when h_5.total IS NOT NULL then h_5.total else 0 end)AS total_aug_5,
                (case when i_1.total IS NOT NULL then i_1.total else 0 end)AS total_sep_1,
                (case when i_2.total IS NOT NULL then i_2.total else 0 end)AS total_sep_2,
                (case when i_3.total IS NOT NULL then i_3.total else 0 end)AS total_sep_3,
                (case when i_4.total IS NOT NULL then i_4.total else 0 end)AS total_sep_4,
                (case when i_5.total IS NOT NULL then i_5.total else 0 end)AS total_sep_5,
                (case when j_1.total IS NOT NULL then j_1.total else 0 end)AS total_oct_1,
                (case when j_2.total IS NOT NULL then j_2.total else 0 end)AS total_oct_2,
                (case when j_3.total IS NOT NULL then j_3.total else 0 end)AS total_oct_3,
                (case when j_4.total IS NOT NULL then j_4.total else 0 end)AS total_oct_4,
                (case when j_5.total IS NOT NULL then j_5.total else 0 end)AS total_oct_5,
                (case when k_1.total IS NOT NULL then k_1.total else 0 end)AS total_nov_1,
                (case when k_2.total IS NOT NULL then k_2.total else 0 end)AS total_nov_2,
                (case when k_3.total IS NOT NULL then k_3.total else 0 end)AS total_nov_3,
                (case when k_4.total IS NOT NULL then k_4.total else 0 end)AS total_nov_4,
                (case when k_5.total IS NOT NULL then k_5.total else 0 end)AS total_nov_5,
                (case when l_1.total IS NOT NULL then l_1.total else 0 end)AS total_dec_1,
                (case when l_2.total IS NOT NULL then l_2.total else 0 end)AS total_dec_2,
                (case when l_3.total IS NOT NULL then l_3.total else 0 end)AS total_dec_3,
                (case when l_4.total IS NOT NULL then l_4.total else 0 end)AS total_dec_4,
                (case when l_5.total IS NOT NULL then l_5.total else 0 end)AS total_dec_5
            FROM ref__states
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) a_1 on a_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) a_2 on a_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) a_3 on a_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) a_4 on a_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 1 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) a_5 on a_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) b_1 on b_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) b_2 on b_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) b_3 on b_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) b_4 on b_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 2 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) b_5 on b_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) c_1 on c_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) c_2 on c_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) c_3 on c_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) c_4 on c_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 3 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) c_5 on c_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) d_1 on d_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) d_2 on d_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) d_3 on d_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) d_4 on d_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 4 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) d_5 on d_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) e_1 on e_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) e_2 on e_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) e_3 on e_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) e_4 on e_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 5 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) e_5 on e_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) f_1 on f_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) f_2 on f_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) f_3 on f_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) f_4 on f_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 6 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) f_5 on f_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) g_1 on g_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) g_2 on g_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) g_3 on g_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) g_4 on g_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 7 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) g_5 on g_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) h_1 on h_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) h_2 on h_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) h_3 on h_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) h_4 on h_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 8 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) h_5 on h_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) i_1 on i_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) i_2 on i_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) i_3 on i_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) i_4 on i_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 9 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) i_5 on i_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) j_1 on j_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) j_2 on j_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) j_3 on j_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) j_4 on j_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 10 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) j_5 on j_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) k_1 on k_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) k_2 on k_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) k_3 on k_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) k_4 on k_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 11 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) k_5 on k_5.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 3
                GROUP BY spk__ikes.state_id
            ) l_1 on l_1.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 6
                GROUP BY spk__ikes.state_id
            ) l_2 on l_2.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 8
                GROUP BY spk__ikes.state_id
            ) l_3 on l_3.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 9
                GROUP BY spk__ikes.state_id
            ) l_4 on l_4.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                spk__ikes.state_id AS state_id,
                count(*) AS total
                FROM spk__ikes 
                WHERE spk__ikes.status = 1 and MONTH(spk__ikes.ikes_tarikh_berlaku) = 12 and YEAR(spk__ikes.ikes_tarikh_berlaku) = YEAR(CURDATE()) and spk__ikes.kluster_id = 10
                GROUP BY spk__ikes.state_id
            ) l_5 on l_5.state_id = ref__states.state_id
            ORDER BY ref__states.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-kluster-bulan-kpn',compact('roles_menu'));
        }
    }

   ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_ikes_5_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-5-ppd',compact('roles_menu'));
        }
    }

    function laporan_ikes_5_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-5-ppn',compact('roles_menu'));
        }
    }

    function laporan_ikes_5_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-5-bpp',compact('roles_menu'));
        }
    }

    function laporan_ikes_5_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-5-p',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_ikes_6_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-6-ppd',compact('roles_menu'));
        }
    }

    function laporan_ikes_6_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-6-ppn',compact('roles_menu'));
        }
    }

    function laporan_ikes_6_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-6-bpp',compact('roles_menu'));
        }
    }

    function laporan_ikes_6_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-6-p',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_ikes_7_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-7-ppd',compact('roles_menu'));
        }
    }

    function laporan_ikes_7_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-7-ppn',compact('roles_menu'));
        }
    }

    function laporan_ikes_7_bpp(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-7-bpp',compact('roles_menu'));
        }
    }

    function laporan_ikes_7_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.laporan-ikes-7-p',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function statistik_mk_state_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
                SELECT
                        ref__states.state_description AS state,
                        (case when pegawai.total_pegawai IS NOT NULL then pegawai.total_pegawai else 0 end)AS total_pegawai,
                        (case when rt.total_rt IS NOT NULL then rt.total_rt else 0 end)AS total_rt,
                        (case when ngo.total_ngo IS NOT NULL then ngo.total_ngo else 0 end)AS total_ngo,
                        (case when oa.total_oa IS NOT NULL then oa.total_oa else 0 end)AS total_oa,
                        (case when t_all.total_all IS NOT NULL then t_all.total_all else 0 end)AS total_all
                        FROM ref__states
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pegawai
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_kategori_id IN (1) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id) pegawai on pegawai.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_rt
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_kategori_id IN (2) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id) rt on rt.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_ngo
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_kategori_id IN (3) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id) ngo on ngo.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_oa
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_kategori_id IN (4) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id) oa on oa.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_all
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.status = 1
                        GROUP BY users__profile.state_id) t_all on t_all.state_id = ref__states.state_id"));
             return Datatables::of($data)
             ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-state-ppd',compact('roles_menu'));
        }
    }

    function statistik_mk_state_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;

            $data = DB::select(DB::raw("
            SELECT
                    ref__states.state_description AS state,
                    (case when pegawai.total_pegawai IS NOT NULL then pegawai.total_pegawai else 0 end)AS total_pegawai,
                    (case when rt.total_rt IS NOT NULL then rt.total_rt else 0 end)AS total_rt,
                    (case when ngo.total_ngo IS NOT NULL then ngo.total_ngo else 0 end)AS total_ngo,
                    (case when oa.total_oa IS NOT NULL then oa.total_oa else 0 end)AS total_oa,
                    (case when t_all.total_all IS NOT NULL then t_all.total_all else 0 end)AS total_all
                    FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_pegawai
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (1) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) pegawai on pegawai.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_rt
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (2) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) rt on rt.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_ngo
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (3) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) ngo on ngo.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_oa
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (4) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) oa on oa.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id) t_all on t_all.state_id = ref__states.state_id"));
         return Datatables::of($data)
         ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-state-ppmk',compact('roles_menu'));
        }
    }

    function statistik_mk_state_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                    ref__states.state_description AS state,
                    (case when pegawai.total_pegawai IS NOT NULL then pegawai.total_pegawai else 0 end)AS total_pegawai,
                    (case when rt.total_rt IS NOT NULL then rt.total_rt else 0 end)AS total_rt,
                    (case when ngo.total_ngo IS NOT NULL then ngo.total_ngo else 0 end)AS total_ngo,
                    (case when oa.total_oa IS NOT NULL then oa.total_oa else 0 end)AS total_oa,
                    (case when t_all.total_all IS NOT NULL then t_all.total_all else 0 end)AS total_all
                    FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_pegawai
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (1) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) pegawai on pegawai.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_rt
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (2) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) rt on rt.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_ngo
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (3) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) ngo on ngo.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_oa
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (4) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) oa on oa.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id) t_all on t_all.state_id = ref__states.state_id"));
         return Datatables::of($data)
         ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-state-ppn',compact('roles_menu'));
        }
    }

    function statistik_mk_state_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                    ref__states.state_description AS state,
                    (case when pegawai.total_pegawai IS NOT NULL then pegawai.total_pegawai else 0 end)AS total_pegawai,
                    (case when rt.total_rt IS NOT NULL then rt.total_rt else 0 end)AS total_rt,
                    (case when ngo.total_ngo IS NOT NULL then ngo.total_ngo else 0 end)AS total_ngo,
                    (case when oa.total_oa IS NOT NULL then oa.total_oa else 0 end)AS total_oa,
                    (case when t_all.total_all IS NOT NULL then t_all.total_all else 0 end)AS total_all
                    FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_pegawai
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (1) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) pegawai on pegawai.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_rt
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (2) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) rt on rt.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_ngo
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (3) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) ngo on ngo.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_oa
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (4) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) oa on oa.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id) t_all on t_all.state_id = ref__states.state_id"));
         return Datatables::of($data)
         ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-state-p',compact('roles_menu'));
        }
    }

    function statistik_mk_state_upmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
                    ref__states.state_description AS state,
                    (case when pegawai.total_pegawai IS NOT NULL then pegawai.total_pegawai else 0 end)AS total_pegawai,
                    (case when rt.total_rt IS NOT NULL then rt.total_rt else 0 end)AS total_rt,
                    (case when ngo.total_ngo IS NOT NULL then ngo.total_ngo else 0 end)AS total_ngo,
                    (case when oa.total_oa IS NOT NULL then oa.total_oa else 0 end)AS total_oa,
                    (case when t_all.total_all IS NOT NULL then t_all.total_all else 0 end)AS total_all
                    FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_pegawai
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (1) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) pegawai on pegawai.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_rt
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (2) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) rt on rt.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_ngo
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (3) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) ngo on ngo.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_oa
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_kategori_id IN (4) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id) oa on oa.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id) t_all on t_all.state_id = ref__states.state_id"));
         return Datatables::of($data)
         ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-state-upmk',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function statistik_mk_jantina_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
                SELECT
                  ref__states.state_description AS state,
                  (case when lelaki.total_lelaki IS NOT NULL then lelaki.total_lelaki else 0 end)AS total_lelaki,
                  (case when perempuan.total_perempuan IS NOT NULL then perempuan.total_perempuan else 0 end)AS total_perempuan,
                  (case when total.total_jantina IS NOT NULL then total.total_jantina else 0 end)AS total_all
                FROM ref__states
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_lelaki
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.mkp_pemohon_jantina_id IN (1) AND spk__imediator.status = 1
                  GROUP BY users__profile.state_id) lelaki on lelaki.state_id = ref__states.state_id
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_perempuan
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.mkp_pemohon_jantina_id IN (2) AND spk__imediator.status = 1
                  GROUP BY users__profile.state_id ) perempuan on perempuan.state_id = ref__states.state_id
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_jantina
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.status = 1
                  GROUP BY users__profile.state_id ) total on total.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-jantina-ppd',compact('roles_menu'));
        }
    }

    function statistik_mk_jantina_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
                SELECT
                  ref__states.state_description AS state,
                  (case when lelaki.total_lelaki IS NOT NULL then lelaki.total_lelaki else 0 end)AS total_lelaki,
                  (case when perempuan.total_perempuan IS NOT NULL then perempuan.total_perempuan else 0 end)AS total_perempuan,
                  (case when total.total_jantina IS NOT NULL then total.total_jantina else 0 end)AS total_all
                FROM ref__states
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_lelaki
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.mkp_pemohon_jantina_id IN (1) AND spk__imediator.status = 1
                  GROUP BY users__profile.state_id) lelaki on lelaki.state_id = ref__states.state_id
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_perempuan
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.mkp_pemohon_jantina_id IN (2) AND spk__imediator.status = 1
                  GROUP BY users__profile.state_id ) perempuan on perempuan.state_id = ref__states.state_id
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_jantina
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.status = 1
                  GROUP BY users__profile.state_id ) total on total.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-jantina-ppmk',compact('roles_menu'));
        }
    }

    function statistik_mk_jantina_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
                SELECT
                  ref__states.state_description AS state,
                  (case when lelaki.total_lelaki IS NOT NULL then lelaki.total_lelaki else 0 end)AS total_lelaki,
                  (case when perempuan.total_perempuan IS NOT NULL then perempuan.total_perempuan else 0 end)AS total_perempuan,
                  (case when total.total_jantina IS NOT NULL then total.total_jantina else 0 end)AS total_all
                FROM ref__states
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_lelaki
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.mkp_pemohon_jantina_id IN (1) AND spk__imediator.status = 1
                  GROUP BY users__profile.state_id) lelaki on lelaki.state_id = ref__states.state_id
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_perempuan
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.mkp_pemohon_jantina_id IN (2) AND spk__imediator.status = 1
                  GROUP BY users__profile.state_id ) perempuan on perempuan.state_id = ref__states.state_id
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_jantina
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.status = 1
                  GROUP BY users__profile.state_id ) total on total.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-jantina-ppn',compact('roles_menu'));
        }
    }

    function statistik_mk_jantina_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
                SELECT
                  ref__states.state_description AS state,
                  (case when lelaki.total_lelaki IS NOT NULL then lelaki.total_lelaki else 0 end)AS total_lelaki,
                  (case when perempuan.total_perempuan IS NOT NULL then perempuan.total_perempuan else 0 end)AS total_perempuan,
                  (case when total.total_jantina IS NOT NULL then total.total_jantina else 0 end)AS total_all
                FROM ref__states
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_lelaki
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.mkp_pemohon_jantina_id IN (1) AND spk__imediator.status = 1
                  GROUP BY users__profile.state_id) lelaki on lelaki.state_id = ref__states.state_id
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_perempuan
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.mkp_pemohon_jantina_id IN (2) AND spk__imediator.status = 1
                  GROUP BY users__profile.state_id ) perempuan on perempuan.state_id = ref__states.state_id
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_jantina
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.status = 1
                  GROUP BY users__profile.state_id ) total on total.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-jantina-p',compact('roles_menu'));
        }
    }

    function statistik_mk_jantina_upmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
                SELECT
                  ref__states.state_description AS state,
                  (case when lelaki.total_lelaki IS NOT NULL then lelaki.total_lelaki else 0 end)AS total_lelaki,
                  (case when perempuan.total_perempuan IS NOT NULL then perempuan.total_perempuan else 0 end)AS total_perempuan,
                  (case when total.total_jantina IS NOT NULL then total.total_jantina else 0 end)AS total_all
                FROM ref__states
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_lelaki
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.mkp_pemohon_jantina_id IN (1) AND spk__imediator.status = 1
                  GROUP BY users__profile.state_id) lelaki on lelaki.state_id = ref__states.state_id
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_perempuan
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.mkp_pemohon_jantina_id IN (2) AND spk__imediator.status = 1
                  GROUP BY users__profile.state_id ) perempuan on perempuan.state_id = ref__states.state_id
                LEFT JOIN (
                  SELECT
                  users__profile.state_id AS state_id,
                  COUNT(spk__imediator.mkp_pemohon_jantina_id) AS total_jantina
                  FROM spk__imediator 
                  LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                  WHERE spk__imediator.status = 1
                  GROUP BY users__profile.state_id ) total on total.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-jantina-upmk',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function statistik_mk_kaum_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
            ref__states.state_description AS state,
            (case when melayu.total_melayu IS NOT NULL then melayu.total_melayu else 0 end)AS total_melayu,
            (case when cina.total_cina IS NOT NULL then cina.total_cina else 0 end)AS total_cina,
            (case when india.total_india IS NOT NULL then india.total_india else 0 end)AS total_india,
            (case when sabah.total_sabah IS NOT NULL then sabah.total_sabah else 0 end)AS total_sabah,
            (case when serawak.total_serawak IS NOT NULL then serawak.total_serawak else 0 end)AS total_serawak,
            (case when t_all.total_all IS NOT NULL then t_all.total_all else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_melayu
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (1,2,3,4,5,6,7) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) melayu on melayu.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_cina
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (8,9,10,11,12,13,14,15,16,17,18,19,20) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) cina on cina.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_india
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) india on india.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_sabah
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) sabah on sabah.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_serawak
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) serawak on serawak.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) t_all on t_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-kaum-ppd',compact('roles_menu'));
        }
    }

    function statistik_mk_kaum_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
            ref__states.state_description AS state,
            (case when melayu.total_melayu IS NOT NULL then melayu.total_melayu else 0 end)AS total_melayu,
            (case when cina.total_cina IS NOT NULL then cina.total_cina else 0 end)AS total_cina,
            (case when india.total_india IS NOT NULL then india.total_india else 0 end)AS total_india,
            (case when sabah.total_sabah IS NOT NULL then sabah.total_sabah else 0 end)AS total_sabah,
            (case when serawak.total_serawak IS NOT NULL then serawak.total_serawak else 0 end)AS total_serawak,
            (case when t_all.total_all IS NOT NULL then t_all.total_all else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_melayu
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (1,2,3,4,5,6,7) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) melayu on melayu.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_cina
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (8,9,10,11,12,13,14,15,16,17,18,19,20) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) cina on cina.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_india
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) india on india.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_sabah
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) sabah on sabah.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_serawak
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) serawak on serawak.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) t_all on t_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-kaum-ppmk',compact('roles_menu'));
        }
    }

    function statistik_mk_kaum_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
            ref__states.state_description AS state,
            (case when melayu.total_melayu IS NOT NULL then melayu.total_melayu else 0 end)AS total_melayu,
            (case when cina.total_cina IS NOT NULL then cina.total_cina else 0 end)AS total_cina,
            (case when india.total_india IS NOT NULL then india.total_india else 0 end)AS total_india,
            (case when sabah.total_sabah IS NOT NULL then sabah.total_sabah else 0 end)AS total_sabah,
            (case when serawak.total_serawak IS NOT NULL then serawak.total_serawak else 0 end)AS total_serawak,
            (case when t_all.total_all IS NOT NULL then t_all.total_all else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_melayu
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (1,2,3,4,5,6,7) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) melayu on melayu.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_cina
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (8,9,10,11,12,13,14,15,16,17,18,19,20) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) cina on cina.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_india
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) india on india.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_sabah
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) sabah on sabah.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_serawak
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) serawak on serawak.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) t_all on t_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-kaum-ppn',compact('roles_menu'));
        }
    }

    function statistik_mk_kaum_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
            ref__states.state_description AS state,
            (case when melayu.total_melayu IS NOT NULL then melayu.total_melayu else 0 end)AS total_melayu,
            (case when cina.total_cina IS NOT NULL then cina.total_cina else 0 end)AS total_cina,
            (case when india.total_india IS NOT NULL then india.total_india else 0 end)AS total_india,
            (case when sabah.total_sabah IS NOT NULL then sabah.total_sabah else 0 end)AS total_sabah,
            (case when serawak.total_serawak IS NOT NULL then serawak.total_serawak else 0 end)AS total_serawak,
            (case when t_all.total_all IS NOT NULL then t_all.total_all else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_melayu
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (1,2,3,4,5,6,7) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) melayu on melayu.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_cina
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (8,9,10,11,12,13,14,15,16,17,18,19,20) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) cina on cina.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_india
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) india on india.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_sabah
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) sabah on sabah.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_serawak
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) serawak on serawak.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) t_all on t_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-kaum-p',compact('roles_menu'));
        }
    }

    function statistik_mk_kaum_upmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
            ref__states.state_description AS state,
            (case when melayu.total_melayu IS NOT NULL then melayu.total_melayu else 0 end)AS total_melayu,
            (case when cina.total_cina IS NOT NULL then cina.total_cina else 0 end)AS total_cina,
            (case when india.total_india IS NOT NULL then india.total_india else 0 end)AS total_india,
            (case when sabah.total_sabah IS NOT NULL then sabah.total_sabah else 0 end)AS total_sabah,
            (case when serawak.total_serawak IS NOT NULL then serawak.total_serawak else 0 end)AS total_serawak,
            (case when t_all.total_all IS NOT NULL then t_all.total_all else 0 end)AS total_all
            FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_melayu
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (1,2,3,4,5,6,7) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) melayu on melayu.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_cina
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (8,9,10,11,12,13,14,15,16,17,18,19,20) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) cina on cina.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_india
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) india on india.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_sabah
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) sabah on sabah.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_serawak
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.mkp_pemohon_jantina_id IN (97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171) AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) serawak on serawak.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) t_all on t_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-kaum-upmk',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function statistik_mk_pendidikan_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
                SELECT
                ref__states.state_description AS state,
                (case when pendidikan_1.total_pendidikan_1 IS NOT NULL then pendidikan_1.total_pendidikan_1 else 0 end)AS total_pendidikan_1,
                (case when pendidikan_2.total_pendidikan_2 IS NOT NULL then pendidikan_2.total_pendidikan_2 else 0 end)AS total_pendidikan_2,
                (case when pendidikan_3.total_pendidikan_3 IS NOT NULL then pendidikan_3.total_pendidikan_3 else 0 end)AS total_pendidikan_3,
                (case when pendidikan_4.total_pendidikan_4 IS NOT NULL then pendidikan_4.total_pendidikan_4 else 0 end)AS total_pendidikan_4,
                (case when pendidikan_5.total_pendidikan_5 IS NOT NULL then pendidikan_5.total_pendidikan_5 else 0 end)AS total_pendidikan_5,
                (case when pendidikan_6.total_pendidikan_6 IS NOT NULL then pendidikan_6.total_pendidikan_6 else 0 end)AS total_pendidikan_6,
                (case when pendidikan_7.total_pendidikan_7 IS NOT NULL then pendidikan_7.total_pendidikan_7 else 0 end)AS total_pendidikan_7,
                (case when pendidikan_8.total_pendidikan_8 IS NOT NULL then pendidikan_8.total_pendidikan_8 else 0 end)AS total_pendidikan_8,
                (case when pendidikan_all.total_pendidikan_all IS NOT NULL then pendidikan_all.total_pendidikan_all else 0 end)AS total_pendidikan_all
                FROM ref__states
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_1
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (1) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_1 on pendidikan_1.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_2
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (2) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_2 on pendidikan_2.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_3
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (3) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_3 on pendidikan_3.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_4
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (4) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_4 on pendidikan_4.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_5
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (5) AND spk__imediator.status = 5
                        GROUP BY users__profile.state_id
                ) pendidikan_5 on pendidikan_1.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_6
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (6) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_6 on pendidikan_6.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_7
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (7) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_7 on pendidikan_7.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_8
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (8) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_8 on pendidikan_8.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_all
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_all on pendidikan_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-pendidikan-ppd',compact('roles_menu'));
        }
    }

    function statistik_mk_pendidikan_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
                SELECT
                ref__states.state_description AS state,
                (case when pendidikan_1.total_pendidikan_1 IS NOT NULL then pendidikan_1.total_pendidikan_1 else 0 end)AS total_pendidikan_1,
                (case when pendidikan_2.total_pendidikan_2 IS NOT NULL then pendidikan_2.total_pendidikan_2 else 0 end)AS total_pendidikan_2,
                (case when pendidikan_3.total_pendidikan_3 IS NOT NULL then pendidikan_3.total_pendidikan_3 else 0 end)AS total_pendidikan_3,
                (case when pendidikan_4.total_pendidikan_4 IS NOT NULL then pendidikan_4.total_pendidikan_4 else 0 end)AS total_pendidikan_4,
                (case when pendidikan_5.total_pendidikan_5 IS NOT NULL then pendidikan_5.total_pendidikan_5 else 0 end)AS total_pendidikan_5,
                (case when pendidikan_6.total_pendidikan_6 IS NOT NULL then pendidikan_6.total_pendidikan_6 else 0 end)AS total_pendidikan_6,
                (case when pendidikan_7.total_pendidikan_7 IS NOT NULL then pendidikan_7.total_pendidikan_7 else 0 end)AS total_pendidikan_7,
                (case when pendidikan_8.total_pendidikan_8 IS NOT NULL then pendidikan_8.total_pendidikan_8 else 0 end)AS total_pendidikan_8,
                (case when pendidikan_all.total_pendidikan_all IS NOT NULL then pendidikan_all.total_pendidikan_all else 0 end)AS total_pendidikan_all
                FROM ref__states
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_1
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (1) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_1 on pendidikan_1.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_2
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (2) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_2 on pendidikan_2.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_3
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (3) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_3 on pendidikan_3.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_4
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (4) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_4 on pendidikan_4.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_5
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (5) AND spk__imediator.status = 5
                        GROUP BY users__profile.state_id
                ) pendidikan_5 on pendidikan_1.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_6
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (6) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_6 on pendidikan_6.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_7
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (7) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_7 on pendidikan_7.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_8
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (8) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_8 on pendidikan_8.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_all
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_all on pendidikan_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-pendidikan-ppmk',compact('roles_menu'));
        }
    }

    function statistik_mk_pendidikan_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
                SELECT
                ref__states.state_description AS state,
                (case when pendidikan_1.total_pendidikan_1 IS NOT NULL then pendidikan_1.total_pendidikan_1 else 0 end)AS total_pendidikan_1,
                (case when pendidikan_2.total_pendidikan_2 IS NOT NULL then pendidikan_2.total_pendidikan_2 else 0 end)AS total_pendidikan_2,
                (case when pendidikan_3.total_pendidikan_3 IS NOT NULL then pendidikan_3.total_pendidikan_3 else 0 end)AS total_pendidikan_3,
                (case when pendidikan_4.total_pendidikan_4 IS NOT NULL then pendidikan_4.total_pendidikan_4 else 0 end)AS total_pendidikan_4,
                (case when pendidikan_5.total_pendidikan_5 IS NOT NULL then pendidikan_5.total_pendidikan_5 else 0 end)AS total_pendidikan_5,
                (case when pendidikan_6.total_pendidikan_6 IS NOT NULL then pendidikan_6.total_pendidikan_6 else 0 end)AS total_pendidikan_6,
                (case when pendidikan_7.total_pendidikan_7 IS NOT NULL then pendidikan_7.total_pendidikan_7 else 0 end)AS total_pendidikan_7,
                (case when pendidikan_8.total_pendidikan_8 IS NOT NULL then pendidikan_8.total_pendidikan_8 else 0 end)AS total_pendidikan_8,
                (case when pendidikan_all.total_pendidikan_all IS NOT NULL then pendidikan_all.total_pendidikan_all else 0 end)AS total_pendidikan_all
                FROM ref__states
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_1
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (1) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_1 on pendidikan_1.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_2
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (2) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_2 on pendidikan_2.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_3
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (3) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_3 on pendidikan_3.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_4
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (4) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_4 on pendidikan_4.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_5
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (5) AND spk__imediator.status = 5
                        GROUP BY users__profile.state_id
                ) pendidikan_5 on pendidikan_1.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_6
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (6) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_6 on pendidikan_6.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_7
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (7) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_7 on pendidikan_7.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_8
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (8) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_8 on pendidikan_8.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_all
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_all on pendidikan_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-pendidikan-ppn',compact('roles_menu'));
        }
    }

    function statistik_mk_pendidikan_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
                SELECT
                ref__states.state_description AS state,
                (case when pendidikan_1.total_pendidikan_1 IS NOT NULL then pendidikan_1.total_pendidikan_1 else 0 end)AS total_pendidikan_1,
                (case when pendidikan_2.total_pendidikan_2 IS NOT NULL then pendidikan_2.total_pendidikan_2 else 0 end)AS total_pendidikan_2,
                (case when pendidikan_3.total_pendidikan_3 IS NOT NULL then pendidikan_3.total_pendidikan_3 else 0 end)AS total_pendidikan_3,
                (case when pendidikan_4.total_pendidikan_4 IS NOT NULL then pendidikan_4.total_pendidikan_4 else 0 end)AS total_pendidikan_4,
                (case when pendidikan_5.total_pendidikan_5 IS NOT NULL then pendidikan_5.total_pendidikan_5 else 0 end)AS total_pendidikan_5,
                (case when pendidikan_6.total_pendidikan_6 IS NOT NULL then pendidikan_6.total_pendidikan_6 else 0 end)AS total_pendidikan_6,
                (case when pendidikan_7.total_pendidikan_7 IS NOT NULL then pendidikan_7.total_pendidikan_7 else 0 end)AS total_pendidikan_7,
                (case when pendidikan_8.total_pendidikan_8 IS NOT NULL then pendidikan_8.total_pendidikan_8 else 0 end)AS total_pendidikan_8,
                (case when pendidikan_all.total_pendidikan_all IS NOT NULL then pendidikan_all.total_pendidikan_all else 0 end)AS total_pendidikan_all
                FROM ref__states
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_1
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (1) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_1 on pendidikan_1.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_2
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (2) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_2 on pendidikan_2.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_3
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (3) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_3 on pendidikan_3.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_4
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (4) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_4 on pendidikan_4.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_5
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (5) AND spk__imediator.status = 5
                        GROUP BY users__profile.state_id
                ) pendidikan_5 on pendidikan_1.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_6
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (6) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_6 on pendidikan_6.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_7
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (7) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_7 on pendidikan_7.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_8
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (8) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_8 on pendidikan_8.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_all
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_all on pendidikan_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-pendidikan-p',compact('roles_menu'));
        }
    }

    function statistik_mk_pendidikan_upmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
                SELECT
                ref__states.state_description AS state,
                (case when pendidikan_1.total_pendidikan_1 IS NOT NULL then pendidikan_1.total_pendidikan_1 else 0 end)AS total_pendidikan_1,
                (case when pendidikan_2.total_pendidikan_2 IS NOT NULL then pendidikan_2.total_pendidikan_2 else 0 end)AS total_pendidikan_2,
                (case when pendidikan_3.total_pendidikan_3 IS NOT NULL then pendidikan_3.total_pendidikan_3 else 0 end)AS total_pendidikan_3,
                (case when pendidikan_4.total_pendidikan_4 IS NOT NULL then pendidikan_4.total_pendidikan_4 else 0 end)AS total_pendidikan_4,
                (case when pendidikan_5.total_pendidikan_5 IS NOT NULL then pendidikan_5.total_pendidikan_5 else 0 end)AS total_pendidikan_5,
                (case when pendidikan_6.total_pendidikan_6 IS NOT NULL then pendidikan_6.total_pendidikan_6 else 0 end)AS total_pendidikan_6,
                (case when pendidikan_7.total_pendidikan_7 IS NOT NULL then pendidikan_7.total_pendidikan_7 else 0 end)AS total_pendidikan_7,
                (case when pendidikan_8.total_pendidikan_8 IS NOT NULL then pendidikan_8.total_pendidikan_8 else 0 end)AS total_pendidikan_8,
                (case when pendidikan_all.total_pendidikan_all IS NOT NULL then pendidikan_all.total_pendidikan_all else 0 end)AS total_pendidikan_all
                FROM ref__states
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_1
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (1) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_1 on pendidikan_1.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_2
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (2) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_2 on pendidikan_2.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_3
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (3) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_3 on pendidikan_3.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_4
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (4) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_4 on pendidikan_4.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_5
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (5) AND spk__imediator.status = 5
                        GROUP BY users__profile.state_id
                ) pendidikan_5 on pendidikan_1.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_6
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (6) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_6 on pendidikan_6.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_7
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (7) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_7 on pendidikan_7.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_8
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.mkp_pemohon_akademik IN (8) AND spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_8 on pendidikan_8.state_id = ref__states.state_id
                LEFT JOIN (
                        SELECT
                        users__profile.state_id AS state_id,
                        COUNT(*) AS total_pendidikan_all
                        FROM spk__imediator 
                        LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                        WHERE spk__imediator.status = 1
                        GROUP BY users__profile.state_id
                ) pendidikan_all on pendidikan_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-pendidikan-upmk',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function statistik_mk_umur_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
            ref__states.state_description AS state,
            (case when age_1.total_age_1 IS NOT NULL then age_1.total_age_1 else 0 end)AS total_age_1,
            (case when age_2.total_age_2 IS NOT NULL then age_2.total_age_2 else 0 end)AS total_age_2,
            (case when age_3.total_age_3 IS NOT NULL then age_3.total_age_3 else 0 end)AS total_age_3,
            (case when age_4.total_age_4 IS NOT NULL then age_4.total_age_4 else 0 end)AS total_age_4,
            (case when age_5.total_age_5 IS NOT NULL then age_5.total_age_5 else 0 end)AS total_age_5,
            (case when age_all.total_age_all IS NOT NULL then age_all.total_age_all else 0 end)AS total_age_all
            FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_1
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=20 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=30 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_1 on age_1.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_2
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=31 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=40 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_2 on age_2.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_3
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=41 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=50 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_3 on age_3.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_4
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=51 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=60 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_4 on age_4.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_5
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=61 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_5 on age_5.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_all on age_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-umur-ppd',compact('roles_menu'));
        }
    }

    function statistik_mk_umur_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
            ref__states.state_description AS state,
            (case when age_1.total_age_1 IS NOT NULL then age_1.total_age_1 else 0 end)AS total_age_1,
            (case when age_2.total_age_2 IS NOT NULL then age_2.total_age_2 else 0 end)AS total_age_2,
            (case when age_3.total_age_3 IS NOT NULL then age_3.total_age_3 else 0 end)AS total_age_3,
            (case when age_4.total_age_4 IS NOT NULL then age_4.total_age_4 else 0 end)AS total_age_4,
            (case when age_5.total_age_5 IS NOT NULL then age_5.total_age_5 else 0 end)AS total_age_5,
            (case when age_all.total_age_all IS NOT NULL then age_all.total_age_all else 0 end)AS total_age_all
            FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_1
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=20 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=30 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_1 on age_1.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_2
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=31 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=40 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_2 on age_2.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_3
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=41 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=50 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_3 on age_3.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_4
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=51 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=60 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_4 on age_4.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_5
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=61 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_5 on age_5.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_all on age_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-umur-ppmk',compact('roles_menu'));
        }
    }

    function statistik_mk_umur_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
            ref__states.state_description AS state,
            (case when age_1.total_age_1 IS NOT NULL then age_1.total_age_1 else 0 end)AS total_age_1,
            (case when age_2.total_age_2 IS NOT NULL then age_2.total_age_2 else 0 end)AS total_age_2,
            (case when age_3.total_age_3 IS NOT NULL then age_3.total_age_3 else 0 end)AS total_age_3,
            (case when age_4.total_age_4 IS NOT NULL then age_4.total_age_4 else 0 end)AS total_age_4,
            (case when age_5.total_age_5 IS NOT NULL then age_5.total_age_5 else 0 end)AS total_age_5,
            (case when age_all.total_age_all IS NOT NULL then age_all.total_age_all else 0 end)AS total_age_all
            FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_1
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=20 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=30 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_1 on age_1.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_2
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=31 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=40 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_2 on age_2.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_3
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=41 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=50 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_3 on age_3.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_4
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=51 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=60 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_4 on age_4.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_5
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=61 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_5 on age_5.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_all on age_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-umur-ppn',compact('roles_menu'));
        }
    }

    function statistik_mk_umur_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
            ref__states.state_description AS state,
            (case when age_1.total_age_1 IS NOT NULL then age_1.total_age_1 else 0 end)AS total_age_1,
            (case when age_2.total_age_2 IS NOT NULL then age_2.total_age_2 else 0 end)AS total_age_2,
            (case when age_3.total_age_3 IS NOT NULL then age_3.total_age_3 else 0 end)AS total_age_3,
            (case when age_4.total_age_4 IS NOT NULL then age_4.total_age_4 else 0 end)AS total_age_4,
            (case when age_5.total_age_5 IS NOT NULL then age_5.total_age_5 else 0 end)AS total_age_5,
            (case when age_all.total_age_all IS NOT NULL then age_all.total_age_all else 0 end)AS total_age_all
            FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_1
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=20 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=30 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_1 on age_1.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_2
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=31 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=40 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_2 on age_2.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_3
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=41 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=50 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_3 on age_3.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_4
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=51 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=60 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_4 on age_4.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_5
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=61 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_5 on age_5.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_all on age_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-umur-p',compact('roles_menu'));
        }
    }

    function statistik_mk_umur_upmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            
            $data = DB::select(DB::raw("
            SELECT
            ref__states.state_description AS state,
            (case when age_1.total_age_1 IS NOT NULL then age_1.total_age_1 else 0 end)AS total_age_1,
            (case when age_2.total_age_2 IS NOT NULL then age_2.total_age_2 else 0 end)AS total_age_2,
            (case when age_3.total_age_3 IS NOT NULL then age_3.total_age_3 else 0 end)AS total_age_3,
            (case when age_4.total_age_4 IS NOT NULL then age_4.total_age_4 else 0 end)AS total_age_4,
            (case when age_5.total_age_5 IS NOT NULL then age_5.total_age_5 else 0 end)AS total_age_5,
            (case when age_all.total_age_all IS NOT NULL then age_all.total_age_all else 0 end)AS total_age_all
            FROM ref__states
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_1
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=20 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=30 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_1 on age_1.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_2
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=31 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=40 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_2 on age_2.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_3
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=41 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=50 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_3 on age_3.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_4
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=51 AND TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())<=60 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_4 on age_4.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_5
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE())>=61 AND spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_5 on age_5.state_id = ref__states.state_id
            LEFT JOIN (
                    SELECT
                    users__profile.state_id AS state_id,
                    COUNT(*) AS total_age_all
                    FROM spk__imediator 
                    LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                    WHERE spk__imediator.status = 1
                    GROUP BY users__profile.state_id
            ) age_all on age_all.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
            return view('rt-sm32.statistik-mk-umur-upmk',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_mk_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS mk_state,
                ref__daerahs.daerah_description AS mk_daerah,
                ref__parlimens.parlimen_description AS mk_parlimen,
                ref__duns.dun_description AS mk_dun,
                ref__pbts.pbt_description AS mk_pbt,
                spk__imediator.mkp_pemohon_mukim_id AS mk_mukim,
                users__profile.user_fullname AS mk_name,
                users__profile.no_ic AS mk_ic,
                ref__kaum.kaum_description AS mk_kaum,
                TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE()) AS mk_age,
                ref__pendidikan.pendidikan_description AS mk_pendidikan,
                users.user_email AS mk_email,
                users__profile.no_phone AS mk_phone,
                spk__imediator.mkp_pemohon_khusus,
                spk__imediator.mkp_pemohon_alamat_p AS mk_alamat_p,
                spk__imediator.mkp_pemohon_alamat AS mk_alamat,
                ref__spk_mkp_kategori.kategori_description AS mk_kategori,
                ref__spk_mkp_tahap.tahap_description AS mk_tahap,
                DATE_FORMAT(spk__imediator.mkp_tarikh_dilantik,'%d/%m/%Y') AS mk_tarikh_lantik,
                (case when spk__imediator.status_pelanjutan IS NOT NULL then 'Pelanjutan' else 'Pendaftaran' end)AS status_pelanjutan,
                krt__profile.krt_nama AS mk_krt_name
                FROM spk__imediator
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
                LEFT JOIN ref__daerahs ON ref__daerahs.daerah_id = users__profile.daerah_id
                LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
                LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
                LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
                LEFT JOIN ref__kaum ON ref__kaum.id = spk__imediator.mkp_pemohon_kaum_id
                LEFT JOIN ref__pendidikan ON ref__pendidikan.id = spk__imediator.mkp_pemohon_akademik
                LEFT JOIN ref__spk_mkp_kategori ON ref__spk_mkp_kategori.id = spk__imediator.mkp_pemohon_kategori_id
                LEFT JOIN ref__spk_mkp_tahap ON ref__spk_mkp_tahap.id = spk__imediator.mkp_pemohon_tahap_id
                LEFT JOIN krt__profile ON krt__profile.id = spk__imediator.krt_profile_id
                WHERE spk__imediator.status = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-mk-ppd',compact('roles_menu','state'));
        }
    }

    function laporan_mk_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS mk_state,
                ref__daerahs.daerah_description AS mk_daerah,
                ref__parlimens.parlimen_description AS mk_parlimen,
                ref__duns.dun_description AS mk_dun,
                ref__pbts.pbt_description AS mk_pbt,
                spk__imediator.mkp_pemohon_mukim_id AS mk_mukim,
                users__profile.user_fullname AS mk_name,
                users__profile.no_ic AS mk_ic,
                ref__kaum.kaum_description AS mk_kaum,
                TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE()) AS mk_age,
                ref__pendidikan.pendidikan_description AS mk_pendidikan,
                users.user_email AS mk_email,
                users__profile.no_phone AS mk_phone,
                spk__imediator.mkp_pemohon_khusus,
                spk__imediator.mkp_pemohon_alamat_p AS mk_alamat_p,
                spk__imediator.mkp_pemohon_alamat AS mk_alamat,
                ref__spk_mkp_kategori.kategori_description AS mk_kategori,
                ref__spk_mkp_tahap.tahap_description AS mk_tahap,
                DATE_FORMAT(spk__imediator.mkp_tarikh_dilantik,'%d/%m/%Y') AS mk_tarikh_lantik,
                (case when spk__imediator.status_pelanjutan IS NOT NULL then 'Pelanjutan' else 'Pendaftaran' end)AS status_pelanjutan,
                krt__profile.krt_nama AS mk_krt_name
                FROM spk__imediator
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
                LEFT JOIN ref__daerahs ON ref__daerahs.daerah_id = users__profile.daerah_id
                LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
                LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
                LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
                LEFT JOIN ref__kaum ON ref__kaum.id = spk__imediator.mkp_pemohon_kaum_id
                LEFT JOIN ref__pendidikan ON ref__pendidikan.id = spk__imediator.mkp_pemohon_akademik
                LEFT JOIN ref__spk_mkp_kategori ON ref__spk_mkp_kategori.id = spk__imediator.mkp_pemohon_kategori_id
                LEFT JOIN ref__spk_mkp_tahap ON ref__spk_mkp_tahap.id = spk__imediator.mkp_pemohon_tahap_id
                LEFT JOIN krt__profile ON krt__profile.id = spk__imediator.krt_profile_id
                WHERE spk__imediator.status = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-mk-ppmk',compact('roles_menu','state'));
        }
    }

    function laporan_mk_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS mk_state,
                ref__daerahs.daerah_description AS mk_daerah,
                ref__parlimens.parlimen_description AS mk_parlimen,
                ref__duns.dun_description AS mk_dun,
                ref__pbts.pbt_description AS mk_pbt,
                spk__imediator.mkp_pemohon_mukim_id AS mk_mukim,
                users__profile.user_fullname AS mk_name,
                users__profile.no_ic AS mk_ic,
                ref__kaum.kaum_description AS mk_kaum,
                TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE()) AS mk_age,
                ref__pendidikan.pendidikan_description AS mk_pendidikan,
                users.user_email AS mk_email,
                users__profile.no_phone AS mk_phone,
                spk__imediator.mkp_pemohon_khusus,
                spk__imediator.mkp_pemohon_alamat_p AS mk_alamat_p,
                spk__imediator.mkp_pemohon_alamat AS mk_alamat,
                ref__spk_mkp_kategori.kategori_description AS mk_kategori,
                ref__spk_mkp_tahap.tahap_description AS mk_tahap,
                DATE_FORMAT(spk__imediator.mkp_tarikh_dilantik,'%d/%m/%Y') AS mk_tarikh_lantik,
                (case when spk__imediator.status_pelanjutan IS NOT NULL then 'Pelanjutan' else 'Pendaftaran' end)AS status_pelanjutan,
                krt__profile.krt_nama AS mk_krt_name
                FROM spk__imediator
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
                LEFT JOIN ref__daerahs ON ref__daerahs.daerah_id = users__profile.daerah_id
                LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
                LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
                LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
                LEFT JOIN ref__kaum ON ref__kaum.id = spk__imediator.mkp_pemohon_kaum_id
                LEFT JOIN ref__pendidikan ON ref__pendidikan.id = spk__imediator.mkp_pemohon_akademik
                LEFT JOIN ref__spk_mkp_kategori ON ref__spk_mkp_kategori.id = spk__imediator.mkp_pemohon_kategori_id
                LEFT JOIN ref__spk_mkp_tahap ON ref__spk_mkp_tahap.id = spk__imediator.mkp_pemohon_tahap_id
                LEFT JOIN krt__profile ON krt__profile.id = spk__imediator.krt_profile_id
                WHERE spk__imediator.status = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-mk-ppn',compact('roles_menu','state'));
        }
    }

    function laporan_mk_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS mk_state,
                ref__daerahs.daerah_description AS mk_daerah,
                ref__parlimens.parlimen_description AS mk_parlimen,
                ref__duns.dun_description AS mk_dun,
                ref__pbts.pbt_description AS mk_pbt,
                spk__imediator.mkp_pemohon_mukim_id AS mk_mukim,
                users__profile.user_fullname AS mk_name,
                users__profile.no_ic AS mk_ic,
                ref__kaum.kaum_description AS mk_kaum,
                TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE()) AS mk_age,
                ref__pendidikan.pendidikan_description AS mk_pendidikan,
                users.user_email AS mk_email,
                users__profile.no_phone AS mk_phone,
                spk__imediator.mkp_pemohon_khusus,
                spk__imediator.mkp_pemohon_alamat_p AS mk_alamat_p,
                spk__imediator.mkp_pemohon_alamat AS mk_alamat,
                ref__spk_mkp_kategori.kategori_description AS mk_kategori,
                ref__spk_mkp_tahap.tahap_description AS mk_tahap,
                DATE_FORMAT(spk__imediator.mkp_tarikh_dilantik,'%d/%m/%Y') AS mk_tarikh_lantik,
                (case when spk__imediator.status_pelanjutan IS NOT NULL then 'Pelanjutan' else 'Pendaftaran' end)AS status_pelanjutan,
                krt__profile.krt_nama AS mk_krt_name
                FROM spk__imediator
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
                LEFT JOIN ref__daerahs ON ref__daerahs.daerah_id = users__profile.daerah_id
                LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
                LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
                LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
                LEFT JOIN ref__kaum ON ref__kaum.id = spk__imediator.mkp_pemohon_kaum_id
                LEFT JOIN ref__pendidikan ON ref__pendidikan.id = spk__imediator.mkp_pemohon_akademik
                LEFT JOIN ref__spk_mkp_kategori ON ref__spk_mkp_kategori.id = spk__imediator.mkp_pemohon_kategori_id
                LEFT JOIN ref__spk_mkp_tahap ON ref__spk_mkp_tahap.id = spk__imediator.mkp_pemohon_tahap_id
                LEFT JOIN krt__profile ON krt__profile.id = spk__imediator.krt_profile_id
                WHERE spk__imediator.status = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-mk-p',compact('roles_menu','state'));
        }
    }

    function laporan_mk_upmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS mk_state,
                ref__daerahs.daerah_description AS mk_daerah,
                ref__parlimens.parlimen_description AS mk_parlimen,
                ref__duns.dun_description AS mk_dun,
                ref__pbts.pbt_description AS mk_pbt,
                spk__imediator.mkp_pemohon_mukim_id AS mk_mukim,
                users__profile.user_fullname AS mk_name,
                users__profile.no_ic AS mk_ic,
                ref__kaum.kaum_description AS mk_kaum,
                TIMESTAMPDIFF(YEAR, spk__imediator.mkp_pemohon_tarikh_lahir, CURDATE()) AS mk_age,
                ref__pendidikan.pendidikan_description AS mk_pendidikan,
                users.user_email AS mk_email,
                users__profile.no_phone AS mk_phone,
                spk__imediator.mkp_pemohon_khusus,
                spk__imediator.mkp_pemohon_alamat_p AS mk_alamat_p,
                spk__imediator.mkp_pemohon_alamat AS mk_alamat,
                ref__spk_mkp_kategori.kategori_description AS mk_kategori,
                ref__spk_mkp_tahap.tahap_description AS mk_tahap,
                DATE_FORMAT(spk__imediator.mkp_tarikh_dilantik,'%d/%m/%Y') AS mk_tarikh_lantik,
                (case when spk__imediator.status_pelanjutan IS NOT NULL then 'Pelanjutan' else 'Pendaftaran' end)AS status_pelanjutan,
                krt__profile.krt_nama AS mk_krt_name
                FROM spk__imediator
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
                LEFT JOIN ref__daerahs ON ref__daerahs.daerah_id = users__profile.daerah_id
                LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
                LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
                LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
                LEFT JOIN ref__kaum ON ref__kaum.id = spk__imediator.mkp_pemohon_kaum_id
                LEFT JOIN ref__pendidikan ON ref__pendidikan.id = spk__imediator.mkp_pemohon_akademik
                LEFT JOIN ref__spk_mkp_kategori ON ref__spk_mkp_kategori.id = spk__imediator.mkp_pemohon_kategori_id
                LEFT JOIN ref__spk_mkp_tahap ON ref__spk_mkp_tahap.id = spk__imediator.mkp_pemohon_tahap_id
                LEFT JOIN krt__profile ON krt__profile.id = spk__imediator.krt_profile_id
                WHERE spk__imediator.status = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-mk-upmk',compact('roles_menu','state'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_keaktifan_mk_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                spk__imediator_keaktifan.id,
                ref__states.state_description AS mk_state,
                ref__daerahs.daerah_description As mk_daerah,
                ref__parlimens.parlimen_description AS mk_parlimen,
                ref__duns.dun_description AS mk_dun,
                ref__pbts.pbt_description AS mk_pbt,
                users__profile.user_fullname AS mk_name,
                users__profile.no_ic AS mk_ic,
                (case when selesai.total_selesai IS NOT NULL then selesai.total_selesai else 0 end)AS kes_selesai,
                (case when xselesai.total_xselesai IS NOT NULL then xselesai.total_xselesai else 0 end)AS kes_xselesai,
                (case when aktiviti.total_aktiviti IS NOT NULL then aktiviti.total_aktiviti else 0 end)AS total_aktiviti,
                (case when latihan.total_latihan IS NOT NULL then latihan.total_latihan else 0 end)AS total_latihan
                FROM spk__imediator_keaktifan
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
                LEFT JOIN ref__daerahs On ref__daerahs.daerah_id = users__profile.daerah_id
                LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
                LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
                LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_selesai
                        FROM spk__imediator_mediasi 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                        WHERE spk__imediator_mediasi.mediasi_status_kes = 'Selesai'
                        GROUP BY spk__imediator.id
                        ) selesai on selesai.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_xselesai
                        FROM spk__imediator_mediasi 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                        WHERE spk__imediator_mediasi.mediasi_status_kes = 'Tidak Selesai'
                        GROUP BY spk__imediator.id
                        ) xselesai on xselesai.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_aktiviti
                        FROM spk__imediator_keaktifan_aktiviti 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan_aktiviti.spk_imediator_id
                        GROUP BY spk__imediator.id
                        ) aktiviti on aktiviti.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_latihan
                        FROM spk__imediator_keaktifan_latihan 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan_latihan.spk_imediator_id
                        GROUP BY spk__imediator.id
                        ) latihan on latihan.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                WHERE spk__imediator_keaktifan.status = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-keaktifan-mk-ppd',compact('roles_menu','state'));
        }
    }

    function laporan_keaktifan_mk_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                spk__imediator_keaktifan.id,
                ref__states.state_description AS mk_state,
                ref__daerahs.daerah_description As mk_daerah,
                ref__parlimens.parlimen_description AS mk_parlimen,
                ref__duns.dun_description AS mk_dun,
                ref__pbts.pbt_description AS mk_pbt,
                users__profile.user_fullname AS mk_name,
                users__profile.no_ic AS mk_ic,
                (case when selesai.total_selesai IS NOT NULL then selesai.total_selesai else 0 end)AS kes_selesai,
                (case when xselesai.total_xselesai IS NOT NULL then xselesai.total_xselesai else 0 end)AS kes_xselesai,
                (case when aktiviti.total_aktiviti IS NOT NULL then aktiviti.total_aktiviti else 0 end)AS total_aktiviti,
                (case when latihan.total_latihan IS NOT NULL then latihan.total_latihan else 0 end)AS total_latihan
                FROM spk__imediator_keaktifan
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
                LEFT JOIN ref__daerahs On ref__daerahs.daerah_id = users__profile.daerah_id
                LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
                LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
                LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_selesai
                        FROM spk__imediator_mediasi 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                        WHERE spk__imediator_mediasi.mediasi_status_kes = 'Selesai'
                        GROUP BY spk__imediator.id
                        ) selesai on selesai.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_xselesai
                        FROM spk__imediator_mediasi 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                        WHERE spk__imediator_mediasi.mediasi_status_kes = 'Tidak Selesai'
                        GROUP BY spk__imediator.id
                        ) xselesai on xselesai.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_aktiviti
                        FROM spk__imediator_keaktifan_aktiviti 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan_aktiviti.spk_imediator_id
                        GROUP BY spk__imediator.id
                        ) aktiviti on aktiviti.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_latihan
                        FROM spk__imediator_keaktifan_latihan 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan_latihan.spk_imediator_id
                        GROUP BY spk__imediator.id
                        ) latihan on latihan.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                WHERE spk__imediator_keaktifan.status = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-keaktifan-mk-ppmk',compact('roles_menu','state'));
        }
    }

    function laporan_keaktifan_mk_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                spk__imediator_keaktifan.id,
                ref__states.state_description AS mk_state,
                ref__daerahs.daerah_description As mk_daerah,
                ref__parlimens.parlimen_description AS mk_parlimen,
                ref__duns.dun_description AS mk_dun,
                ref__pbts.pbt_description AS mk_pbt,
                users__profile.user_fullname AS mk_name,
                users__profile.no_ic AS mk_ic,
                (case when selesai.total_selesai IS NOT NULL then selesai.total_selesai else 0 end)AS kes_selesai,
                (case when xselesai.total_xselesai IS NOT NULL then xselesai.total_xselesai else 0 end)AS kes_xselesai,
                (case when aktiviti.total_aktiviti IS NOT NULL then aktiviti.total_aktiviti else 0 end)AS total_aktiviti,
                (case when latihan.total_latihan IS NOT NULL then latihan.total_latihan else 0 end)AS total_latihan
                FROM spk__imediator_keaktifan
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
                LEFT JOIN ref__daerahs On ref__daerahs.daerah_id = users__profile.daerah_id
                LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
                LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
                LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_selesai
                        FROM spk__imediator_mediasi 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                        WHERE spk__imediator_mediasi.mediasi_status_kes = 'Selesai'
                        GROUP BY spk__imediator.id
                        ) selesai on selesai.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_xselesai
                        FROM spk__imediator_mediasi 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                        WHERE spk__imediator_mediasi.mediasi_status_kes = 'Tidak Selesai'
                        GROUP BY spk__imediator.id
                        ) xselesai on xselesai.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_aktiviti
                        FROM spk__imediator_keaktifan_aktiviti 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan_aktiviti.spk_imediator_id
                        GROUP BY spk__imediator.id
                        ) aktiviti on aktiviti.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_latihan
                        FROM spk__imediator_keaktifan_latihan 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan_latihan.spk_imediator_id
                        GROUP BY spk__imediator.id
                        ) latihan on latihan.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                WHERE spk__imediator_keaktifan.status = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-keaktifan-mk-ppn',compact('roles_menu','state'));
        }
    }

    function laporan_keaktifan_mk_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                spk__imediator_keaktifan.id,
                ref__states.state_description AS mk_state,
                ref__daerahs.daerah_description As mk_daerah,
                ref__parlimens.parlimen_description AS mk_parlimen,
                ref__duns.dun_description AS mk_dun,
                ref__pbts.pbt_description AS mk_pbt,
                users__profile.user_fullname AS mk_name,
                users__profile.no_ic AS mk_ic,
                (case when selesai.total_selesai IS NOT NULL then selesai.total_selesai else 0 end)AS kes_selesai,
                (case when xselesai.total_xselesai IS NOT NULL then xselesai.total_xselesai else 0 end)AS kes_xselesai,
                (case when aktiviti.total_aktiviti IS NOT NULL then aktiviti.total_aktiviti else 0 end)AS total_aktiviti,
                (case when latihan.total_latihan IS NOT NULL then latihan.total_latihan else 0 end)AS total_latihan
                FROM spk__imediator_keaktifan
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
                LEFT JOIN ref__daerahs On ref__daerahs.daerah_id = users__profile.daerah_id
                LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
                LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
                LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_selesai
                        FROM spk__imediator_mediasi 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                        WHERE spk__imediator_mediasi.mediasi_status_kes = 'Selesai'
                        GROUP BY spk__imediator.id
                        ) selesai on selesai.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_xselesai
                        FROM spk__imediator_mediasi 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                        WHERE spk__imediator_mediasi.mediasi_status_kes = 'Tidak Selesai'
                        GROUP BY spk__imediator.id
                        ) xselesai on xselesai.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_aktiviti
                        FROM spk__imediator_keaktifan_aktiviti 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan_aktiviti.spk_imediator_id
                        GROUP BY spk__imediator.id
                        ) aktiviti on aktiviti.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_latihan
                        FROM spk__imediator_keaktifan_latihan 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan_latihan.spk_imediator_id
                        GROUP BY spk__imediator.id
                        ) latihan on latihan.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                WHERE spk__imediator_keaktifan.status = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-keaktifan-mk-p',compact('roles_menu','state'));
        }
    }

    function laporan_keaktifan_mk_upmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                spk__imediator_keaktifan.id,
                ref__states.state_description AS mk_state,
                ref__daerahs.daerah_description As mk_daerah,
                ref__parlimens.parlimen_description AS mk_parlimen,
                ref__duns.dun_description AS mk_dun,
                ref__pbts.pbt_description AS mk_pbt,
                users__profile.user_fullname AS mk_name,
                users__profile.no_ic AS mk_ic,
                (case when selesai.total_selesai IS NOT NULL then selesai.total_selesai else 0 end)AS kes_selesai,
                (case when xselesai.total_xselesai IS NOT NULL then xselesai.total_xselesai else 0 end)AS kes_xselesai,
                (case when aktiviti.total_aktiviti IS NOT NULL then aktiviti.total_aktiviti else 0 end)AS total_aktiviti,
                (case when latihan.total_latihan IS NOT NULL then latihan.total_latihan else 0 end)AS total_latihan
                FROM spk__imediator_keaktifan
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
                LEFT JOIN ref__daerahs On ref__daerahs.daerah_id = users__profile.daerah_id
                LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
                LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
                LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_selesai
                        FROM spk__imediator_mediasi 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                        WHERE spk__imediator_mediasi.mediasi_status_kes = 'Selesai'
                        GROUP BY spk__imediator.id
                        ) selesai on selesai.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_xselesai
                        FROM spk__imediator_mediasi 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                        WHERE spk__imediator_mediasi.mediasi_status_kes = 'Tidak Selesai'
                        GROUP BY spk__imediator.id
                        ) xselesai on xselesai.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_aktiviti
                        FROM spk__imediator_keaktifan_aktiviti 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan_aktiviti.spk_imediator_id
                        GROUP BY spk__imediator.id
                        ) aktiviti on aktiviti.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_latihan
                        FROM spk__imediator_keaktifan_latihan 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan_latihan.spk_imediator_id
                        GROUP BY spk__imediator.id
                        ) latihan on latihan.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                WHERE spk__imediator_keaktifan.status = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-keaktifan-mk-upmk',compact('roles_menu','state'));
        }
    }

    function laporan_keaktifan_mk_k(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT
                spk__imediator_keaktifan.id,
                ref__states.state_description AS mk_state,
                ref__daerahs.daerah_description As mk_daerah,
                ref__parlimens.parlimen_description AS mk_parlimen,
                ref__duns.dun_description AS mk_dun,
                ref__pbts.pbt_description AS mk_pbt,
                users__profile.user_fullname AS mk_name,
                users__profile.no_ic AS mk_ic,
                (case when selesai.total_selesai IS NOT NULL then selesai.total_selesai else 0 end)AS kes_selesai,
                (case when xselesai.total_xselesai IS NOT NULL then xselesai.total_xselesai else 0 end)AS kes_xselesai,
                (case when aktiviti.total_aktiviti IS NOT NULL then aktiviti.total_aktiviti else 0 end)AS total_aktiviti,
                (case when latihan.total_latihan IS NOT NULL then latihan.total_latihan else 0 end)AS total_latihan
                FROM spk__imediator_keaktifan
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
                LEFT JOIN ref__daerahs On ref__daerahs.daerah_id = users__profile.daerah_id
                LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
                LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
                LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_selesai
                        FROM spk__imediator_mediasi 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                        WHERE spk__imediator_mediasi.mediasi_status_kes = 'Selesai'
                        GROUP BY spk__imediator.id
                        ) selesai on selesai.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_xselesai
                        FROM spk__imediator_mediasi 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                        WHERE spk__imediator_mediasi.mediasi_status_kes = 'Tidak Selesai'
                        GROUP BY spk__imediator.id
                        ) xselesai on xselesai.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_aktiviti
                        FROM spk__imediator_keaktifan_aktiviti 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan_aktiviti.spk_imediator_id
                        GROUP BY spk__imediator.id
                        ) aktiviti on aktiviti.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                LEFT JOIN (
                SELECT
                        spk__imediator.id AS mkp_id,
                        COUNT(*) AS total_latihan
                        FROM spk__imediator_keaktifan_latihan 
                        LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_keaktifan_latihan.spk_imediator_id
                        GROUP BY spk__imediator.id
                        ) latihan on latihan.mkp_id = spk__imediator_keaktifan.spk_imediator_id
                WHERE spk__imediator_keaktifan.status = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
                $roles_menu     = DB::table('roles__menu')
                                ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                                ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                                ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                                ->where('users__roles.user_id', '=', Auth::user()->user_id)
                                ->where('roles__menu.status', '=', true)
                                ->orderBy('first_menu', 'asc')
                                ->orderBy('id', 'asc')
                                ->get();
                $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-keaktifan-mk-k',compact('roles_menu','state'));
        }
    }

    function keaktifan_mkp_individu_ppd(Request $request, $id){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $mediasi_kluster            = Ref_SPK_MKP_Mediasi::where('status', '=', true)->get();
            $mediasi_status             = Ref_SPK_MKP_Mediasi_Status::where('status', '=', true)->get();
            $mediasi_peringkat          = Ref_SPK_MKP_Peringkat::where('status', '=', true)->get();
            $mkp                        = DB::table('spk__imediator')
                                        ->select('spk__imediator.id AS id',
                                                'spk__imediator_keaktifan.id AS spk_imediator_id',
                                                'users__profile.user_fullname AS mkp_nama',
                                                'users__profile.no_ic AS mkp_no_ic',
                                                'users__profile.no_phone AS mkp_no_phone',
                                                'users.user_email AS user_email',
                                                'spk__imediator_keaktifan.status AS status',
                                                DB::raw(" CONCAT('MKP','/',users__profile.state_id,'/',users__profile.daerah_id,'/',spk__imediator.id) AS no_rujukan_mkp"),
                                                'ref__status_spk_imediator_keaktifan.status_description AS status_description')
                                        ->leftJoin('users__profile','users__profile.user_id','=','spk__imediator.user_id')
                                        ->leftJoin('users','users.user_id','=','spk__imediator.user_id')
                                        ->leftJoin('spk__imediator_keaktifan','spk__imediator_keaktifan.spk_imediator_id','=','spk__imediator.id')
                                        ->leftJoin('ref__status_spk_imediator_keaktifan','ref__status_spk_imediator_keaktifan.id','=','spk__imediator_keaktifan.status')
                                        ->where('spk__imediator_keaktifan.id', '=', $id)
                                        ->limit(1)
                                        ->first();
            $total_kes                  = DB::table('spk__imediator_mediasi')
                                        ->select(DB::raw('count(*) as total_kes'))
                                        ->leftJoin('spk__imediator','spk__imediator.id','=','spk__imediator_mediasi.spk_imediator_id')
                                        ->leftJoin('spk__imediator_keaktifan','spk__imediator_keaktifan.spk_imediator_id','=','spk__imediator.id')
                                        ->where('spk__imediator_keaktifan.id', '=', $id)
                                        ->limit(1)
                                        ->first();
            return view('rt-sm32.keaktifan-mkp-individu-ppd', 
            compact('roles_menu','mediasi_kluster', 'mediasi_status', 'mediasi_peringkat', 'mkp', 'total_kes'));
        }
    }

    function keaktifan_mkp_individu_ppmk(Request $request, $id){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $mediasi_kluster            = Ref_SPK_MKP_Mediasi::where('status', '=', true)->get();
            $mediasi_status             = Ref_SPK_MKP_Mediasi_Status::where('status', '=', true)->get();
            $mediasi_peringkat          = Ref_SPK_MKP_Peringkat::where('status', '=', true)->get();
            $mkp                        = DB::table('spk__imediator')
                                        ->select('spk__imediator.id AS id',
                                                'spk__imediator_keaktifan.id AS spk_imediator_id',
                                                'users__profile.user_fullname AS mkp_nama',
                                                'users__profile.no_ic AS mkp_no_ic',
                                                'users__profile.no_phone AS mkp_no_phone',
                                                'users.user_email AS user_email',
                                                'spk__imediator_keaktifan.status AS status',
                                                DB::raw(" CONCAT('MKP','/',users__profile.state_id,'/',users__profile.daerah_id,'/',spk__imediator.id) AS no_rujukan_mkp"),
                                                'ref__status_spk_imediator_keaktifan.status_description AS status_description')
                                        ->leftJoin('users__profile','users__profile.user_id','=','spk__imediator.user_id')
                                        ->leftJoin('users','users.user_id','=','spk__imediator.user_id')
                                        ->leftJoin('spk__imediator_keaktifan','spk__imediator_keaktifan.spk_imediator_id','=','spk__imediator.id')
                                        ->leftJoin('ref__status_spk_imediator_keaktifan','ref__status_spk_imediator_keaktifan.id','=','spk__imediator_keaktifan.status')
                                        ->where('spk__imediator_keaktifan.id', '=', $id)
                                        ->limit(1)
                                        ->first();
            $total_kes                  = DB::table('spk__imediator_mediasi')
                                        ->select(DB::raw('count(*) as total_kes'))
                                        ->leftJoin('spk__imediator','spk__imediator.id','=','spk__imediator_mediasi.spk_imediator_id')
                                        ->leftJoin('spk__imediator_keaktifan','spk__imediator_keaktifan.spk_imediator_id','=','spk__imediator.id')
                                        ->where('spk__imediator_keaktifan.id', '=', $id)
                                        ->limit(1)
                                        ->first();
            return view('rt-sm32.keaktifan-mkp-individu-ppmk', 
            compact('roles_menu','mediasi_kluster', 'mediasi_status', 'mediasi_peringkat', 'mkp', 'total_kes'));
        }
    }

    function keaktifan_mkp_individu_ppn(Request $request, $id){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $mediasi_kluster            = Ref_SPK_MKP_Mediasi::where('status', '=', true)->get();
            $mediasi_status             = Ref_SPK_MKP_Mediasi_Status::where('status', '=', true)->get();
            $mediasi_peringkat          = Ref_SPK_MKP_Peringkat::where('status', '=', true)->get();
            $mkp                        = DB::table('spk__imediator')
                                        ->select('spk__imediator.id AS id',
                                                'spk__imediator_keaktifan.id AS spk_imediator_id',
                                                'users__profile.user_fullname AS mkp_nama',
                                                'users__profile.no_ic AS mkp_no_ic',
                                                'users__profile.no_phone AS mkp_no_phone',
                                                'users.user_email AS user_email',
                                                'spk__imediator_keaktifan.status AS status',
                                                DB::raw(" CONCAT('MKP','/',users__profile.state_id,'/',users__profile.daerah_id,'/',spk__imediator.id) AS no_rujukan_mkp"),
                                                'ref__status_spk_imediator_keaktifan.status_description AS status_description')
                                        ->leftJoin('users__profile','users__profile.user_id','=','spk__imediator.user_id')
                                        ->leftJoin('users','users.user_id','=','spk__imediator.user_id')
                                        ->leftJoin('spk__imediator_keaktifan','spk__imediator_keaktifan.spk_imediator_id','=','spk__imediator.id')
                                        ->leftJoin('ref__status_spk_imediator_keaktifan','ref__status_spk_imediator_keaktifan.id','=','spk__imediator_keaktifan.status')
                                        ->where('spk__imediator_keaktifan.id', '=', $id)
                                        ->limit(1)
                                        ->first();
            $total_kes                  = DB::table('spk__imediator_mediasi')
                                        ->select(DB::raw('count(*) as total_kes'))
                                        ->leftJoin('spk__imediator','spk__imediator.id','=','spk__imediator_mediasi.spk_imediator_id')
                                        ->leftJoin('spk__imediator_keaktifan','spk__imediator_keaktifan.spk_imediator_id','=','spk__imediator.id')
                                        ->where('spk__imediator_keaktifan.id', '=', $id)
                                        ->limit(1)
                                        ->first();
            return view('rt-sm32.keaktifan-mkp-individu-ppn', 
            compact('roles_menu','mediasi_kluster', 'mediasi_status', 'mediasi_peringkat', 'mkp', 'total_kes'));
        }
    }

    function keaktifan_mkp_individu_upmk(Request $request, $id){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $mediasi_kluster            = Ref_SPK_MKP_Mediasi::where('status', '=', true)->get();
            $mediasi_status             = Ref_SPK_MKP_Mediasi_Status::where('status', '=', true)->get();
            $mediasi_peringkat          = Ref_SPK_MKP_Peringkat::where('status', '=', true)->get();
            $mkp                        = DB::table('spk__imediator')
                                        ->select('spk__imediator.id AS id',
                                                'spk__imediator_keaktifan.id AS spk_imediator_id',
                                                'users__profile.user_fullname AS mkp_nama',
                                                'users__profile.no_ic AS mkp_no_ic',
                                                'users__profile.no_phone AS mkp_no_phone',
                                                'users.user_email AS user_email',
                                                'spk__imediator_keaktifan.status AS status',
                                                DB::raw(" CONCAT('MKP','/',users__profile.state_id,'/',users__profile.daerah_id,'/',spk__imediator.id) AS no_rujukan_mkp"),
                                                'ref__status_spk_imediator_keaktifan.status_description AS status_description')
                                        ->leftJoin('users__profile','users__profile.user_id','=','spk__imediator.user_id')
                                        ->leftJoin('users','users.user_id','=','spk__imediator.user_id')
                                        ->leftJoin('spk__imediator_keaktifan','spk__imediator_keaktifan.spk_imediator_id','=','spk__imediator.id')
                                        ->leftJoin('ref__status_spk_imediator_keaktifan','ref__status_spk_imediator_keaktifan.id','=','spk__imediator_keaktifan.status')
                                        ->where('spk__imediator_keaktifan.id', '=', $id)
                                        ->limit(1)
                                        ->first();
            $total_kes                  = DB::table('spk__imediator_mediasi')
                                        ->select(DB::raw('count(*) as total_kes'))
                                        ->leftJoin('spk__imediator','spk__imediator.id','=','spk__imediator_mediasi.spk_imediator_id')
                                        ->leftJoin('spk__imediator_keaktifan','spk__imediator_keaktifan.spk_imediator_id','=','spk__imediator.id')
                                        ->where('spk__imediator_keaktifan.id', '=', $id)
                                        ->limit(1)
                                        ->first();
            return view('rt-sm32.keaktifan-mkp-individu-upmk', 
            compact('roles_menu','mediasi_kluster', 'mediasi_status', 'mediasi_peringkat', 'mkp', 'total_kes'));
        }
    }

    function keaktifan_mkp_individu_p(Request $request, $id){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $mediasi_kluster            = Ref_SPK_MKP_Mediasi::where('status', '=', true)->get();
            $mediasi_status             = Ref_SPK_MKP_Mediasi_Status::where('status', '=', true)->get();
            $mediasi_peringkat          = Ref_SPK_MKP_Peringkat::where('status', '=', true)->get();
            $mkp                        = DB::table('spk__imediator')
                                        ->select('spk__imediator.id AS id',
                                                'spk__imediator_keaktifan.id AS spk_imediator_id',
                                                'users__profile.user_fullname AS mkp_nama',
                                                'users__profile.no_ic AS mkp_no_ic',
                                                'users__profile.no_phone AS mkp_no_phone',
                                                'users.user_email AS user_email',
                                                'spk__imediator_keaktifan.status AS status',
                                                DB::raw(" CONCAT('MKP','/',users__profile.state_id,'/',users__profile.daerah_id,'/',spk__imediator.id) AS no_rujukan_mkp"),
                                                'ref__status_spk_imediator_keaktifan.status_description AS status_description')
                                        ->leftJoin('users__profile','users__profile.user_id','=','spk__imediator.user_id')
                                        ->leftJoin('users','users.user_id','=','spk__imediator.user_id')
                                        ->leftJoin('spk__imediator_keaktifan','spk__imediator_keaktifan.spk_imediator_id','=','spk__imediator.id')
                                        ->leftJoin('ref__status_spk_imediator_keaktifan','ref__status_spk_imediator_keaktifan.id','=','spk__imediator_keaktifan.status')
                                        ->where('spk__imediator_keaktifan.id', '=', $id)
                                        ->limit(1)
                                        ->first();
            $total_kes                  = DB::table('spk__imediator_mediasi')
                                        ->select(DB::raw('count(*) as total_kes'))
                                        ->leftJoin('spk__imediator','spk__imediator.id','=','spk__imediator_mediasi.spk_imediator_id')
                                        ->leftJoin('spk__imediator_keaktifan','spk__imediator_keaktifan.spk_imediator_id','=','spk__imediator.id')
                                        ->where('spk__imediator_keaktifan.id', '=', $id)
                                        ->limit(1)
                                        ->first();
            return view('rt-sm32.keaktifan-mkp-individu-p', 
            compact('roles_menu','mediasi_kluster', 'mediasi_status', 'mediasi_peringkat', 'mkp', 'total_kes'));
        }
    }

    function keaktifan_mkp_individu_kp(Request $request, $id){
        if($request->ajax()){ 
            $type = $request->type;
            
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $mediasi_kluster            = Ref_SPK_MKP_Mediasi::where('status', '=', true)->get();
            $mediasi_status             = Ref_SPK_MKP_Mediasi_Status::where('status', '=', true)->get();
            $mediasi_peringkat          = Ref_SPK_MKP_Peringkat::where('status', '=', true)->get();
            $mkp                        = DB::table('spk__imediator')
                                        ->select('spk__imediator.id AS id',
                                                'spk__imediator_keaktifan.id AS spk_imediator_id',
                                                'users__profile.user_fullname AS mkp_nama',
                                                'users__profile.no_ic AS mkp_no_ic',
                                                'users__profile.no_phone AS mkp_no_phone',
                                                'users.user_email AS user_email',
                                                'spk__imediator_keaktifan.status AS status',
                                                DB::raw(" CONCAT('MKP','/',users__profile.state_id,'/',users__profile.daerah_id,'/',spk__imediator.id) AS no_rujukan_mkp"),
                                                'ref__status_spk_imediator_keaktifan.status_description AS status_description')
                                        ->leftJoin('users__profile','users__profile.user_id','=','spk__imediator.user_id')
                                        ->leftJoin('users','users.user_id','=','spk__imediator.user_id')
                                        ->leftJoin('spk__imediator_keaktifan','spk__imediator_keaktifan.spk_imediator_id','=','spk__imediator.id')
                                        ->leftJoin('ref__status_spk_imediator_keaktifan','ref__status_spk_imediator_keaktifan.id','=','spk__imediator_keaktifan.status')
                                        ->where('spk__imediator_keaktifan.id', '=', $id)
                                        ->limit(1)
                                        ->first();
            $total_kes                  = DB::table('spk__imediator_mediasi')
                                        ->select(DB::raw('count(*) as total_kes'))
                                        ->leftJoin('spk__imediator','spk__imediator.id','=','spk__imediator_mediasi.spk_imediator_id')
                                        ->leftJoin('spk__imediator_keaktifan','spk__imediator_keaktifan.spk_imediator_id','=','spk__imediator.id')
                                        ->where('spk__imediator_keaktifan.id', '=', $id)
                                        ->limit(1)
                                        ->first();
            return view('rt-sm32.keaktifan-mkp-individu-kp', 
            compact('roles_menu','mediasi_kluster', 'mediasi_status', 'mediasi_peringkat', 'mkp', 'total_kes'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_pelanjutan_mkp_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            $data = DB::select(DB::raw("
            SELECT spk__imediator.id AS id,
            ref__states.state_description AS state_description,
            ref__daerahs.daerah_description AS daerah_description,
            ref__parlimens.parlimen_description AS parlimen_description,
            ref__duns.dun_description AS dun_description,
            ref__pbts.pbt_description AS pbt_description,
            users__profile.user_fullname AS mkp_pemohon_nama,
            users__profile.no_ic AS mkp_pemohon_ic,
            users__profile.no_phone AS mkp_pemohon_no_phone,
            users.user_email AS mkp_pemohon_email,
            DATE_FORMAT(spk__imediator.mkp_tarikh_dilantik,'%d/%m/%Y') AS mkp_tarikh_dilantik,
            DATE_FORMAT(DATE_ADD(spk__imediator.mkp_tarikh_dilantik, INTERVAL 548 DAY),'%d/%m/%Y') AS tarikh_kemaskini,
            DATE_FORMAT(DATE_ADD(spk__imediator.mkp_tarikh_dilantik, INTERVAL 731 DAY),'%d/%m/%Y') AS tarikh_tamat,
            (case when a.count_kes >= 2 AND b.count_aktiviti >= 2 AND c.count_latihan >= 2 then 'Layak' else 'Tidak Layak' end)AS status_kelayakan,
            ref__status_spk_imediator.status_description AS status_pelanjutan,
            spk__imediator.status_pelanjutan AS status
            FROM spk__imediator
            LEFT JOIN users ON users.user_id = spk__imediator.user_id
            LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
            LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
            LEFT JOIN ref__daerahs ON ref__daerahs.daerah_id = users__profile.daerah_id
            LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
            LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
            LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
            LEFT JOIN ref__status_spk_imediator ON ref__status_spk_imediator.id = spk__imediator.status_pelanjutan
            LEFT JOIN (
                            SELECT spk__imediator_mediasi.spk_imediator_id, count(*) AS count_kes
                            FROM spk__imediator_mediasi
                            GROUP BY spk__imediator_mediasi.spk_imediator_id
            ) a ON a.spk_imediator_id = spk__imediator.id
            LEFT JOIN (
                            SELECT spk__imediator_keaktifan_aktiviti.spk_imediator_id, count(*) AS count_aktiviti
                            FROM spk__imediator_keaktifan_aktiviti
                            GROUP BY spk__imediator_keaktifan_aktiviti.spk_imediator_id
            ) b ON b.spk_imediator_id = spk__imediator.id
            LEFT JOIN (
                            SELECT spk__imediator_keaktifan_latihan.spk_imediator_id, count(*) AS count_latihan
                            FROM spk__imediator_keaktifan_latihan
                            GROUP BY spk__imediator_keaktifan_latihan.spk_imediator_id
            ) c ON c.spk_imediator_id = spk__imediator.id
            WHERE users__profile.daerah_id = '" . Auth::user()->daerah_id . "' AND spk__imediator.status_pelanjutan = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            return view('rt-sm32.laporan-pelanjutan-mkp-ppd',compact('roles_menu'));
        }
    }

    function laporan_pelanjutan_mkp_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT spk__imediator.id AS id,
            ref__states.state_description AS state_description,
            ref__daerahs.daerah_description AS daerah_description,
            ref__parlimens.parlimen_description AS parlimen_description,
            ref__duns.dun_description AS dun_description,
            ref__pbts.pbt_description AS pbt_description,
            users__profile.user_fullname AS mkp_pemohon_nama,
            users__profile.no_ic AS mkp_pemohon_ic,
            users__profile.no_phone AS mkp_pemohon_no_phone,
            users.user_email AS mkp_pemohon_email,
            DATE_FORMAT(spk__imediator.mkp_tarikh_dilantik,'%d/%m/%Y') AS mkp_tarikh_dilantik,
            DATE_FORMAT(DATE_ADD(spk__imediator.mkp_tarikh_dilantik, INTERVAL 548 DAY),'%d/%m/%Y') AS tarikh_kemaskini,
            DATE_FORMAT(DATE_ADD(spk__imediator.mkp_tarikh_dilantik, INTERVAL 731 DAY),'%d/%m/%Y') AS tarikh_tamat,
            (case when a.count_kes >= 2 AND b.count_aktiviti >= 2 AND c.count_latihan >= 2 then 'Layak' else 'Tidak Layak' end)AS status_kelayakan,
            ref__status_spk_imediator.status_description AS status_pelanjutan,
            spk__imediator.status_pelanjutan AS status
            FROM spk__imediator
            LEFT JOIN users ON users.user_id = spk__imediator.user_id
            LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
            LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
            LEFT JOIN ref__daerahs ON ref__daerahs.daerah_id = users__profile.daerah_id
            LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
            LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
            LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
            LEFT JOIN ref__status_spk_imediator ON ref__status_spk_imediator.id = spk__imediator.status_pelanjutan
            LEFT JOIN (
                            SELECT spk__imediator_mediasi.spk_imediator_id, count(*) AS count_kes
                            FROM spk__imediator_mediasi
                            GROUP BY spk__imediator_mediasi.spk_imediator_id
            ) a ON a.spk_imediator_id = spk__imediator.id
            LEFT JOIN (
                            SELECT spk__imediator_keaktifan_aktiviti.spk_imediator_id, count(*) AS count_aktiviti
                            FROM spk__imediator_keaktifan_aktiviti
                            GROUP BY spk__imediator_keaktifan_aktiviti.spk_imediator_id
            ) b ON b.spk_imediator_id = spk__imediator.id
            LEFT JOIN (
                            SELECT spk__imediator_keaktifan_latihan.spk_imediator_id, count(*) AS count_latihan
                            FROM spk__imediator_keaktifan_latihan
                            GROUP BY spk__imediator_keaktifan_latihan.spk_imediator_id
            ) c ON c.spk_imediator_id = spk__imediator.id
            WHERE users__profile.state_id = '" . Auth::user()->state_id . "' AND spk__imediator.status_pelanjutan = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $daerah     = RefDaerah::where('status', '=',  true)
                            ->where('ref__daerahs.state_id', '=', Auth::user()->state_id)    
                            ->get();
            $parlimen   = RefParlimen::where('status', '=',  true)
                            ->where('ref__parlimens.state_id', '=', Auth::user()->state_id)    
                            ->get();
            return view('rt-sm32.laporan-pelanjutan-mkp-ppmk',compact('roles_menu','daerah','parlimen'));
        }
    }

    function laporan_pelanjutan_mkp_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT spk__imediator.id AS id,
            ref__states.state_description AS state_description,
            ref__daerahs.daerah_description AS daerah_description,
            ref__parlimens.parlimen_description AS parlimen_description,
            ref__duns.dun_description AS dun_description,
            ref__pbts.pbt_description AS pbt_description,
            users__profile.user_fullname AS mkp_pemohon_nama,
            users__profile.no_ic AS mkp_pemohon_ic,
            users__profile.no_phone AS mkp_pemohon_no_phone,
            users.user_email AS mkp_pemohon_email,
            DATE_FORMAT(spk__imediator.mkp_tarikh_dilantik,'%d/%m/%Y') AS mkp_tarikh_dilantik,
            DATE_FORMAT(DATE_ADD(spk__imediator.mkp_tarikh_dilantik, INTERVAL 548 DAY),'%d/%m/%Y') AS tarikh_kemaskini,
            DATE_FORMAT(DATE_ADD(spk__imediator.mkp_tarikh_dilantik, INTERVAL 731 DAY),'%d/%m/%Y') AS tarikh_tamat,
            (case when a.count_kes >= 2 AND b.count_aktiviti >= 2 AND c.count_latihan >= 2 then 'Layak' else 'Tidak Layak' end)AS status_kelayakan,
            ref__status_spk_imediator.status_description AS status_pelanjutan,
            spk__imediator.status_pelanjutan AS status
            FROM spk__imediator
            LEFT JOIN users ON users.user_id = spk__imediator.user_id
            LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
            LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
            LEFT JOIN ref__daerahs ON ref__daerahs.daerah_id = users__profile.daerah_id
            LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
            LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
            LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
            LEFT JOIN ref__status_spk_imediator ON ref__status_spk_imediator.id = spk__imediator.status_pelanjutan
            LEFT JOIN (
                            SELECT spk__imediator_mediasi.spk_imediator_id, count(*) AS count_kes
                            FROM spk__imediator_mediasi
                            GROUP BY spk__imediator_mediasi.spk_imediator_id
            ) a ON a.spk_imediator_id = spk__imediator.id
            LEFT JOIN (
                            SELECT spk__imediator_keaktifan_aktiviti.spk_imediator_id, count(*) AS count_aktiviti
                            FROM spk__imediator_keaktifan_aktiviti
                            GROUP BY spk__imediator_keaktifan_aktiviti.spk_imediator_id
            ) b ON b.spk_imediator_id = spk__imediator.id
            LEFT JOIN (
                            SELECT spk__imediator_keaktifan_latihan.spk_imediator_id, count(*) AS count_latihan
                            FROM spk__imediator_keaktifan_latihan
                            GROUP BY spk__imediator_keaktifan_latihan.spk_imediator_id
            ) c ON c.spk_imediator_id = spk__imediator.id
            WHERE users__profile.state_id = '" . Auth::user()->state_id . "' AND spk__imediator.status_pelanjutan = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $daerah     = RefDaerah::where('status', '=',  true)
                            ->where('ref__daerahs.state_id', '=', Auth::user()->state_id)    
                            ->get();
            $parlimen   = RefParlimen::where('status', '=',  true)
                            ->where('ref__parlimens.state_id', '=', Auth::user()->state_id)    
                            ->get();
            return view('rt-sm32.laporan-pelanjutan-mkp-ppn',compact('roles_menu','daerah','parlimen'));
        }
    }

    function laporan_pelanjutan_mkp_upmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT spk__imediator.id AS id,
            ref__states.state_description AS state_description,
            ref__daerahs.daerah_description AS daerah_description,
            ref__parlimens.parlimen_description AS parlimen_description,
            ref__duns.dun_description AS dun_description,
            ref__pbts.pbt_description AS pbt_description,
            users__profile.user_fullname AS mkp_pemohon_nama,
            users__profile.no_ic AS mkp_pemohon_ic,
            users__profile.no_phone AS mkp_pemohon_no_phone,
            users.user_email AS mkp_pemohon_email,
            DATE_FORMAT(spk__imediator.mkp_tarikh_dilantik,'%d/%m/%Y') AS mkp_tarikh_dilantik,
            DATE_FORMAT(DATE_ADD(spk__imediator.mkp_tarikh_dilantik, INTERVAL 548 DAY),'%d/%m/%Y') AS tarikh_kemaskini,
            DATE_FORMAT(DATE_ADD(spk__imediator.mkp_tarikh_dilantik, INTERVAL 731 DAY),'%d/%m/%Y') AS tarikh_tamat,
            (case when a.count_kes >= 2 AND b.count_aktiviti >= 2 AND c.count_latihan >= 2 then 'Layak' else 'Tidak Layak' end)AS status_kelayakan,
            ref__status_spk_imediator.status_description AS status_pelanjutan,
            spk__imediator.status_pelanjutan AS status
            FROM spk__imediator
            LEFT JOIN users ON users.user_id = spk__imediator.user_id
            LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
            LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
            LEFT JOIN ref__daerahs ON ref__daerahs.daerah_id = users__profile.daerah_id
            LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
            LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
            LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
            LEFT JOIN ref__status_spk_imediator ON ref__status_spk_imediator.id = spk__imediator.status_pelanjutan
            LEFT JOIN (
                            SELECT spk__imediator_mediasi.spk_imediator_id, count(*) AS count_kes
                            FROM spk__imediator_mediasi
                            GROUP BY spk__imediator_mediasi.spk_imediator_id
            ) a ON a.spk_imediator_id = spk__imediator.id
            LEFT JOIN (
                            SELECT spk__imediator_keaktifan_aktiviti.spk_imediator_id, count(*) AS count_aktiviti
                            FROM spk__imediator_keaktifan_aktiviti
                            GROUP BY spk__imediator_keaktifan_aktiviti.spk_imediator_id
            ) b ON b.spk_imediator_id = spk__imediator.id
            LEFT JOIN (
                            SELECT spk__imediator_keaktifan_latihan.spk_imediator_id, count(*) AS count_latihan
                            FROM spk__imediator_keaktifan_latihan
                            GROUP BY spk__imediator_keaktifan_latihan.spk_imediator_id
            ) c ON c.spk_imediator_id = spk__imediator.id
            WHERE spk__imediator.status_pelanjutan = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-pelanjutan-mkp-upmk',compact('roles_menu','state'));
        }
    }

    function laporan_pelanjutan_mkp_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::select(DB::raw("
            SELECT spk__imediator.id AS id,
            ref__states.state_description AS state_description,
            ref__daerahs.daerah_description AS daerah_description,
            ref__parlimens.parlimen_description AS parlimen_description,
            ref__duns.dun_description AS dun_description,
            ref__pbts.pbt_description AS pbt_description,
            users__profile.user_fullname AS mkp_pemohon_nama,
            users__profile.no_ic AS mkp_pemohon_ic,
            users__profile.no_phone AS mkp_pemohon_no_phone,
            users.user_email AS mkp_pemohon_email,
            DATE_FORMAT(spk__imediator.mkp_tarikh_dilantik,'%d/%m/%Y') AS mkp_tarikh_dilantik,
            DATE_FORMAT(DATE_ADD(spk__imediator.mkp_tarikh_dilantik, INTERVAL 548 DAY),'%d/%m/%Y') AS tarikh_kemaskini,
            DATE_FORMAT(DATE_ADD(spk__imediator.mkp_tarikh_dilantik, INTERVAL 731 DAY),'%d/%m/%Y') AS tarikh_tamat,
            (case when a.count_kes >= 2 AND b.count_aktiviti >= 2 AND c.count_latihan >= 2 then 'Layak' else 'Tidak Layak' end)AS status_kelayakan,
            ref__status_spk_imediator.status_description AS status_pelanjutan,
            spk__imediator.status_pelanjutan AS status
            FROM spk__imediator
            LEFT JOIN users ON users.user_id = spk__imediator.user_id
            LEFT JOIN users__profile ON users__profile.user_id = spk__imediator.user_id
            LEFT JOIN ref__states ON ref__states.state_id = users__profile.state_id
            LEFT JOIN ref__daerahs ON ref__daerahs.daerah_id = users__profile.daerah_id
            LEFT JOIN ref__parlimens ON ref__parlimens.parlimen_id = spk__imediator.mkp_pemohon_parlimen_id
            LEFT JOIN ref__duns ON ref__duns.dun_id = spk__imediator.mkp_pemohon_dun_id
            LEFT JOIN ref__pbts ON ref__pbts.pbt_id = spk__imediator.mkp_pemohon_pbt_id
            LEFT JOIN ref__status_spk_imediator ON ref__status_spk_imediator.id = spk__imediator.status_pelanjutan
            LEFT JOIN (
                            SELECT spk__imediator_mediasi.spk_imediator_id, count(*) AS count_kes
                            FROM spk__imediator_mediasi
                            GROUP BY spk__imediator_mediasi.spk_imediator_id
            ) a ON a.spk_imediator_id = spk__imediator.id
            LEFT JOIN (
                            SELECT spk__imediator_keaktifan_aktiviti.spk_imediator_id, count(*) AS count_aktiviti
                            FROM spk__imediator_keaktifan_aktiviti
                            GROUP BY spk__imediator_keaktifan_aktiviti.spk_imediator_id
            ) b ON b.spk_imediator_id = spk__imediator.id
            LEFT JOIN (
                            SELECT spk__imediator_keaktifan_latihan.spk_imediator_id, count(*) AS count_latihan
                            FROM spk__imediator_keaktifan_latihan
                            GROUP BY spk__imediator_keaktifan_latihan.spk_imediator_id
            ) c ON c.spk_imediator_id = spk__imediator.id
            WHERE spk__imediator.status_pelanjutan = 1"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-pelanjutan-mkp-p',compact('roles_menu','state'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_mediasi_mkp_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__imediator_mediasi')
                        ->select('spk__imediator_mediasi.id AS id',
                                'ref__states.state_description AS state_description',
                                'ref__daerahs.daerah_description AS daerah_description',
                                'ref__parlimens.parlimen_description AS parlimen_description',
                                'ref__duns.dun_description AS dun_description',
                                'ref__pbts.pbt_description AS pbt_description',
                                'ref__spk_mkp_mediasi.kluster_description AS kluster',
                                DB::raw(" DATE_FORMAT(spk__imediator_mediasi.mediasi_tarikh,'%d/%m/%Y') AS mediasi_tarikh"),
                                'spk__imediator_mediasi.mediasi_alamat AS mediasi_alamat',
                                'users__profile.user_fullname AS nama_mediator',
                                'spk__imediator_mediasi.mediasi_pembantu_nama AS mediasi_pembantu_nama',
                                'spk__imediator_mediasi.mediasi_ringkasan_kes AS mediasi_ringkasan_kes',
                                'spk__imediator_mediasi.mediasi_ngo_terlibat AS mediasi_ngo_terlibat',
                                'spk__imediator_mediasi.status AS status',
                                'ref__status_spk_imediator_mediasi.status_description AS status_description')
                        ->leftJoin('spk__imediator','spk__imediator.id','=','spk__imediator_mediasi.spk_imediator_id')
                        ->leftJoin('users__profile','users__profile.user_id','=','spk__imediator.user_id')
                        ->leftJoin('ref__states','ref__states.state_id','=','users__profile.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','users__profile.daerah_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__imediator.mkp_pemohon_parlimen_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__imediator.mkp_pemohon_dun_id')
                        ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','spk__imediator.mkp_pemohon_pbt_id')
                        ->leftJoin('ref__spk_mkp_mediasi','ref__spk_mkp_mediasi.id','=','spk__imediator_mediasi.ref_mkp_kategori_id')
                        ->leftJoin('ref__status_spk_imediator_mediasi','ref__status_spk_imediator_mediasi.id','=','spk__imediator_mediasi.status')
                        ->whereIN('spk__imediator_mediasi.status',[1])
                        ->where('users__profile.daerah_id', '=',  Auth::user()->daerah_id)
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-mediasi-mkp-ppd', compact('roles_menu','state'));
        }
    }

    function laporan_mediasi_mkp_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__imediator_mediasi')
                        ->select('spk__imediator_mediasi.id AS id',
                                'ref__states.state_description AS state_description',
                                'ref__daerahs.daerah_description AS daerah_description',
                                'ref__parlimens.parlimen_description AS parlimen_description',
                                'ref__duns.dun_description AS dun_description',
                                'ref__pbts.pbt_description AS pbt_description',
                                'ref__spk_mkp_mediasi.kluster_description AS kluster',
                                DB::raw(" DATE_FORMAT(spk__imediator_mediasi.mediasi_tarikh,'%d/%m/%Y') AS mediasi_tarikh"),
                                'spk__imediator_mediasi.mediasi_alamat AS mediasi_alamat',
                                'users__profile.user_fullname AS nama_mediator',
                                'spk__imediator_mediasi.mediasi_pembantu_nama AS mediasi_pembantu_nama',
                                'spk__imediator_mediasi.mediasi_ringkasan_kes AS mediasi_ringkasan_kes',
                                'spk__imediator_mediasi.mediasi_ngo_terlibat AS mediasi_ngo_terlibat',
                                'spk__imediator_mediasi.status AS status',
                                'ref__status_spk_imediator_mediasi.status_description AS status_description')
                        ->leftJoin('spk__imediator','spk__imediator.id','=','spk__imediator_mediasi.spk_imediator_id')
                        ->leftJoin('users__profile','users__profile.user_id','=','spk__imediator.user_id')
                        ->leftJoin('ref__states','ref__states.state_id','=','users__profile.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','users__profile.daerah_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__imediator.mkp_pemohon_parlimen_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__imediator.mkp_pemohon_dun_id')
                        ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','spk__imediator.mkp_pemohon_pbt_id')
                        ->leftJoin('ref__spk_mkp_mediasi','ref__spk_mkp_mediasi.id','=','spk__imediator_mediasi.ref_mkp_kategori_id')
                        ->leftJoin('ref__status_spk_imediator_mediasi','ref__status_spk_imediator_mediasi.id','=','spk__imediator_mediasi.status')
                        ->whereIN('spk__imediator_mediasi.status',[1])
                        ->where('users__profile.state_id', '=',  Auth::user()->state_id)
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $daerah     = RefDaerah::where('status', '=',  true)
                            ->where('ref__daerahs.state_id', '=', Auth::user()->state_id)    
                            ->get();
            $parlimen   = RefParlimen::where('status', '=',  true)
                            ->where('ref__parlimens.state_id', '=', Auth::user()->state_id)    
                            ->get();
            return view('rt-sm32.laporan-mediasi-mkp-ppmk', compact('roles_menu','daerah','parlimen'));
        }
    }

    function laporan_mediasi_mkp_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__imediator_mediasi')
                        ->select('spk__imediator_mediasi.id AS id',
                                'ref__states.state_description AS state_description',
                                'ref__daerahs.daerah_description AS daerah_description',
                                'ref__parlimens.parlimen_description AS parlimen_description',
                                'ref__duns.dun_description AS dun_description',
                                'ref__pbts.pbt_description AS pbt_description',
                                'ref__spk_mkp_mediasi.kluster_description AS kluster',
                                DB::raw(" DATE_FORMAT(spk__imediator_mediasi.mediasi_tarikh,'%d/%m/%Y') AS mediasi_tarikh"),
                                'spk__imediator_mediasi.mediasi_alamat AS mediasi_alamat',
                                'users__profile.user_fullname AS nama_mediator',
                                'spk__imediator_mediasi.mediasi_pembantu_nama AS mediasi_pembantu_nama',
                                'spk__imediator_mediasi.mediasi_ringkasan_kes AS mediasi_ringkasan_kes',
                                'spk__imediator_mediasi.mediasi_ngo_terlibat AS mediasi_ngo_terlibat',
                                'spk__imediator_mediasi.status AS status',
                                'ref__status_spk_imediator_mediasi.status_description AS status_description')
                        ->leftJoin('spk__imediator','spk__imediator.id','=','spk__imediator_mediasi.spk_imediator_id')
                        ->leftJoin('users__profile','users__profile.user_id','=','spk__imediator.user_id')
                        ->leftJoin('ref__states','ref__states.state_id','=','users__profile.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','users__profile.daerah_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__imediator.mkp_pemohon_parlimen_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__imediator.mkp_pemohon_dun_id')
                        ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','spk__imediator.mkp_pemohon_pbt_id')
                        ->leftJoin('ref__spk_mkp_mediasi','ref__spk_mkp_mediasi.id','=','spk__imediator_mediasi.ref_mkp_kategori_id')
                        ->leftJoin('ref__status_spk_imediator_mediasi','ref__status_spk_imediator_mediasi.id','=','spk__imediator_mediasi.status')
                        ->whereIN('spk__imediator_mediasi.status',[1])
                        ->where('users__profile.state_id', '=',  Auth::user()->state_id)
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $daerah     = RefDaerah::where('status', '=',  true)
                            ->where('ref__daerahs.state_id', '=', Auth::user()->state_id)    
                            ->get();
            $parlimen   = RefParlimen::where('status', '=',  true)
                            ->where('ref__parlimens.state_id', '=', Auth::user()->state_id)    
                            ->get();
            return view('rt-sm32.laporan-mediasi-mkp-ppn', compact('roles_menu','daerah','parlimen'));
        }
    }

    function laporan_mediasi_mkp_upmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__imediator_mediasi')
                        ->select('spk__imediator_mediasi.id AS id',
                                'ref__states.state_description AS state_description',
                                'ref__daerahs.daerah_description AS daerah_description',
                                'ref__parlimens.parlimen_description AS parlimen_description',
                                'ref__duns.dun_description AS dun_description',
                                'ref__pbts.pbt_description AS pbt_description',
                                'ref__spk_mkp_mediasi.kluster_description AS kluster',
                                DB::raw(" DATE_FORMAT(spk__imediator_mediasi.mediasi_tarikh,'%d/%m/%Y') AS mediasi_tarikh"),
                                'spk__imediator_mediasi.mediasi_alamat AS mediasi_alamat',
                                'users__profile.user_fullname AS nama_mediator',
                                'spk__imediator_mediasi.mediasi_pembantu_nama AS mediasi_pembantu_nama',
                                'spk__imediator_mediasi.mediasi_ringkasan_kes AS mediasi_ringkasan_kes',
                                'spk__imediator_mediasi.mediasi_ngo_terlibat AS mediasi_ngo_terlibat',
                                'spk__imediator_mediasi.status AS status',
                                'ref__status_spk_imediator_mediasi.status_description AS status_description')
                        ->leftJoin('spk__imediator','spk__imediator.id','=','spk__imediator_mediasi.spk_imediator_id')
                        ->leftJoin('users__profile','users__profile.user_id','=','spk__imediator.user_id')
                        ->leftJoin('ref__states','ref__states.state_id','=','users__profile.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','users__profile.daerah_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__imediator.mkp_pemohon_parlimen_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__imediator.mkp_pemohon_dun_id')
                        ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','spk__imediator.mkp_pemohon_pbt_id')
                        ->leftJoin('ref__spk_mkp_mediasi','ref__spk_mkp_mediasi.id','=','spk__imediator_mediasi.ref_mkp_kategori_id')
                        ->leftJoin('ref__status_spk_imediator_mediasi','ref__status_spk_imediator_mediasi.id','=','spk__imediator_mediasi.status')
                        ->whereIN('spk__imediator_mediasi.status',[1])
                        ->where('users__profile.state_id', '=',  Auth::user()->state_id)
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-mediasi-mkp-upmk', compact('roles_menu','state'));
        }
    }

    function laporan_mediasi_mkp_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            if($type == 'get_daerah') {
                $value = $request->value;
                $where = array('state_description' => $value);
                $data  = DB::table('ref__daerahs')
                        ->select('ref__daerahs.id', 'ref__daerahs.daerah_id', 'ref__daerahs.daerah_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__daerahs.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_parlimen') {
                $value = $request->value;
                $where = array('parlimen_description' => $value);
                $data  = DB::table('ref__parlimens')
                        ->select('ref__parlimens.id', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description', 'ref__states.state_id', 'ref__states.state_description')
                        ->leftJoin('ref__states','ref__states.state_id','=','ref__parlimens.state_id')
                        ->where('ref__states.state_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            else if($type == 'get_dun') {
                $value = $request->value;
                $where = array('dun_description' => $value);
                $data  = DB::table('ref__duns')
                        ->select('ref__duns.id', 'ref__duns.dun_id', 'ref__duns.dun_description', 'ref__parlimens.parlimen_id', 'ref__parlimens.parlimen_description')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','ref__duns.parlimen_id')
                        ->where('ref__parlimens.parlimen_description', '=',  $where)
                        ->get();
                return Response::json($data);
            }
            $data = DB::table('spk__imediator_mediasi')
                        ->select('spk__imediator_mediasi.id AS id',
                                'ref__states.state_description AS state_description',
                                'ref__daerahs.daerah_description AS daerah_description',
                                'ref__parlimens.parlimen_description AS parlimen_description',
                                'ref__duns.dun_description AS dun_description',
                                'ref__pbts.pbt_description AS pbt_description',
                                'ref__spk_mkp_mediasi.kluster_description AS kluster',
                                DB::raw(" DATE_FORMAT(spk__imediator_mediasi.mediasi_tarikh,'%d/%m/%Y') AS mediasi_tarikh"),
                                'spk__imediator_mediasi.mediasi_alamat AS mediasi_alamat',
                                'users__profile.user_fullname AS nama_mediator',
                                'spk__imediator_mediasi.mediasi_pembantu_nama AS mediasi_pembantu_nama',
                                'spk__imediator_mediasi.mediasi_ringkasan_kes AS mediasi_ringkasan_kes',
                                'spk__imediator_mediasi.mediasi_ngo_terlibat AS mediasi_ngo_terlibat',
                                'spk__imediator_mediasi.status AS status',
                                'ref__status_spk_imediator_mediasi.status_description AS status_description')
                        ->leftJoin('spk__imediator','spk__imediator.id','=','spk__imediator_mediasi.spk_imediator_id')
                        ->leftJoin('users__profile','users__profile.user_id','=','spk__imediator.user_id')
                        ->leftJoin('ref__states','ref__states.state_id','=','users__profile.state_id')
                        ->leftJoin('ref__daerahs','ref__daerahs.daerah_id','=','users__profile.daerah_id')
                        ->leftJoin('ref__parlimens','ref__parlimens.parlimen_id','=','spk__imediator.mkp_pemohon_parlimen_id')
                        ->leftJoin('ref__duns','ref__duns.dun_id','=','spk__imediator.mkp_pemohon_dun_id')
                        ->leftJoin('ref__pbts','ref__pbts.pbt_id','=','spk__imediator.mkp_pemohon_pbt_id')
                        ->leftJoin('ref__spk_mkp_mediasi','ref__spk_mkp_mediasi.id','=','spk__imediator_mediasi.ref_mkp_kategori_id')
                        ->leftJoin('ref__status_spk_imediator_mediasi','ref__status_spk_imediator_mediasi.id','=','spk__imediator_mediasi.status')
                        ->whereIN('spk__imediator_mediasi.status',[1])
                        ->where('users__profile.state_id', '=',  Auth::user()->state_id)
                        ->get();
                return Datatables::of($data)
                        ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            $state      = RefStates::where('status', '=',  true)->get();
            return view('rt-sm32.laporan-mediasi-mkp-p', compact('roles_menu','state'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_kluster_mediasi_mkp_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_kejiranan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_keluarga,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_harta,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_alamsekitar,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_kepenggunaan,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_kesihatan,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_kontrak,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_intelek,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_pembinaan,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_agama
            FROM ref__states
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 1
                GROUP BY users.state_id
            ) a on a.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 2
                GROUP BY users.state_id
            ) b on b.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 3
                GROUP BY users.state_id
            ) c on c.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 4
                GROUP BY users.state_id
            ) d on d.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 5
                GROUP BY users.state_id
            ) e on e.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 6
                GROUP BY users.state_id
            ) f on f.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 7
                GROUP BY users.state_id
            ) g on g.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 8
                GROUP BY users.state_id
            ) h on h.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 9
                GROUP BY users.state_id
            ) i on i.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 10
                GROUP BY users.state_id
            ) j on j.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            return view('rt-sm32.laporan-kluster-mediasi-mkp-ppd',compact('roles_menu'));
        }
    }

    function laporan_kluster_mediasi_mkp_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_kejiranan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_keluarga,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_harta,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_alamsekitar,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_kepenggunaan,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_kesihatan,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_kontrak,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_intelek,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_pembinaan,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_agama
            FROM ref__states
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 1
                GROUP BY users.state_id
            ) a on a.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 2
                GROUP BY users.state_id
            ) b on b.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 3
                GROUP BY users.state_id
            ) c on c.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 4
                GROUP BY users.state_id
            ) d on d.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 5
                GROUP BY users.state_id
            ) e on e.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 6
                GROUP BY users.state_id
            ) f on f.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 7
                GROUP BY users.state_id
            ) g on g.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 8
                GROUP BY users.state_id
            ) h on h.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 9
                GROUP BY users.state_id
            ) i on i.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 10
                GROUP BY users.state_id
            ) j on j.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            return view('rt-sm32.laporan-kluster-mediasi-mkp-ppmk',compact('roles_menu'));
        }
    }

    function laporan_kluster_mediasi_mkp_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_kejiranan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_keluarga,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_harta,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_alamsekitar,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_kepenggunaan,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_kesihatan,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_kontrak,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_intelek,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_pembinaan,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_agama
            FROM ref__states
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 1
                GROUP BY users.state_id
            ) a on a.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 2
                GROUP BY users.state_id
            ) b on b.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 3
                GROUP BY users.state_id
            ) c on c.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 4
                GROUP BY users.state_id
            ) d on d.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 5
                GROUP BY users.state_id
            ) e on e.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 6
                GROUP BY users.state_id
            ) f on f.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 7
                GROUP BY users.state_id
            ) g on g.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 8
                GROUP BY users.state_id
            ) h on h.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 9
                GROUP BY users.state_id
            ) i on i.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 10
                GROUP BY users.state_id
            ) j on j.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            return view('rt-sm32.laporan-kluster-mediasi-mkp-ppn',compact('roles_menu'));
        }
    }

    function laporan_kluster_mediasi_mkp_upmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_kejiranan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_keluarga,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_harta,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_alamsekitar,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_kepenggunaan,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_kesihatan,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_kontrak,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_intelek,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_pembinaan,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_agama
            FROM ref__states
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 1
                GROUP BY users.state_id
            ) a on a.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 2
                GROUP BY users.state_id
            ) b on b.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 3
                GROUP BY users.state_id
            ) c on c.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 4
                GROUP BY users.state_id
            ) d on d.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 5
                GROUP BY users.state_id
            ) e on e.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 6
                GROUP BY users.state_id
            ) f on f.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 7
                GROUP BY users.state_id
            ) g on g.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 8
                GROUP BY users.state_id
            ) h on h.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 9
                GROUP BY users.state_id
            ) i on i.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 10
                GROUP BY users.state_id
            ) j on j.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            return view('rt-sm32.laporan-kluster-mediasi-mkp-upmk',compact('roles_menu'));
        }
    }

    function laporan_kluster_mediasi_mkp_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            $data = DB::select(DB::raw("
            SELECT
                ref__states.state_description AS state,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_kejiranan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_keluarga,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_harta,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_alamsekitar,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_kepenggunaan,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_kesihatan,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_kontrak,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_intelek,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_pembinaan,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_agama
            FROM ref__states
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 1
                GROUP BY users.state_id
            ) a on a.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 2
                GROUP BY users.state_id
            ) b on b.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 3
                GROUP BY users.state_id
            ) c on c.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 4
                GROUP BY users.state_id
            ) d on d.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 5
                GROUP BY users.state_id
            ) e on e.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 6
                GROUP BY users.state_id
            ) f on f.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 7
                GROUP BY users.state_id
            ) g on g.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 8
                GROUP BY users.state_id
            ) h on h.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 9
                GROUP BY users.state_id
            ) i on i.state_id = ref__states.state_id
            LEFT JOIN (
                SELECT
                    users.state_id AS state_id,
                    count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and YEAR(CURDATE()) and ref_mkp_kategori_id = 10
                GROUP BY users.state_id
            ) j on j.state_id = ref__states.state_id"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            return view('rt-sm32.laporan-kluster-mediasi-mkp-p',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function laporan_kluster_mediasi_mkp_b_ppd(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_mkp_mediasi.kluster_description AS kluster,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_jan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_feb,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_mar,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_apr,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_may,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_jun,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_jul,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_aug,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_sep,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_oct,
                (case when k.total IS NOT NULL then k.total else 0 end)AS total_nov,
                (case when l.total IS NOT NULL then l.total else 0 end)AS total_dec
            FROM ref__spk_mkp_mediasi
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 1 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) a on a.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 2 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) b on b.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 3 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) c on c.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 4 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) d on d.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 5 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) e on e.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 6 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) f on f.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 7 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) g on g.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 8 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) h on h.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 9 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) i on i.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 10 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) j on j.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 11 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) k on k.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 12 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) l on l.kluster_id = ref__spk_mkp_mediasi.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            return view('rt-sm32.laporan-kluster-mediasi-mkp-b-ppd',compact('roles_menu'));
        }
    }

    function laporan_kluster_mediasi_mkp_b_ppmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_mkp_mediasi.kluster_description AS kluster,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_jan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_feb,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_mar,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_apr,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_may,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_jun,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_jul,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_aug,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_sep,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_oct,
                (case when k.total IS NOT NULL then k.total else 0 end)AS total_nov,
                (case when l.total IS NOT NULL then l.total else 0 end)AS total_dec
            FROM ref__spk_mkp_mediasi
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 1 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) a on a.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 2 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) b on b.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 3 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) c on c.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 4 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) d on d.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 5 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) e on e.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 6 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) f on f.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 7 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) g on g.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 8 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) h on h.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 9 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) i on i.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 10 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) j on j.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 11 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) k on k.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 12 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) l on l.kluster_id = ref__spk_mkp_mediasi.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            return view('rt-sm32.laporan-kluster-mediasi-mkp-b-ppmk',compact('roles_menu'));
        }
    }

    function laporan_kluster_mediasi_mkp_b_ppn(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_mkp_mediasi.kluster_description AS kluster,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_jan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_feb,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_mar,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_apr,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_may,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_jun,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_jul,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_aug,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_sep,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_oct,
                (case when k.total IS NOT NULL then k.total else 0 end)AS total_nov,
                (case when l.total IS NOT NULL then l.total else 0 end)AS total_dec
            FROM ref__spk_mkp_mediasi
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 1 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) a on a.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 2 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) b on b.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 3 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) c on c.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 4 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) d on d.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 5 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) e on e.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 6 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) f on f.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 7 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) g on g.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 8 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) h on h.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 9 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) i on i.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 10 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) j on j.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 11 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) k on k.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 12 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) l on l.kluster_id = ref__spk_mkp_mediasi.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            return view('rt-sm32.laporan-kluster-mediasi-mkp-b-ppn',compact('roles_menu'));
        }
    }

    function laporan_kluster_mediasi_mkp_b_upmk(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_mkp_mediasi.kluster_description AS kluster,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_jan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_feb,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_mar,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_apr,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_may,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_jun,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_jul,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_aug,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_sep,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_oct,
                (case when k.total IS NOT NULL then k.total else 0 end)AS total_nov,
                (case when l.total IS NOT NULL then l.total else 0 end)AS total_dec
            FROM ref__spk_mkp_mediasi
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 1 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) a on a.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 2 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) b on b.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 3 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) c on c.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 4 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) d on d.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 5 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) e on e.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 6 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) f on f.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 7 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) g on g.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 8 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) h on h.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 9 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) i on i.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 10 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) j on j.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 11 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) k on k.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 12 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) l on l.kluster_id = ref__spk_mkp_mediasi.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            return view('rt-sm32.laporan-kluster-mediasi-mkp-b-upmk',compact('roles_menu'));
        }
    }

    function laporan_kluster_mediasi_mkp_b_p(Request $request){
        if($request->ajax()){ 
            $type = $request->type;
            $data = DB::select(DB::raw("
            SELECT
                ref__spk_mkp_mediasi.kluster_description AS kluster,
                (case when a.total IS NOT NULL then a.total else 0 end)AS total_jan,
                (case when b.total IS NOT NULL then b.total else 0 end)AS total_feb,
                (case when c.total IS NOT NULL then c.total else 0 end)AS total_mar,
                (case when d.total IS NOT NULL then d.total else 0 end)AS total_apr,
                (case when e.total IS NOT NULL then e.total else 0 end)AS total_may,
                (case when f.total IS NOT NULL then f.total else 0 end)AS total_jun,
                (case when g.total IS NOT NULL then g.total else 0 end)AS total_jul,
                (case when h.total IS NOT NULL then h.total else 0 end)AS total_aug,
                (case when i.total IS NOT NULL then i.total else 0 end)AS total_sep,
                (case when j.total IS NOT NULL then j.total else 0 end)AS total_oct,
                (case when k.total IS NOT NULL then k.total else 0 end)AS total_nov,
                (case when l.total IS NOT NULL then l.total else 0 end)AS total_dec
            FROM ref__spk_mkp_mediasi
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 1 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) a on a.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 2 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) b on b.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 3 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) c on c.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 4 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) d on d.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 5 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) e on e.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 6 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) f on f.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 7 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) g on g.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 8 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) h on h.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 9 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) i on i.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 10 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) j on j.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 11 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) k on k.kluster_id = ref__spk_mkp_mediasi.id
            LEFT JOIN (
                SELECT
                        spk__imediator_mediasi.ref_mkp_kategori_id AS kluster_id,
                        count(*) AS total
                FROM spk__imediator_mediasi 
                LEFT JOIN spk__imediator ON spk__imediator.id = spk__imediator_mediasi.spk_imediator_id
                LEFT JOIN users ON users.user_id = spk__imediator.user_id
                WHERE spk__imediator_mediasi.status = 1 and ref_mkp_kategori_id = 1 and MONTH(spk__imediator_mediasi.mediasi_tarikh) = 12 and YEAR(spk__imediator_mediasi.mediasi_tarikh) = YEAR(CURDATE())
                GROUP BY spk__imediator_mediasi.ref_mkp_kategori_id
            ) l on l.kluster_id = ref__spk_mkp_mediasi.id"));
            return Datatables::of($data)
            ->make(true);
        } else {
            $roles_menu     = DB::table('roles__menu')
                            ->select('roles__menu.id AS id',
                                'users__menu.menu_id AS first_menu',
                                'users__menu.menu2nd_id AS second_menu',
                                'users__menu.users_menu_page_name AS nama_menu',
                                'users__menu.users_menu_file_url AS menu_url',
                                'users__menu.highlight AS highlight_menu',
                                'users__menu.users_menu_page_icon AS icon_menu')
                            ->leftJoin('users__menu','users__menu.id','=','roles__menu.users_menu_id')
                            ->leftJoin('users__roles','users__roles.role_id','=','roles__menu.role_id')
                            ->where('users__roles.user_id', '=', Auth::user()->user_id)
                            ->where('roles__menu.status', '=', true)
                            ->orderBy('first_menu', 'asc')
                            ->orderBy('id', 'asc')
                            ->get();
            return view('rt-sm32.laporan-kluster-mediasi-mkp-b-p',compact('roles_menu'));
        }
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
}
